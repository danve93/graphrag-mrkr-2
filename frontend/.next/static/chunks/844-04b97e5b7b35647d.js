"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[844],{6844:function(e,t,a){a.d(t,{default:function(){return u}});var n=a(7437),r=a(7818),o=a(2265),s=a(3934),c=a(2800);let d=(0,r.default)(()=>Promise.all([a.e(689),a.e(197),a.e(319),a.e(982),a.e(315)]).then(a.bind(a,9315)),{loadableGenerated:{webpack:()=>[9315]},ssr:!1}),i=["#22d3ee","#a855f7","#f97316","#10b981","#3b82f6","#f59e0b","#e11d48","#0ea5e9","#8b5cf6","#14b8a6"];function l(e){if(null==e)return"#9ca3af";let t=Math.abs(e)%i.length;return i[t]}function u(){let[e,t]=(0,o.useState)({nodes:[],edges:[]}),[a,r]=(0,o.useState)([]),[i,u]=(0,o.useState)([]),[m,h]=(0,o.useState)("all"),[x,p]=(0,o.useState)("all"),[y,f]=(0,o.useState)(!1),[g,v]=(0,o.useState)(null),[b,w]=(0,o.useState)(null),[j,k]=(0,o.useState)(null),T=(0,o.useCallback)(async()=>{f(!0),v(null);try{let e=await c.h.getGraph({community_id:"all"!==m?Number(m):void 0,node_type:"all"!==x?x:void 0});t({nodes:e.nodes,edges:e.edges}),r(e.communities),u(e.node_types)}catch(e){v(e instanceof Error?e.message:"Failed to load graph data")}finally{f(!1)}},[m,x]);(0,o.useEffect)(()=>{T()},[T]);let N=(0,o.useMemo)(()=>({nodes:e.nodes.map(e=>{var t;return{...e,color:l(e.community_id),val:Math.max(null!==(t=e.degree)&&void 0!==t?t:1,1)}}),links:e.edges.map(e=>{var t;return{...e,value:Math.max(null!==(t=e.weight)&&void 0!==t?t:.5,.2)}})}),[e.edges,e.nodes]),E=(0,o.useCallback)(e=>{var t,a,n,r;let o=(null===(t=e.documents)||void 0===t?void 0:t.map(e=>e.document_name||e.document_id).filter(Boolean))||[];return"\n      <div>\n        <div><strong>".concat(e.label,"</strong></div>\n        <div>Type: ").concat(null!==(a=e.type)&&void 0!==a?a:"Unknown","</div>\n        <div>Community: ").concat(null!==(n=e.community_id)&&void 0!==n?n:"Unassigned","</div>\n        <div>Degree: ").concat(null!==(r=e.degree)&&void 0!==r?r:0,"</div>\n        <div>Documents: ").concat(o.slice(0,3).join(", ")||"None","</div>\n      </div>\n    ")},[]),_=(0,o.useCallback)(e=>{var t,a,n;let r=(e.text_units||[]).map(e=>e.document_name||e.document_id);return"\n      <div>\n        <div><strong>".concat(null!==(t=e.type)&&void 0!==t?t:"RELATED_TO","</strong> (").concat(null!==(a=e.weight)&&void 0!==a?a:.5,")</div>\n        <div>").concat(null!==(n=e.description)&&void 0!==n?n:"No description","</div>\n        <div>TextUnits: ").concat(r.slice(0,3).join(", ")||"Unspecified","</div>\n      </div>\n    ")},[]),P=(0,o.useMemo)(()=>{var e,t,a;return b?(0,n.jsxs)("div",{className:"rounded-lg border border-secondary-200 bg-white p-4 shadow-xl dark:border-secondary-700 dark:bg-secondary-800",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-secondary-900 dark:text-secondary-50",children:[(0,n.jsx)("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:l(b.community_id||void 0)}}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold",children:b.label}),(0,n.jsxs)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:["Type: ",b.type||"Unknown"]})]})]}),(0,n.jsxs)("dl",{className:"mt-3 space-y-2 text-xs text-secondary-700 dark:text-secondary-300",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("dt",{children:"Community"}),(0,n.jsx)("dd",{children:null!==(e=b.community_id)&&void 0!==e?e:"Unassigned"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("dt",{children:"Degree"}),(0,n.jsx)("dd",{children:null!==(t=b.degree)&&void 0!==t?t:0})]})]}),b.documents&&b.documents.length>0&&(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("p",{className:"text-xs font-semibold text-secondary-800 dark:text-secondary-200",children:"Documents"}),(0,n.jsx)("ul",{className:"mt-1 space-y-1 text-xs",children:b.documents.slice(0,5).map(e=>(0,n.jsxs)("li",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"block truncate",title:e.document_name||e.document_id,children:e.document_name||e.document_id}),e.document_id&&(0,n.jsx)("a",{className:"text-primary-600 hover:underline dark:text-primary-400",href:"/?doc=".concat(e.document_id),children:"Open"})]},"".concat(e.document_id,"-").concat(e.document_name)))})]})]}):j?(0,n.jsxs)("div",{className:"rounded-lg border border-secondary-200 bg-white p-4 shadow-xl dark:border-secondary-700 dark:bg-secondary-800",children:[(0,n.jsx)("p",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:j.type||"RELATED_TO"}),(0,n.jsxs)("p",{className:"text-xs text-secondary-600 dark:text-secondary-300",children:["Weight: ",null!==(a=j.weight)&&void 0!==a?a:.5]}),j.description&&(0,n.jsx)("p",{className:"mt-2 text-xs text-secondary-700 dark:text-secondary-200",children:j.description}),j.text_units&&j.text_units.length>0&&(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("p",{className:"text-xs font-semibold text-secondary-800 dark:text-secondary-200",children:"Supporting TextUnits"}),(0,n.jsx)("ul",{className:"mt-1 space-y-1 text-xs",children:j.text_units.slice(0,6).map(e=>(0,n.jsxs)("li",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"truncate",title:e.id,children:e.id}),e.document_id&&(0,n.jsx)("a",{className:"text-primary-600 hover:underline dark:text-primary-400",href:"/?doc=".concat(e.document_id),children:e.document_name||"Open document"})]},"".concat(e.id,"-").concat(e.document_id)))})]})]}):null},[j,b]);return(0,n.jsxs)("div",{className:"flex h-full flex-col gap-4 p-6",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-secondary-900 dark:text-secondary-50",children:"Graph Explorer"}),(0,n.jsx)("p",{className:"text-sm text-secondary-600 dark:text-secondary-400",children:"3D force layout with communities and provenance-rich tooltips."})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 rounded-lg bg-secondary-100 px-3 py-2 text-xs text-secondary-700 dark:bg-secondary-800 dark:text-secondary-300",children:[(0,n.jsx)(s.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:"Hover nodes/edges for TextUnit and document provenance."})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-3 rounded-lg border border-secondary-200 bg-white p-4 shadow-sm dark:border-secondary-700 dark:bg-secondary-800",children:[(0,n.jsxs)("div",{className:"flex min-w-[200px] flex-col gap-1",children:[(0,n.jsx)("label",{className:"text-xs font-semibold text-secondary-700 dark:text-secondary-300",children:"Community"}),(0,n.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"rounded border border-secondary-300 px-3 py-2 text-sm text-secondary-900 shadow-sm focus:border-primary-500 focus:outline-none dark:border-secondary-700 dark:bg-secondary-900 dark:text-secondary-100",children:[(0,n.jsx)("option",{value:"all",children:"All communities"}),a.map(e=>(0,n.jsxs)("option",{value:e.community_id,children:["Community ",e.community_id,void 0!==e.level?" (level ".concat(e.level,")"):""]},"".concat(e.community_id,"-").concat(e.level)))]})]}),(0,n.jsxs)("div",{className:"flex min-w-[200px] flex-col gap-1",children:[(0,n.jsx)("label",{className:"text-xs font-semibold text-secondary-700 dark:text-secondary-300",children:"Node type"}),(0,n.jsxs)("select",{value:x,onChange:e=>p(e.target.value),className:"rounded border border-secondary-300 px-3 py-2 text-sm text-secondary-900 shadow-sm focus:border-primary-500 focus:outline-none dark:border-secondary-700 dark:bg-secondary-900 dark:text-secondary-100",children:[(0,n.jsx)("option",{value:"all",children:"All types"}),i.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{className:"ml-auto flex items-center gap-2 text-xs text-secondary-600 dark:text-secondary-300",children:[(0,n.jsxs)("span",{className:"rounded bg-secondary-100 px-2 py-1 dark:bg-secondary-700",children:[e.nodes.length," nodes"]}),(0,n.jsxs)("span",{className:"rounded bg-secondary-100 px-2 py-1 dark:bg-secondary-700",children:[e.edges.length," edges"]}),(0,n.jsx)("button",{type:"button",onClick:()=>void T(),className:"rounded bg-primary-600 px-3 py-2 text-xs font-semibold text-white shadow-sm transition hover:bg-primary-500",children:"Refresh"})]})]}),(0,n.jsxs)("div",{className:"relative min-h-[640px] overflow-hidden rounded-xl border border-secondary-200 bg-secondary-900 shadow-inner dark:border-secondary-700",children:[y&&(0,n.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-secondary-900/70 text-secondary-50",children:"Loading graphâ€¦"}),g&&(0,n.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-secondary-900/70",children:(0,n.jsx)("div",{className:"rounded bg-white/90 p-4 text-sm text-red-700 shadow dark:bg-secondary-800/90 dark:text-red-200",children:g})}),(0,n.jsx)(d,{graphData:N,nodeColor:e=>l(e.community_id||void 0),linkColor:()=>"#94a3b8",nodeVal:e=>{var t,a;return null!==(a=e.val)&&void 0!==a?a:Math.max(null!==(t=e.degree)&&void 0!==t?t:1,1)},linkWidth:e=>{var t,a;return(null!==(a=e.value)&&void 0!==a?a:Math.max(null!==(t=e.weight)&&void 0!==t?t:.5,.2))*2},nodeLabel:e=>E(e),linkLabel:e=>_(e),backgroundColor:"#0b1120",onNodeHover:e=>{w(e||null),k(null)},onLinkHover:e=>{k(e||null),w(null)}}),P&&(0,n.jsx)("div",{className:"pointer-events-none absolute right-4 top-4 z-20 w-80",children:P})]})]})}},2800:function(e,t,a){a.d(t,{h:function(){return r}});let n="http://localhost:8000",r={async sendMessage(e,t){let a=await fetch("".concat(n,"/api/chat/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:null==t?void 0:t.signal});if(!a.ok)throw Error("API error: ".concat(a.statusText));return a},async getHistory(){let e=await fetch("".concat(n,"/api/history/sessions"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getConversation(e){let t=await fetch("".concat(n,"/api/history/").concat(e));if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async deleteConversation(e){let t=await fetch("".concat(n,"/api/history/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async clearHistory(){let e=await fetch("".concat(n,"/api/history/clear"),{method:"POST"});if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getStats(){let e=await fetch("".concat(n,"/api/database/stats"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async uploadFile(e){let t=new FormData;t.append("file",e);let a=await fetch("".concat(n,"/api/database/upload"),{method:"POST",body:t});if(!a.ok)throw Error("API error: ".concat(a.statusText));return a.json()},async stageFile(e){let t=new FormData;t.append("file",e);let a=await fetch("".concat(n,"/api/database/stage"),{method:"POST",body:t});if(!a.ok)throw Error("API error: ".concat(a.statusText));return a.json()},async getStagedDocuments(){let e=await fetch("".concat(n,"/api/database/staged"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async deleteStagedDocument(e){let t=await fetch("".concat(n,"/api/database/staged/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async processDocuments(e){let t=await fetch("".concat(n,"/api/database/process"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_ids:e})});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getProcessingProgress(e){let t=e?"".concat(n,"/api/database/progress/").concat(e):"".concat(n,"/api/database/progress"),a=await fetch(t);if(!a.ok)throw Error("API error: ".concat(a.statusText));return a.json()},async deleteDocument(e){let t=await fetch("".concat(n,"/api/database/documents/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async clearDatabase(){let e=await fetch("".concat(n,"/api/database/clear"),{method:"POST"});if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async reprocessDocumentChunks(e){let t=await fetch("".concat(n,"/api/database/documents/").concat(e,"/process/chunks"),{method:"POST"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async reprocessDocumentEntities(e){let t=await fetch("".concat(n,"/api/database/documents/").concat(e,"/process/entities"),{method:"POST"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getDocuments(){let e=await fetch("".concat(n,"/api/database/documents"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getHashtags(){let e=await fetch("".concat(n,"/api/database/hashtags"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getDocument(e){let t=await fetch("".concat(n,"/api/documents/").concat(e));if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getGraph(e){let t=new URLSearchParams;(null==e?void 0:e.community_id)!==void 0&&t.append("community_id",String(e.community_id)),(null==e?void 0:e.node_type)&&t.append("node_type",e.node_type),(null==e?void 0:e.level)!==void 0&&t.append("level",String(e.level)),(null==e?void 0:e.limit)!==void 0&&t.append("limit",String(e.limit)),(null==e?void 0:e.document_id)&&t.append("document_id",e.document_id);let a=t.toString(),r=await fetch("".concat(n,"/api/graph/clustered").concat(a?"?".concat(a):""));if(!r.ok)throw Error("API error: ".concat(r.statusText));return r.json()},async getDocumentChunks(e){let t=await fetch("".concat(n,"/api/documents/").concat(e,"/chunks"));if(!t.ok)throw Error("API error: ".concat(t.statusText));let a=await t.json();return Array.isArray(null==a?void 0:a.chunks)?a.chunks:[]},async getDocumentText(e){let t=await fetch("".concat(n,"/api/documents/").concat(e,"/text"));if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getDocumentChunkSimilarities(e){let t=await fetch("".concat(n,"/api/documents/").concat(e,"/similarities"));if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getDocumentPreview(e){let t=await fetch("".concat(n,"/api/documents/").concat(e,"/preview"),{redirect:"follow"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return(t.headers&&"function"==typeof t.headers.get&&t.headers.get("Content-Type")||"").includes("application/json")?t.json():t},async generateDocumentSummary(e){let t=await fetch("".concat(n,"/api/documents/").concat(e,"/generate-summary"),{method:"POST"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async updateDocumentHashtags(e,t){let a=await fetch("".concat(n,"/api/documents/").concat(e,"/hashtags"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashtags:t})});if(!a.ok)throw Error("API error: ".concat(a.statusText));return a.json()},async hasDocumentPreview(e){try{let t=await fetch("".concat(n,"/api/documents/").concat(e,"/preview"),{method:"HEAD",redirect:"follow"});if(t.ok)return!0;if(405===t.status){let t=await fetch("".concat(n,"/api/documents/").concat(e,"/preview"),{method:"GET",redirect:"follow",headers:{Range:"bytes=0-0"}});return t.ok||206===t.status}return!1}catch(e){return!1}},async getSettings(){let e=await fetch("".concat(n,"/api/health"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async checkHealth(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),a=await fetch("".concat(n,"/api/health"),{method:"GET",signal:e.signal});return clearTimeout(t),a.ok}catch(e){return!1}}}}}]);