(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3269:function(e,t,s){Promise.resolve().then(s.bind(s,8931))},8931:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return em}});var n=s(7437),a=s(2265),r=s(4887);let o="http://localhost:8000",i={async sendMessage(e,t){let s=await fetch("".concat(o,"/api/chat/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:null==t?void 0:t.signal});if(!s.ok)throw Error("API error: ".concat(s.statusText));return s},async getHistory(){let e=await fetch("".concat(o,"/api/history/sessions"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getConversation(e){let t=await fetch("".concat(o,"/api/history/").concat(e));if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async deleteConversation(e){let t=await fetch("".concat(o,"/api/history/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async clearHistory(){let e=await fetch("".concat(o,"/api/history/clear"),{method:"POST"});if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getStats(){let e=await fetch("".concat(o,"/api/database/stats"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async uploadFile(e){let t=new FormData;t.append("file",e);let s=await fetch("".concat(o,"/api/database/upload"),{method:"POST",body:t});if(!s.ok)throw Error("API error: ".concat(s.statusText));return s.json()},async stageFile(e){let t=new FormData;t.append("file",e);let s=await fetch("".concat(o,"/api/database/stage"),{method:"POST",body:t});if(!s.ok)throw Error("API error: ".concat(s.statusText));return s.json()},async getStagedDocuments(){let e=await fetch("".concat(o,"/api/database/staged"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async deleteStagedDocument(e){let t=await fetch("".concat(o,"/api/database/staged/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async processDocuments(e){let t=await fetch("".concat(o,"/api/database/process"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_ids:e})});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getProcessingProgress(e){let t=e?"".concat(o,"/api/database/progress/").concat(e):"".concat(o,"/api/database/progress"),s=await fetch(t);if(!s.ok)throw Error("API error: ".concat(s.statusText));return s.json()},async deleteDocument(e){let t=await fetch("".concat(o,"/api/database/documents/").concat(e),{method:"DELETE"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async clearDatabase(){let e=await fetch("".concat(o,"/api/database/clear"),{method:"POST"});if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async reprocessDocumentChunks(e){let t=await fetch("".concat(o,"/api/database/documents/").concat(e,"/process/chunks"),{method:"POST"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async reprocessDocumentEntities(e){let t=await fetch("".concat(o,"/api/database/documents/").concat(e,"/process/entities"),{method:"POST"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getDocuments(){let e=await fetch("".concat(o,"/api/database/documents"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getHashtags(){let e=await fetch("".concat(o,"/api/database/hashtags"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async getDocument(e){let t=await fetch("".concat(o,"/api/documents/").concat(e));if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getDocumentChunks(e){let t=await fetch("".concat(o,"/api/documents/").concat(e,"/chunks"));if(!t.ok)throw Error("API error: ".concat(t.statusText));let s=await t.json();return Array.isArray(null==s?void 0:s.chunks)?s.chunks:[]},async getDocumentText(e){let t=await fetch("".concat(o,"/api/documents/").concat(e,"/text"));if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async getDocumentPreview(e){let t=await fetch("".concat(o,"/api/documents/").concat(e,"/preview"),{redirect:"follow"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return(t.headers&&"function"==typeof t.headers.get&&t.headers.get("Content-Type")||"").includes("application/json")?t.json():t},async generateDocumentSummary(e){let t=await fetch("".concat(o,"/api/documents/").concat(e,"/generate-summary"),{method:"POST"});if(!t.ok)throw Error("API error: ".concat(t.statusText));return t.json()},async updateDocumentHashtags(e,t){let s=await fetch("".concat(o,"/api/documents/").concat(e,"/hashtags"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashtags:t})});if(!s.ok)throw Error("API error: ".concat(s.statusText));return s.json()},async hasDocumentPreview(e){try{let t=await fetch("".concat(o,"/api/documents/").concat(e,"/preview"),{method:"HEAD",redirect:"follow"});if(t.ok)return!0;if(405===t.status){let t=await fetch("".concat(o,"/api/documents/").concat(e,"/preview"),{method:"GET",redirect:"follow",headers:{Range:"bytes=0-0"}});return t.ok||206===t.status}return!1}catch(e){return!1}},async getSettings(){let e=await fetch("".concat(o,"/api/health"));if(!e.ok)throw Error("API error: ".concat(e.statusText));return e.json()},async checkHealth(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),s=await fetch("".concat(o,"/api/health"),{method:"GET",signal:e.signal});return clearTimeout(t),s.ok}catch(e){return!1}}};var l=s(27),c=s(834),d=s(3092),u=s(1300),m=s(5014),x=s(8906),h=s(4446),p=s(1513);let y=(0,s(9099).Ue)((e,t)=>({messages:[],sessionId:"",isHistoryLoading:!1,historyRefreshKey:0,activeView:"chat",selectedDocumentId:null,selectedChunkId:null,isConnected:!0,setIsConnected:t=>e({isConnected:t}),setSessionId:t=>e({sessionId:t}),setActiveView:t=>e({activeView:t}),notifyHistoryRefresh:()=>e(e=>({historyRefreshKey:e.historyRefreshKey+1})),clearChat:()=>{e({messages:[],sessionId:"",activeView:"chat",selectedDocumentId:null,selectedChunkId:null}),t().notifyHistoryRefresh()},selectDocument:t=>e({selectedDocumentId:t,activeView:"document",selectedChunkId:null}),selectDocumentChunk:(t,s)=>e({selectedDocumentId:t,activeView:"document",selectedChunkId:s}),clearSelectedDocument:()=>e({selectedDocumentId:null,selectedChunkId:null,activeView:"chat"}),clearSelectedChunk:()=>e({selectedChunkId:null}),addMessage:t=>e(e=>({messages:[...e.messages,t]})),updateLastMessage:t=>e(e=>{if(0===e.messages.length)return e;let s=[...e.messages],n=s.length-1;return s[n]=t(s[n]),{messages:s}}),replaceMessages:(t,s)=>e({messages:t,sessionId:s}),loadSession:async t=>{if(t){e({isHistoryLoading:!0});try{let s=await i.getConversation(t),n=(s.messages||[]).map(e=>({role:e.role,content:e.content,timestamp:e.timestamp,sources:e.sources||[],quality_score:e.quality_score||void 0,follow_up_questions:e.follow_up_questions||void 0,isStreaming:!1,context_documents:e.context_documents||void 0,context_document_labels:e.context_document_labels||void 0,context_hashtags:e.context_hashtags||void 0}));e({messages:n,sessionId:s.session_id||t})}catch(e){throw e}finally{e({isHistoryLoading:!1})}}}}));function g(e){let{sources:t}=e,[s,r]=(0,a.useState)(!1),[o,i]=(0,a.useState)(null),l=y(e=>e.selectDocumentChunk),c=(0,a.useMemo)(()=>{let e=new Map;return t.forEach(t=>{let s=t.original_filename||t.document_name||t.filename||"Unknown Document";if(!e.has(s)){let n=t.document_id||s;e.set(s,{documentName:s,documentId:n,chunks:[],avgSimilarity:0,entityCount:0})}let n=e.get(s);t.document_id&&n.documentId===s&&(n.documentId=t.document_id),n.chunks.push(t),t.entity_name&&n.entityCount++}),e.forEach(e=>{let t=e.chunks.map(e=>e.similarity||e.relevance_score||0).filter(e=>!isNaN(e)&&e>0);t.length>0?e.avgSimilarity=t.reduce((e,t)=>e+t,0)/t.length:e.avgSimilarity=0}),Array.from(e.values()).sort((e,t)=>t.avgSimilarity-e.avgSimilarity)},[t]),d=s?c:c.slice(0,3);return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("button",{onClick:()=>r(!s),className:"flex items-center text-sm font-medium text-secondary-700 dark:text-secondary-300 hover:text-secondary-900 dark:hover:text-secondary-100",children:[(0,n.jsx)(u.Z,{className:"w-4 h-4 mr-1"}),"Sources (",c.length," ",1===c.length?"document":"documents",")",s?(0,n.jsx)(m.Z,{className:"w-4 h-4 ml-1"}):(0,n.jsx)(x.Z,{className:"w-4 h-4 ml-1"})]}),(0,n.jsx)(h.M,{children:s&&(0,n.jsxs)(p.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:[.4,0,.2,1],opacity:{duration:.2}},className:"space-y-2 overflow-hidden",children:[d.map((e,t)=>(0,n.jsxs)("div",{className:"bg-secondary-50 dark:bg-secondary-800 rounded-lg p-3 cursor-pointer hover:bg-secondary-100 dark:hover:bg-secondary-700 transition-colors",onClick:()=>i(o===e.documentId?null:e.documentId),children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsx)("div",{className:"flex-1 min-w-0",children:(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-wrap md:flex-nowrap",children:[(0,n.jsx)("div",{className:"min-w-0 flex-1",children:(0,n.jsx)("span",{className:"block truncate text-sm font-medium text-secondary-900 dark:text-secondary-50",title:e.documentName,children:e.documentName})}),e.avgSimilarity>0&&(0,n.jsxs)("span",{className:"shrink-0 text-xs px-2 py-0.5 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded",children:[(100*e.avgSimilarity).toFixed(0),"% match"]}),(0,n.jsxs)("span",{className:"shrink-0 text-xs text-secondary-600 dark:text-secondary-400",children:[e.chunks.length," ",1===e.chunks.length?"chunk":"chunks"]}),e.entityCount>0&&(0,n.jsxs)("span",{className:"shrink-0 text-xs px-2 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded",children:[e.entityCount," ",1===e.entityCount?"entity":"entities"]})]})}),(0,n.jsx)("div",{children:o===e.documentId?(0,n.jsx)(m.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,n.jsx)(x.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"})})]}),(0,n.jsx)(h.M,{children:o===e.documentId&&(0,n.jsx)(p.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:[.4,0,.2,1],opacity:{duration:.2}},className:"mt-3 pt-3 border-t border-secondary-200 dark:border-secondary-700 space-y-2 overflow-hidden",children:e.chunks.map((t,s)=>{let a=t.similarity||t.relevance_score||0;return(0,n.jsxs)("div",{className:"bg-white dark:bg-secondary-700 rounded p-2 text-sm cursor-pointer hover:bg-secondary-50 dark:hover:bg-secondary-600 transition-colors",onClick:()=>{try{let s=new URLSearchParams(window.location.search);s.set("doc",e.documentId),void 0!==t.chunk_index?s.set("chunk",String(t.chunk_index)):t.chunk_id&&s.set("chunk_id",String(t.chunk_id));let n="".concat(window.location.pathname,"?").concat(s.toString());window.history.pushState({},"",n)}catch(e){}void 0!==t.chunk_index?l(e.documentId,t.chunk_index):t.chunk_id?l(e.documentId,t.chunk_id):l(e.documentId,0)},children:[(0,n.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 flex-wrap",children:[t.entity_name?(0,n.jsxs)("span",{className:"text-xs font-medium text-purple-700 dark:text-purple-300",children:["\uD83C\uDFF7️ Entity: ",t.entity_name]}):void 0!==t.chunk_index&&(0,n.jsxs)("span",{className:"text-xs text-secondary-600 dark:text-secondary-400",children:["Section ",t.chunk_index+1]}),!isNaN(a)&&a>0&&(0,n.jsxs)("span",{className:"text-xs text-secondary-600 dark:text-secondary-400",children:[(100*a).toFixed(0),"% relevance"]})]})}),(0,n.jsxs)("p",{className:"text-xs text-secondary-700 dark:text-secondary-300 whitespace-pre-wrap break-words line-clamp-3",children:[t.content.substring(0,200),t.content.length>200&&"..."]}),t.contained_entities&&t.contained_entities.length>0&&(0,n.jsxs)("div",{className:"mt-2 flex flex-wrap gap-1",children:[t.contained_entities.slice(0,5).map((e,t)=>(0,n.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-secondary-200 dark:bg-secondary-600 text-secondary-700 dark:text-secondary-200 rounded",children:e},t)),t.contained_entities.length>5&&(0,n.jsxs)("span",{className:"text-xs text-secondary-600 dark:text-secondary-400",children:["+",t.contained_entities.length-5," more"]})]})]},s)})},"doc-".concat(e.documentId))})]},e.documentId)),!s&&c.length>3&&(0,n.jsxs)("button",{onClick:()=>r(!0),className:"text-sm text-primary-600 hover:text-primary-700",children:["Show ",c.length-3," more documents"]})]},"sources-expanded")})]})}function f(e){var t,s;let{score:a}=e;return(0,n.jsxs)("div",{className:"inline-flex items-center space-x-2 text-xs",style:{transform:"translateY(-5px)"},children:[(0,n.jsx)("span",{children:(t=a.total)>=80?"\uD83D\uDFE2":t>=60?"\uD83D\uDFE1":"\uD83D\uDD34"}),(0,n.jsxs)("span",{className:"px-2 py-1 rounded-full font-medium ".concat((s=a.total)>=80?"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30":s>=60?"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/30":"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/30"),children:["Quality: ",a.total.toFixed(0),"%"]})]})}function b(e){let{message:t}=e,s="user"===t.role,a=t.context_document_labels&&t.context_document_labels.length>0?t.context_document_labels:t.context_documents;return(0,n.jsx)(p.E.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:[.4,0,.2,1]},className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"chat-message ".concat(s?"chat-message-user":"chat-message-assistant relative pr-4 pl-4"),children:[(0,n.jsx)("div",{className:s?"":"prose prose-sm prose-slate dark:prose-invert max-w-none dark:text-secondary-100",children:s?(0,n.jsx)("p",{className:"whitespace-pre-wrap",children:t.content}):(0,n.jsx)(l.UG,{remarkPlugins:[c.Z,d.Z],children:t.content})}),s&&Array.isArray(t.context_documents)&&t.context_documents.length>0&&a&&a.length>0&&(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsxs)("span",{className:"inline-flex flex-wrap items-center gap-1 rounded-lg bg-white dark:bg-secondary-800/15 px-3 py-1 text-xs text-white/90 max-w-full",children:[(0,n.jsx)("span",{className:"font-semibold uppercase tracking-wide text-white/70 shrink-0",children:t.context_hashtags&&t.context_hashtags.length>0?"".concat(t.context_hashtags.map(e=>e.startsWith("#")?e:"#".concat(e)).join(", "),":"):a&&a.length>1?"Documents:":"Document:"}),(0,n.jsx)("span",{className:"break-words",title:a.join(", "),children:a.join(", ")})]})}),t.isStreaming&&(0,n.jsx)(p.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex items-center mt-2 text-secondary-500 dark:text-secondary-400",children:(0,n.jsx)(p.E.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"w-3 h-3 bg-secondary-400 rounded-full"})}),!s&&(t.sources&&t.sources.length>0||t.quality_score)&&(0,n.jsxs)("div",{className:"mt-4 pt-4 border-t border-secondary-200 dark:border-secondary-700 relative",children:[t.sources&&t.sources.length>0?(0,n.jsx)("div",{className:"min-w-0",children:(0,n.jsx)(g,{sources:t.sources})}):null,t.quality_score&&void 0!==t.quality_score.total&&(0,n.jsx)("div",{className:t.sources&&t.sources.length>0?"absolute top-4 right-3 pointer-events-auto":"absolute bottom-3 right-3 pointer-events-auto",children:(0,n.jsx)(f,{score:t.quality_score})})]})]})})}var v=s(3499),w=s(9012),k=s(4573),j=s(8151),N=s(664);function _(e){let{onSend:t,onStop:s,disabled:r,isStreaming:o,userMessages:l=[]}=e,c=y(e=>e.isConnected),[d,u]=(0,a.useState)(""),[m,x]=(0,a.useState)([]),[h,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)([]),[b,_]=(0,a.useState)(!1),[C,S]=(0,a.useState)({}),[E,D]=(0,a.useState)([]),[L,I]=(0,a.useState)(null),[P,T]=(0,a.useState)(0),[A,M]=(0,a.useState)(!1),[F,U]=(0,a.useState)(!1),[q,Z]=(0,a.useState)(!1),[O,R]=(0,a.useState)(-1),[z,H]=(0,a.useState)(""),W=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=!0,t=async()=>{try{let t=await i.getHashtags(),s=Array.isArray(null==t?void 0:t.hashtags)?t.hashtags:[];e&&f(s)}catch(e){console.error("Failed to fetch hashtags:",e)}finally{e&&_(!0)}};return(async()=>{try{let t=await i.getDocuments(),s=Array.isArray(null==t?void 0:t.documents)?t.documents:[];e&&x(s)}catch(e){console.error("Failed to fetch documents:",e)}finally{e&&p(!0)}})(),t(),()=>{e=!1}},[]);let V=()=>{let e=W.current;e&&(e.style.height="auto",e.style.height="".concat(e.scrollHeight,"px"))};(0,a.useEffect)(()=>{V()},[d]);let G=(0,a.useMemo)(()=>Object.entries(C),[C]),K=(0,a.useMemo)(()=>{if(!L)return[];let e=L.query.toLowerCase();if("hashtag"===L.type)return e?g.filter(t=>t.toLowerCase().includes(e)).slice(0,8):g.slice(0,8);{let t=m.filter(e=>!C[e.document_id]);return e?t.filter(t=>(t.original_filename||t.filename).toLowerCase().includes(e)).slice(0,8):t.slice(0,8)}},[m,g,L,C]);(0,a.useEffect)(()=>{if(0===K.length){T(0);return}P>=K.length&&T(0)},[K,P]);let B=e=>{var t;if(!L||!W.current)return;let s=null!==(t=W.current.selectionStart)&&void 0!==t?t:d.length,n=d.slice(0,L.start),a=d.slice(s);u("".concat(n).concat(a)),S(t=>({...t,[e.document_id]:{filename:e.filename,original_filename:e.original_filename}})),I(null),M(!1),T(0),requestAnimationFrame(()=>{if(W.current){let e=n.length;W.current.focus(),W.current.setSelectionRange(e,e)}})},J=e=>{var t;if(!L||!W.current)return;let s=null!==(t=W.current.selectionStart)&&void 0!==t?t:d.length,n=d.slice(0,L.start),a=d.slice(s);u("".concat(n).concat(a)),D(t=>[...t,e]),I(null),M(!1),T(0),requestAnimationFrame(()=>{if(W.current){let e=n.length;W.current.focus(),W.current.setSelectionRange(e,e)}})},Q=e=>{(null==L?void 0:L.type)==="hashtag"&&"string"==typeof e?J(e):"object"==typeof e&&B(e)},Y=e=>{C[e]&&(S(t=>{let s={...t};return delete s[e],s}),I(null),M(!1),T(0))},X=e=>{D(t=>t.filter(t=>t!==e)),I(null),M(!1),T(0)},$=e=>{if(e.preventDefault(),!o&&d.trim()&&!r){let e=Object.keys(C),s=e.map(e=>{var t,s;return(null===(t=C[e])||void 0===t?void 0:t.original_filename)||(null===(s=C[e])||void 0===s?void 0:s.filename)}).filter(e=>!!e);E.length>0&&m.filter(e=>e.hashtags&&e.hashtags.some(e=>E.includes(e))).forEach(t=>{e.includes(t.document_id)||(e.push(t.document_id),s.push(t.original_filename||t.filename))}),t(d,e,s,E.length>0?E:void 0),u(""),R(-1),H(""),S({}),D([]),I(null),M(!1),T(0)}},ee=async e=>{Z(!0);try{for(let t of Array.from(e))await i.stageFile(t),(0,N.C)("success","".concat(t.name," uploaded"),"Document queued for processing");window.dispatchEvent(new CustomEvent("documents:uploaded"))}catch(e){console.error("Failed to stage file:",e),(0,N.C)("error","Upload failed",e instanceof Error?e.message:"Failed to upload file")}finally{Z(!1)}},et=async e=>{let t=e.target.files;t&&0!==t.length&&(await ee(t),e.target.value="")},es=async e=>{if(e.preventDefault(),e.stopPropagation(),U(!1),!c)return;let t=e.dataTransfer.getData("application/json");if(t)try{let e=JSON.parse(t);if("document"===e.type&&e.document_id){S(t=>({...t,[e.document_id]:{filename:e.filename,original_filename:e.filename}})),(0,N.C)("success","Document added to context","".concat(e.filename," will be used as context"));return}}catch(e){console.error("Failed to parse dragged document:",e)}let s=e.dataTransfer.files;s&&s.length>0&&await ee(s)};return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("form",{onSubmit:$,className:"relative",children:(0,n.jsxs)("div",{className:"relative transition-all ".concat(F?"ring-2 ring-primary-500 rounded-lg":""),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),c&&U(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),U(!1)},onDrop:es,children:[F&&(0,n.jsx)("div",{className:"absolute inset-0 bg-primary-50 dark:bg-primary-900/30 border-2 border-dashed border-primary-500 rounded-lg flex items-center justify-center z-10",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(w.Z,{className:"w-8 h-8 text-primary-600 dark:text-primary-400 mx-auto mb-2"}),(0,n.jsx)("p",{className:"text-sm font-medium text-primary-700 dark:text-primary-300",children:"Drop files to upload, or drop documents to add to context"})]})}),(G.length>0||E.length>0)&&(0,n.jsxs)("div",{className:"mb-2 flex flex-wrap items-center gap-2 pr-24",children:[(0,n.jsx)("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-secondary-500 dark:text-secondary-400",children:"Context"}),G.map(e=>{let[t,s]=e;return(0,n.jsxs)("span",{className:"inline-flex max-w-full items-center gap-2 rounded-full bg-primary-50 dark:bg-primary-900/30 px-3 py-1 text-xs text-primary-700 dark:text-primary-300",children:[(0,n.jsx)("span",{className:"truncate",title:s.original_filename||s.filename,children:s.original_filename||s.filename}),(0,n.jsx)("button",{type:"button",onClick:()=>Y(t),className:"rounded-full p-0.5 text-primary-600 dark:text-primary-400 transition hover:bg-primary-100 dark:hover:bg-primary-900/50 focus:outline-none focus:ring-1 focus:ring-primary-400","aria-label":"Remove ".concat(s.original_filename||s.filename," from forced context"),children:(0,n.jsx)(k.Z,{className:"h-3.5 w-3.5"})})]},t)}),E.map(e=>(0,n.jsxs)("span",{className:"inline-flex max-w-full items-center gap-2 rounded-full bg-green-50 px-3 py-1 text-xs text-green-700",children:[(0,n.jsx)("span",{className:"truncate",title:e,children:e.startsWith("#")?e:"#".concat(e)}),(0,n.jsx)("button",{type:"button",onClick:()=>X(e),className:"rounded-full p-0.5 text-green-600 transition hover:bg-green-100 focus:outline-none focus:ring-1 focus:ring-green-400","aria-label":"Remove ".concat(e," from forced context"),children:(0,n.jsx)(k.Z,{className:"h-3.5 w-3.5"})})]},e))]}),A&&(0,n.jsx)("div",{className:"absolute bottom-full left-0 right-24 mb-2 max-h-56 overflow-y-auto rounded-lg border border-secondary-200 dark:border-secondary-600 bg-white dark:bg-secondary-800 shadow-lg z-20",role:"listbox",children:(null==L?void 0:L.type)==="hashtag"?b?0===K.length?(0,n.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"No matching hashtags"}):K.map((e,t)=>(0,n.jsx)("button",{type:"button",role:"option","aria-selected":t===P,onMouseDown:t=>{t.preventDefault(),J(e)},className:"flex w-full items-center gap-3 px-3 py-2 text-left text-sm transition ".concat(t===P?"bg-primary-50 dark:bg-primary-900/40 text-primary-700 dark:text-primary-300":"hover:bg-secondary-100"),children:(0,n.jsx)("span",{className:"truncate",title:e,children:e.startsWith("#")?e:"#".concat(e)})},e)):(0,n.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"Loading hashtags..."}):h?0===K.length?(0,n.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"No matching documents"}):K.map((e,t)=>(0,n.jsxs)("button",{type:"button",role:"option","aria-selected":t===P,onMouseDown:t=>{t.preventDefault(),B(e)},className:"flex w-full items-center justify-between gap-3 px-3 py-2 text-left text-sm transition ".concat(t===P?"bg-primary-50 text-primary-700":"hover:bg-secondary-100"),children:[(0,n.jsx)("span",{className:"truncate",title:e.original_filename||e.filename,children:e.original_filename||e.filename}),"number"==typeof e.chunk_count&&(0,n.jsxs)("span",{className:"text-xs text-secondary-400 whitespace-nowrap",children:[e.chunk_count," chunks"]})]},e.document_id)):(0,n.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"Loading documents..."})}),(0,n.jsx)("textarea",{ref:W,value:d,onChange:e=>{var t;let s=e.target.value,n=null!==(t=e.target.selectionStart)&&void 0!==t?t:s.length;u(s);let a=s.slice(0,n),r=a.lastIndexOf("@"),o=a.lastIndexOf("#"),i=null;if(-1!==r&&r>o){let e=r>0?a[r-1]:"",t=a.slice(r+1),s=/\s/.test(t);(""===e||/\s/.test(e))&&!s&&!t.includes("@")&&(i={start:r,query:t,type:"document"})}else if(-1!==o){let e=o>0?a[o-1]:"",t=a.slice(o+1),s=/\s/.test(t);(""===e||/\s/.test(e))&&!s&&!t.includes("#")&&(i={start:o,query:t,type:"hashtag"})}i?(I(i),M(!0),T(0)):(I(null),M(!1))},onKeyDown:e=>{if(A){if("ArrowDown"===e.key&&K.length>0){e.preventDefault(),T(e=>(e+1)%K.length);return}if("ArrowUp"===e.key&&K.length>0){e.preventDefault(),T(e=>0===e?K.length-1:e-1);return}if(("Enter"===e.key||"Tab"===e.key)&&K.length>0&&L){e.preventDefault(),Q(K[P]);return}if("Escape"===e.key){e.preventDefault(),M(!1),I(null);return}}if("Enter"!==e.key||e.shiftKey){if("ArrowUp"===e.key){if(e.preventDefault(),l.length>0){-1===O&&H(d);let e=Math.min(O+1,l.length-1);R(e),u(l[l.length-1-e])}}else if("ArrowDown"===e.key&&(e.preventDefault(),O>-1)){let e=O-1;R(e),-1===e?u(z):u(l[l.length-1-e])}}else e.preventDefault(),$(e)},placeholder:c?"Ask a question about your documents... (@ for documents, # for tags)":"Server is offline - chat unavailable",disabled:r||o||q||!c,rows:1,className:"input-field pr-24 resize-none overflow-hidden disabled:opacity-50"}),(0,n.jsxs)("div",{className:"absolute right-3 bottom-3 flex items-center gap-2",style:{transform:"translateY(-1px)"},children:[(0,n.jsxs)("label",{className:"cursor-pointer p-2 text-secondary-400 hover:text-primary-600 transition-colors ".concat(r||o||q||!c?"opacity-50 pointer-events-none":""),children:[(0,n.jsx)("input",{type:"file",className:"hidden",onChange:et,disabled:r||o||q||!c,accept:".pdf,.txt,.md,.doc,.docx,.ppt,.pptx,.xls,.xlsx",multiple:!0}),(0,n.jsx)(w.Z,{className:"w-5 h-5"})]}),o?(0,n.jsxs)("button",{type:"button",onClick:s,className:"inline-flex items-center gap-1 rounded-md bg-rose-500 px-3 py-2 text-xs font-semibold text-white shadow-sm transition hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-400 focus:ring-offset-2",children:[(0,n.jsx)(j.Z,{className:"w-4 h-4"}),"Stop"]}):(0,n.jsx)("button",{type:"submit",disabled:r||!d.trim()||q||!c,className:"button-primary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,n.jsx)(v.Z,{className:"w-4 h-4"})})]})]})}),q&&(0,n.jsx)("div",{className:"absolute -top-8 left-0 right-0 text-center",children:(0,n.jsx)("span",{className:"text-xs text-secondary-600 bg-white dark:bg-secondary-800 px-2 py-1 rounded shadow-sm",children:"Uploading files..."})})]})}var C=s(8760);function S(e){let{questions:t,onQuestionClick:s}=e;return(0,n.jsxs)("div",{className:"mt-4 ml-0 animate-slide-up",children:[(0,n.jsxs)("div",{className:"flex items-center text-sm font-medium text-secondary-700 dark:text-secondary-300 mb-2",children:[(0,n.jsx)(C.Z,{className:"w-4 h-4 mr-1"}),"Follow-up questions"]}),(0,n.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,n.jsx)("button",{onClick:()=>s(e),className:"block w-full text-left px-4 py-3 bg-white dark:bg-secondary-800 border border-secondary-300 dark:border-secondary-600 rounded-lg hover:border-primary-500 dark:hover:border-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all duration-200 text-sm text-secondary-700 dark:text-secondary-300 hover:text-primary-700 dark:hover:text-primary-300 suggestion-shimmer",children:e},t))})]})}let E={query_analysis:{id:"query_analysis",label:"Analyzing Query",emoji:"\uD83D\uDD0D",color:"from-blue-500 to-cyan-500"},retrieval:{id:"retrieval",label:"Retrieving Documents",emoji:"\uD83D\uDCDA",color:"from-purple-500 to-pink-500"},graph_reasoning:{id:"graph_reasoning",label:"Graph Reasoning",emoji:"\uD83E\uDDE0",color:"from-indigo-500 to-purple-500"},generation:{id:"generation",label:"Generating Response",emoji:"✍️",color:"from-yellow-500 to-orange-500"},quality_calculation:{id:"quality_calculation",label:"Quality Check",emoji:"✅",color:"from-green-400 to-green-600"},suggestions:{id:"suggestions",label:"Preparing Suggestions",emoji:"\uD83D\uDCA1",color:"from-pink-500 to-rose-500"}};function D(e){let{currentStage:t="query_analysis",completedStages:s=[],isLoading:r=!0,enableQualityScoring:o=!0}=e,[i,l]=(0,a.useState)(t),[c,d]=(0,a.useState)(s);(0,a.useEffect)(()=>{r&&t&&(l(t),d(e=>e.includes(t)?e:[...e,t]))},[t,r]),(0,a.useEffect)(()=>{!r&&s.length>0&&(d(s),l(s[s.length-1]))},[s,r]);let u=e=>("quality_calculation"!==e||!!o)&&c.includes(e),m=E[i]||E.query_analysis,x=r?c.slice(0,-1).length:c.length;return(c.length,Object.keys(E).length,r)?(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)("style",{children:"\n        @keyframes pulse-glow {\n          0%, 100% {\n            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);\n          }\n          50% {\n            box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);\n          }\n        }\n\n        @keyframes slide-in {\n          from {\n            opacity: 0;\n            transform: translateX(-10px);\n          }\n          to {\n            opacity: 1;\n            transform: translateX(0);\n          }\n        }\n\n        @keyframes bounce-smooth {\n          0%, 100% {\n            transform: translateY(0);\n          }\n          50% {\n            transform: translateY(-4px);\n          }\n        }\n\n        @keyframes shimmer {\n          0% {\n            background-position: -1000px 0;\n          }\n          100% {\n            background-position: 1000px 0;\n          }\n        }\n\n        .animate-pulse-glow {\n          animation: pulse-glow 2s infinite;\n        }\n\n        .animate-slide-in {\n          animation: slide-in 0.3s ease-out;\n        }\n\n        .animate-bounce-smooth {\n          animation: bounce-smooth 1.5s ease-in-out infinite;\n        }\n\n        .animate-shimmer {\n          background: linear-gradient(\n            90deg,\n            rgba(255, 255, 255, 0) 0%,\n            rgba(255, 255, 255, 0.3) 50%,\n            rgba(255, 255, 255, 0) 100%\n          );\n          background-size: 1000px 100%;\n          animation: shimmer 2s infinite;\n        }\n      "}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 animate-slide-in",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:"w-3 h-3 bg-primary-500 rounded-full animate-pulse-glow"}),(0,n.jsx)("div",{className:"absolute inset-0 w-3 h-3 bg-primary-500 rounded-full opacity-30"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-lg animate-bounce-smooth",children:m.emoji}),(0,n.jsx)("span",{className:"text-sm font-medium text-secondary-700 dark:text-secondary-300",children:m.label})]})]}),(0,n.jsx)("div",{className:"relative h-1 bg-secondary-200 dark:bg-secondary-700 rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r ".concat(m.color," animate-shimmer transition-all duration-500 ease-out"),style:{width:"".concat((x+1)/Object.keys(E).length*100,"%")}})}),(0,n.jsx)("div",{className:"flex gap-2 items-center justify-center py-2",children:Object.values(E).map(e=>{let t=u(e.id),s=e.id===i;return(0,n.jsxs)("div",{className:"cursor-help group relative transition-all duration-300",title:e.label,children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full transition-all duration-300 ".concat(t?"bg-green-500 scale-100":s?"bg-primary-500 dark:bg-primary-400 scale-125 animate-pulse-glow":"bg-secondary-300 dark:bg-secondary-600 scale-75")}),(0,n.jsx)("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-secondary-800 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.label})]},e.id)})}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-1 text-xs text-secondary-500 dark:text-secondary-400",children:[(0,n.jsx)("span",{children:"Processing"}),(0,n.jsxs)("span",{className:"inline-flex gap-0.5",children:[(0,n.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"•"}),(0,n.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.15s"},children:"•"}),(0,n.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.3s"},children:"•"})]})]})]})]}):(0,n.jsxs)("div",{className:"w-full space-y-2",children:[(0,n.jsx)("div",{className:"relative h-1 bg-secondary-200 rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-green-400 to-green-600",style:{width:"100%"}})}),(0,n.jsx)("div",{className:"flex gap-2 items-center justify-center py-2",children:Object.values(E).map(e=>{let t=u(e.id);return(0,n.jsxs)("div",{className:"cursor-help group relative",title:e.label,children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full transition-all duration-300 ".concat(t?"bg-green-500":"bg-secondary-300")}),(0,n.jsx)("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-secondary-800 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.label})]},e.id)})})]})}var L=s(2412);function I(){return y(e=>e.isConnected)?null:(0,n.jsxs)("div",{className:"flex items-center justify-center gap-3 px-4 py-3 bg-red-50 dark:bg-red-900/30 border-b border-red-200 dark:border-red-800",children:[(0,n.jsx)(L.Z,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Unable to connect to server"}),(0,n.jsx)("p",{className:"text-xs text-red-700 dark:text-red-300",children:"Chat is currently unavailable. Please check your connection and try again."})]}),(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsxs)("div",{className:"inline-flex items-center gap-1.5",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-600 dark:bg-red-400 animate-pulse"}),(0,n.jsx)("span",{className:"text-xs font-medium text-red-600 dark:text-red-400",children:"Offline"})]})})]})}function P(){var e;let t=y(e=>e.messages),s=y(e=>e.sessionId),o=y(e=>e.addMessage),l=y(e=>e.updateLastMessage),c=y(e=>e.setSessionId),d=y(e=>e.clearChat),u=y(e=>e.notifyHistoryRefresh),m=y(e=>e.isHistoryLoading),x=y(e=>e.isConnected),h=y(e=>e.setIsConnected),[p,g]=(0,a.useState)(!1),f=(0,a.useRef)(null),v=(0,a.useRef)(null),[w,k]=(0,a.useState)("query_analysis"),[j,N]=(0,a.useState)([]),[C,E]=(0,a.useState)(null),[L,P]=(0,a.useState)({chunk_weight:.6,entity_weight:.4,path_weight:.6,max_hops:2,beam_size:8,graph_expansion_depth:2,restrict_to_context:!0}),[T,A]=(0,a.useState)(!1),M=(0,a.useRef)(null),F=()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,a.useEffect)(()=>{F()},[t]),(0,a.useEffect)(()=>{(async()=>{try{let e=await i.getSettings();E(e),P(t=>{var s,n,a,r,o,i,l;return{...t,chunk_weight:null!==(s=null==e?void 0:e.hybrid_chunk_weight)&&void 0!==s?s:t.chunk_weight,entity_weight:null!==(n=null==e?void 0:e.hybrid_entity_weight)&&void 0!==n?n:t.entity_weight,path_weight:null!==(a=null==e?void 0:e.hybrid_path_weight)&&void 0!==a?a:t.path_weight,max_hops:null!==(r=null==e?void 0:e.multi_hop_max_hops)&&void 0!==r?r:t.max_hops,beam_size:null!==(o=null==e?void 0:e.multi_hop_beam_size)&&void 0!==o?o:t.beam_size,graph_expansion_depth:null!==(i=null==e?void 0:e.max_expansion_depth)&&void 0!==i?i:t.graph_expansion_depth,restrict_to_context:null!==(l=null==e?void 0:e.default_context_restriction)&&void 0!==l?l:t.restrict_to_context}})}catch(e){console.error("Failed to fetch settings:",e)}})()},[]),(0,a.useEffect)(()=>{let e=!1,t=e=>{M.current&&clearTimeout(M.current),M.current=setTimeout(s,e)},s=async()=>{if(e)return;let s=await i.checkHealth();h(s),t(s?3e4:5e3)};return s(),()=>{e=!0,M.current&&clearTimeout(M.current)}},[h]),(0,a.useEffect)(()=>{x&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("server:reconnected"))},[x]);let U=()=>{v.current&&v.current.abort()},q=(e,t)=>{P(s=>({...s,[e]:t}))},Z=(0,a.useCallback)(()=>{U(),k("query_analysis"),N([]),d()},[d]);(0,a.useEffect)(()=>{let e=e=>{"n"!==e.key||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),Z())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[Z]);let O=async(e,t,n,a)=>{if(!e.trim()||p||m)return;k("query_analysis"),N([]),o({role:"user",content:e,timestamp:new Date().toISOString(),context_documents:t,context_document_labels:n,context_hashtags:a}),g(!0);let d="",x="",h=[],y=null,f=[],b=s,w=!1,j=null,_=[],C=[...t],S=new Map;t.forEach((e,t)=>{let s=n[t];s&&S.set(e,s)});let E=[...n],D=()=>{if(_.length>0){let e=Math.ceil(_.length/3)||1,t=_.splice(0,e).join("");x+=t,l(e=>({...e,content:x}))}_.length>0||!w?j=requestAnimationFrame(D):w&&d!==x&&(x=d,l(e=>({...e,content:x,isStreaming:!1,sources:h,quality_score:y,follow_up_questions:f})))};try{o({role:"assistant",content:"",isStreaming:!0});let m=new AbortController;v.current=m;let p=await i.sendMessage({message:e,session_id:s,stream:!0,context_documents:t,context_document_labels:n,context_hashtags:a,chunk_weight:L.chunk_weight,entity_weight:L.entity_weight,path_weight:L.path_weight,max_hops:L.max_hops,beam_size:L.beam_size,graph_expansion_depth:L.graph_expansion_depth,restrict_to_context:L.restrict_to_context},{signal:m.signal});if(!p.body)throw Error("No response body");j=requestAnimationFrame(D);let g=p.body.getReader(),I=new TextDecoder;for(;;){let{done:e,value:t}=await g.read();if(e)break;for(let e of I.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));if(console.log("Received SSE data:",t),"token"===t.type)d+=t.content,_.push(t.content);else if("stage"===t.type)console.log("Received stage:",t.content),(0,r.flushSync)(()=>{k(t.content),N(e=>e.includes(t.content)?e:[...e,t.content])});else if("sources"===t.type)h=t.content;else if("quality_score"===t.type)y=t.content;else if("follow_ups"===t.type)f=t.content;else if("metadata"===t.type)b=t.content.session_id,Array.isArray(t.content.context_documents)&&(C=t.content.context_documents,E=t.content.context_documents.map(e=>S.get(e)||e));else if("done"===t.type)w=!0;else if("error"===t.type)throw Error(t.content)}catch(e){console.error("Error parsing SSE data:",e)}}w=!0,await new Promise(e=>{let t=()=>{0===_.length&&x===d?e(null):setTimeout(t,50)};t()}),l(e=>({...e,content:d,isStreaming:!1,sources:h,quality_score:y,follow_up_questions:f,context_documents:C,context_document_labels:E})),b&&!s&&c(b),u()}catch(e){null!==j&&cancelAnimationFrame(j),e instanceof DOMException&&"AbortError"===e.name?(w=!0,await new Promise(e=>setTimeout(e,100)),l(e=>({...e,content:d||x||e.content||"",isStreaming:!1,sources:h.length>0?h:e.sources,quality_score:null!=y?y:e.quality_score,follow_up_questions:f.length>0?f:e.follow_up_questions,context_documents:C,context_document_labels:E}))):(console.error("Error sending message:",e),l(()=>({role:"assistant",content:"Sorry, I encountered an error processing your request. Please try again.",isStreaming:!1,context_documents:C,context_document_labels:E})))}finally{null!==j&&cancelAnimationFrame(j),v.current=null,g(!1)}},R=e=>{O(e,[],[])},z=t.filter(e=>"user"===e.role).map(e=>e.content);return(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsx)(I,{}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:0===t.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-primary-100 dark:bg-primary-900/40 rounded-full flex items-center justify-center mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-primary-500 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),(0,n.jsx)("h2",{className:"text-xl font-semibold text-secondary-700 dark:text-secondary-300 mb-2",children:"Start a Conversation"}),(0,n.jsx)("p",{className:"text-secondary-500 dark:text-secondary-400 max-w-md",children:"Upload some documents and start asking questions. I'll help you find relevant information and provide intelligent answers."})]}):(0,n.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[t.map((e,s)=>{var a;return(0,n.jsxs)("div",{children:[(0,n.jsx)(b,{message:e}),"assistant"===e.role&&!e.isStreaming&&e.follow_up_questions&&e.follow_up_questions.length>0&&s===t.length-1&&(0,n.jsx)(S,{questions:e.follow_up_questions,onQuestionClick:R}),"assistant"===e.role&&!e.isStreaming&&s===t.length-1&&j.length>0&&(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)(D,{currentStage:j[j.length-1],completedStages:j,isLoading:!1,enableQualityScoring:null===(a=null==C?void 0:C.enable_quality_scoring)||void 0===a||a})})]},s)}),(p||m)&&(0,n.jsx)(D,{currentStage:w,completedStages:j,isLoading:p||m,enableQualityScoring:null===(e=null==C?void 0:C.enable_quality_scoring)||void 0===e||e}),(0,n.jsx)("div",{ref:f})]})}),(0,n.jsx)("div",{className:"border-t border-secondary-200 dark:border-secondary-700 bg-white dark:bg-secondary-800 px-6 py-4",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[(0,n.jsxs)("details",{className:"rounded-lg border border-secondary-200 dark:border-secondary-600 bg-secondary-50 dark:bg-secondary-900 p-4",open:T,onToggle:e=>A(e.currentTarget.open),children:[(0,n.jsx)("summary",{className:"cursor-pointer font-semibold text-secondary-900 dark:text-white",children:"Advanced retrieval settings"}),(0,n.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,n.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Chunk weight",(0,n.jsx)("input",{type:"number",min:0,max:1,step:.05,value:L.chunk_weight,onChange:e=>q("chunk_weight",parseFloat(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,n.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Entity weight",(0,n.jsx)("input",{type:"number",min:0,max:1,step:.05,value:L.entity_weight,onChange:e=>q("entity_weight",parseFloat(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,n.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Path weight",(0,n.jsx)("input",{type:"number",min:0,max:1,step:.05,value:L.path_weight,onChange:e=>q("path_weight",parseFloat(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,n.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Multi-hop depth (hops)",(0,n.jsx)("input",{type:"number",min:1,max:5,step:1,value:L.max_hops,onChange:e=>q("max_hops",parseInt(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,n.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Beam size",(0,n.jsx)("input",{type:"number",min:1,max:32,step:1,value:L.beam_size,onChange:e=>q("beam_size",parseInt(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,n.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Graph expansion depth",(0,n.jsx)("input",{type:"number",min:1,max:5,step:1,value:L.graph_expansion_depth,onChange:e=>q("graph_expansion_depth",parseInt(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2 text-sm text-secondary-800 dark:text-secondary-200",children:[(0,n.jsx)("input",{type:"checkbox",checked:L.restrict_to_context,onChange:e=>q("restrict_to_context",e.target.checked),className:"h-4 w-4 rounded border-secondary-300 text-primary-600 focus:ring-primary-500"}),"Restrict retrieval to selected context"]})]})]}),(0,n.jsx)(_,{onSend:O,onStop:U,disabled:m,isStreaming:p,userMessages:z})]})})]})}var T=s(6514),A=s(4380),M=s(2863),F=s(9442),U=s(8431),q=s(301),Z=s(5896),O=s(2238),R=s(2266),z=s(1581);let H=e=>{var t;return null!==(t=null==e?void 0:e.includes("pdf"))&&void 0!==t&&t},W=e=>{var t;return null!==(t=null==e?void 0:e.startsWith("image/"))&&void 0!==t&&t},V=e=>{var t;return null!==(t=(null==e?void 0:e.includes("markdown"))||(null==e?void 0:e.includes("text/markdown"))||(null==e?void 0:e.includes("text/x-markdown")))&&void 0!==t&&t},G=e=>!!e&&"text/plain"===e,K=e=>!!e&&(e.includes("officedocument")||e.includes("ms-word")||e.includes("ms-excel")||e.includes("ms-powerpoint")||e.includes("application/vnd.ms-")||"application/msword"===e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===e);function B(e){let t,{previewUrl:s,mimeType:r,content:o,onClose:i}=e,[l,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(null==i||i())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[i]),(0,a.useEffect)(()=>{(o||s)&&(u(!0),(async()=>{try{let e=o;if(!e&&s){let t=await fetch(s);if(!t.ok)throw Error("Failed to fetch content");e=await t.text()}if(!e){c("<p>No content available</p>"),u(!1);return}let t=await (0,R.TU)(e),n=z.Z.sanitize(t);c("<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document Preview</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;\n      line-height: 1.6;\n      color: #1f2937;\n      background: #fff;\n      padding: 2rem;\n      max-width: 900px;\n      margin: 0 auto;\n    }\n    \n    @media (prefers-color-scheme: dark) {\n      body {\n        background: #1f2937;\n        color: #f3f4f6;\n      }\n      \n      a {\n        color: #60a5fa;\n      }\n      \n      a:visited {\n        color: #a78bfa;\n      }\n      \n      code {\n        background: #111827 !important;\n        color: #e5e7eb;\n      }\n      \n      pre {\n        background: #111827 !important;\n        color: #e5e7eb;\n      }\n      \n      blockquote {\n        border-left-color: #4b5563;\n        color: #d1d5db;\n      }\n      \n      table {\n        border-color: #4b5563;\n      }\n      \n      th, td {\n        border-color: #4b5563;\n      }\n    }\n    \n    h1, h2, h3, h4, h5, h6 {\n      margin-top: 1.5rem;\n      margin-bottom: 1rem;\n      font-weight: 600;\n    }\n    \n    h1 {\n      font-size: 2rem;\n      border-bottom: 2px solid #e5e7eb;\n      padding-bottom: 0.5rem;\n    }\n    \n    @media (prefers-color-scheme: dark) {\n      h1 {\n        border-bottom-color: #4b5563;\n      }\n    }\n    \n    h2 {\n      font-size: 1.5rem;\n    }\n    \n    h3 {\n      font-size: 1.25rem;\n    }\n    \n    p {\n      margin-bottom: 1rem;\n    }\n    \n    a {\n      color: #2563eb;\n      text-decoration: none;\n    }\n    \n    a:hover {\n      text-decoration: underline;\n    }\n    \n    code {\n      background: #f3f4f6;\n      padding: 0.2rem 0.4rem;\n      border-radius: 3px;\n      font-family: 'Monaco', 'Courier New', monospace;\n      font-size: 0.9em;\n    }\n    \n    pre {\n      background: #f3f4f6;\n      padding: 1rem;\n      border-radius: 5px;\n      overflow-x: auto;\n      margin-bottom: 1rem;\n      font-family: 'Monaco', 'Courier New', monospace;\n    }\n    \n    pre code {\n      background: none;\n      padding: 0;\n      border-radius: 0;\n    }\n    \n    blockquote {\n      border-left: 4px solid #e5e7eb;\n      padding-left: 1rem;\n      margin-left: 0;\n      margin-bottom: 1rem;\n      color: #6b7280;\n    }\n    \n    ul, ol {\n      margin-left: 2rem;\n      margin-bottom: 1rem;\n    }\n    \n    li {\n      margin-bottom: 0.5rem;\n    }\n    \n    table {\n      border-collapse: collapse;\n      width: 100%;\n      margin-bottom: 1rem;\n      border: 1px solid #e5e7eb;\n    }\n    \n    th, td {\n      border: 1px solid #e5e7eb;\n      padding: 0.75rem;\n      text-align: left;\n    }\n    \n    th {\n      background: #f9fafb;\n      font-weight: 600;\n    }\n    \n    @media (prefers-color-scheme: dark) {\n      th {\n        background: #111827;\n      }\n    }\n    \n    img {\n      max-width: 100%;\n      height: auto;\n      margin: 1rem 0;\n    }\n    \n    hr {\n      border: none;\n      border-top: 1px solid #e5e7eb;\n      margin: 2rem 0;\n    }\n  </style>\n</head>\n<body>\n".concat(n,"\n</body>\n</html>"))}catch(e){console.error("Failed to process markdown:",e),c("<p>Failed to process markdown content</p>")}finally{u(!1)}})())},[o,s]);return(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:(0,n.jsxs)("div",{className:"relative w-full max-w-5xl bg-white dark:bg-secondary-800 rounded-xl shadow-2xl overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-secondary-200 dark:border-secondary-700 px-4 py-3 bg-secondary-50 dark:bg-secondary-700",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:"Document Preview"}),(0,n.jsx)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:"Press Escape to close"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,n.jsxs)("a",{href:s,target:"_blank",rel:"noreferrer",className:"button-ghost text-xs flex items-center gap-1",children:[(0,n.jsx)(O.Z,{className:"w-4 h-4"}),"Open in new tab"]}),(0,n.jsxs)("button",{type:"button",onClick:i,className:"button-secondary text-xs flex items-center gap-1",children:[(0,n.jsx)(k.Z,{className:"w-4 h-4"}),"Close"]})]})]}),(0,n.jsx)("div",{className:"h-[70vh] bg-secondary-100 dark:bg-secondary-900 p-4 overflow-auto",children:d?(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsx)("div",{className:"text-secondary-600 dark:text-secondary-400",children:"Processing markdown..."})}):l?V(r)||G(r)?(0,n.jsx)("iframe",{srcDoc:l,title:"Markdown preview",className:"w-full h-full border-none rounded-lg",sandbox:"allow-same-origin"}):s?H(r)?(0,n.jsx)("iframe",{src:s,title:"PDF preview",className:"w-full h-full rounded-lg border border-secondary-200"}):W(r)?(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsx)("img",{src:s,alt:"Document preview",className:"max-h-full max-w-full rounded-lg shadow"})}):K(r)&&(s.startsWith("http://")||s.startsWith("https://"))?(0,n.jsxs)("div",{className:"w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-sm text-yellow-800",children:[(0,n.jsx)("p",{className:"font-medium",children:"Office Document Viewer"}),(0,n.jsx)("p",{className:"text-xs mt-1",children:"Using Microsoft Office Online viewer. If the document doesn't load, try opening it in a new tab or downloading it."})]}),(0,n.jsx)("iframe",{src:(t=s,"https://view.officeapps.live.com/op/embed.aspx?src=".concat(encodeURIComponent(t))),title:"Office document preview",className:"w-full h-[calc(100%-5rem)] rounded-lg border border-secondary-200"})]}):(0,n.jsx)("iframe",{src:s,title:"Document preview",className:"w-full h-full rounded-lg border border-secondary-200 dark:border-secondary-600 bg-white dark:bg-secondary-800"}):(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsx)("div",{className:"text-secondary-600 dark:text-secondary-400",children:"Unable to preview this document"})}):(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsx)("div",{className:"text-secondary-600 dark:text-secondary-400",children:"No content available"})})})]})})}let J={url:null,isLoading:!1,mimeType:void 0,error:null,objectUrl:null,content:null};function Q(){var e,t,s,r,o,m,x;let g=y(e=>e.selectedDocumentId),f=y(e=>e.selectedChunkId),b=y(e=>e.clearSelectedDocument),v=y(e=>e.clearSelectedChunk),w=y(e=>e.selectDocument),[k,j]=(0,a.useState)(null),[N,_]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[E,D]=(0,a.useState)(null),[L,I]=(0,a.useState)({}),[P,O]=(0,a.useState)(J),[R,z]=(0,a.useState)(!1),[H,W]=(0,a.useState)({}),[V,G]=(0,a.useState)(null),[K,Q]=(0,a.useState)(null),[Y,X]=(0,a.useState)(null),[$,ee]=(0,a.useState)(!1),et=(0,a.useRef)(!1),[es,en]=(0,a.useState)(!1),[ea,er]=(0,a.useState)(""),[eo,ei]=(0,a.useState)(null),[el,ec]=(0,a.useState)(!1),[ed,eu]=(0,a.useState)(!1),[em,ex]=(0,a.useState)(!1),eh=(0,a.useCallback)(async()=>{try{let e=await i.getProcessingProgress();G(e.global)}catch(e){console.error("Failed to load processing state",e)}},[]),ep=(0,a.useCallback)(async()=>{try{let e=await i.getSettings();ei(e)}catch(e){console.error("Failed to load settings",e)}},[]);(0,a.useEffect)(()=>{try{let e=new URLSearchParams(window.location.search),t=e.get("doc"),s=e.get("chunk"),n=e.get("chunk_id");if(t){if(g&&g===t||w(t),s){let e=Number(s);if(!Number.isNaN(e)){let s=y.getState&&y.getState().selectDocumentChunk||null;s&&s(t,e)}}else if(n){let e=y.getState&&y.getState().selectDocumentChunk||null;e&&e(t,n)}}}catch(e){}},[]),(0,a.useEffect)(()=>{let e=!0,t=async t=>{S(!0),D(null),j(null),O(J),z(!1),W({});try{let s=await i.getDocument(t);e&&(j(s),_(null))}catch(t){e&&D(t instanceof Error?t.message:"Failed to load document")}finally{e&&S(!1)}};g?(t(g),eh(),ep()):(j(null),O(J),z(!1),W({}),_(null),G(null),ei(null));let s=()=>{g&&(t(g),eh())},n=()=>{eh()};return window.addEventListener("documents:processed",s),window.addEventListener("documents:processing-updated",n),()=>{e=!1,window.removeEventListener("documents:processed",s),window.removeEventListener("documents:processing-updated",n)}},[eh,ep,g]),(0,a.useEffect)(()=>{let e=!0;return(async()=>{if(k)try{let t=await i.hasDocumentPreview(k.id);e&&_(t)}catch(t){e&&_(!1)}})(),()=>{e=!1}},[k]),(0,a.useEffect)(()=>{if(null!==f&&k){let e=k.chunks.find(e=>e.index===f||e.id===f);e&&I(t=>({...t,[e.id]:!0})),v()}},[f,k,v]),(0,a.useEffect)(()=>()=>{P.objectUrl&&URL.revokeObjectURL(P.objectUrl)},[P.objectUrl]);let ey=(0,a.useMemo)(()=>{var e;return(null==k?void 0:null===(e=k.entities)||void 0===e?void 0:e.length)?k.entities.reduce((e,t)=>{let s=t.type||"Unknown";return e[s]||(e[s]=[]),e[s].push(t),e},{}):{}},[null==k?void 0:k.entities]),eg=(0,a.useMemo)(()=>{var e,t;if(!k)return!1;let s=(null===(e=k.mime_type)||void 0===e?void 0:e.toLowerCase())||"";if(new Set(["text/markdown","text/x-markdown","text/md","text/x-md","application/markdown"]).has(s))return!0;let n=(null===(t=k.file_name)||void 0===t?void 0:t.toLowerCase())||"";return n.endsWith(".md")||n.endsWith(".markdown")},[k]),ef=(0,a.useCallback)(e=>{I(t=>({...t,[e.id]:!t[e.id]}))},[]),eb=(0,a.useCallback)(async e=>{try{await navigator.clipboard.writeText(e.text)}catch(e){console.error("Failed to copy chunk",e)}},[]),ev=(0,a.useCallback)(async()=>{if(g){if(P.objectUrl&&URL.revokeObjectURL(P.objectUrl),null==k?void 0:k.preview_url){O({url:k.preview_url,mimeType:k.mime_type,isLoading:!1,error:null});return}O({url:null,mimeType:void 0,isLoading:!0,error:null,objectUrl:null,content:null});try{let e=await i.getDocumentPreview(g);if("preview_url"in e){O({url:e.preview_url,mimeType:null==k?void 0:k.mime_type,isLoading:!1,error:null});return}if("content"in e){let t=e.mime_type||(null==k?void 0:k.mime_type),s=e.content;O({url:null,mimeType:t,isLoading:!1,error:null,objectUrl:null,content:s});return}if("object_url"in e){O({url:e.object_url,mimeType:e.mime_type,isLoading:!1,error:null,objectUrl:e.object_url});return}throw Error("Unexpected response format from preview endpoint")}catch(e){O({url:null,mimeType:void 0,isLoading:!1,error:e instanceof Error?e.message:"Unable to load preview",objectUrl:null}),console.error("Failed to load preview",e)}}},[null==k?void 0:k.mime_type,null==k?void 0:k.preview_url,P.objectUrl,g]),ew=(0,a.useCallback)(()=>{P.objectUrl&&URL.revokeObjectURL(P.objectUrl),O(J)},[P.objectUrl]),ek=(0,a.useCallback)(async()=>{if(null==k?void 0:k.id){ee(!0),X(null),Q(null);try{await i.reprocessDocumentChunks(k.id),Q("Chunk processing queued"),await eh(),window.dispatchEvent(new CustomEvent("documents:processing-updated"))}catch(e){X(e instanceof Error?e.message:"Failed to queue chunk processing")}finally{ee(!1)}}},[null==k?void 0:k.id,eh]),ej=(0,a.useCallback)(async()=>{if(null==k?void 0:k.id){ee(!0),X(null),Q(null);try{await i.reprocessDocumentEntities(k.id),Q("Entity extraction queued"),await eh(),window.dispatchEvent(new CustomEvent("documents:processing-updated"))}catch(e){X(e instanceof Error?e.message:"Failed to queue entity extraction")}finally{ee(!1)}}},[null==k?void 0:k.id,eh]),eN=(0,a.useCallback)(async()=>{if(null==k?void 0:k.id){ee(!0),X(null),Q(null);try{await i.generateDocumentSummary(k.id),Q("Summary generated successfully");let e=await i.getDocument(k.id);j(e)}catch(e){X(e instanceof Error?e.message:"Failed to generate summary")}finally{ee(!1)}}},[null==k?void 0:k.id]),e_=(0,a.useCallback)(()=>{er(""),en(!0)},[]),eC=(0,a.useCallback)(async e=>{if(null==k?void 0:k.id){X(null);try{await i.updateDocumentHashtags(k.id,e);let t=await i.getDocument(k.id);j(t)}catch(e){X(e instanceof Error?e.message:"Failed to update hashtags")}}},[null==k?void 0:k.id]),eS=(0,a.useCallback)(async e=>{if(!(null==k?void 0:k.hashtags))return;let t=k.hashtags.filter(t=>t!==e);await eC(t)},[null==k?void 0:k.hashtags,eC]),eE=(0,a.useCallback)(async()=>{let e=ea.trim();if(!e)return;e.startsWith("#")||(e="#"+e);let t=(null==k?void 0:k.hashtags)||[];if(t.includes(e)){er("");return}let s=[...t,e];await eC(s),er("")},[ea,null==k?void 0:k.hashtags,eC]),eD=(0,a.useCallback)(e=>{"Enter"===e.key&&(e.preventDefault(),eE())},[eE]);(0,a.useEffect)(()=>{if(!K)return;let e=window.setTimeout(()=>Q(null),4e3);return()=>window.clearTimeout(e)},[K]),(0,a.useEffect)(()=>{if(!Y)return;let e=window.setTimeout(()=>X(null),5e3);return()=>window.clearTimeout(e)},[Y]),(0,a.useEffect)(()=>{let e=!!(null==V?void 0:V.is_processing),t=et.current;if(et.current=e,e&&g){let e=window.setInterval(()=>{eh(),(async()=>{try{let e=await i.getDocument(g);j(e)}catch(e){console.error("Failed to refresh document during processing:",e)}})()},2e3);return()=>window.clearInterval(e)}t&&!e&&window.dispatchEvent(new CustomEvent("documents:processed"))},[null==V?void 0:V.is_processing,eh,g]);let eL=$||!!(null==V?void 0:V.is_processing),eI=(null==V?void 0:V.is_processing)?"Processing is already running for another document":void 0,eP=(null==eo?void 0:eo.enable_entity_extraction)===!1,eT=eL||eP,eA=eP?"Entity extraction is deactivated in settings":eI,eM=(0,a.useCallback)(e=>{e.id&&w(e.id)},[w]),eF=(0,a.useCallback)(e=>{W(t=>({...t,[e]:!t[e]}))},[]),eU=(0,a.useCallback)(()=>{ec(e=>!e)},[]),eq=(0,a.useCallback)(()=>{eu(e=>!e)},[]),eZ=(0,a.useCallback)(()=>{ex(e=>!e)},[]);return g?(0,n.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,n.jsxs)("div",{className:"border-b border-secondary-200 dark:border-secondary-700 bg-white dark:bg-secondary-800 px-6 py-4 flex items-center gap-4",children:[(0,n.jsxs)("button",{type:"button",onClick:b,className:"button-secondary flex items-center gap-2 text-sm",children:[(0,n.jsx)(T.Z,{className:"w-4 h-4"}),"Back to chat"]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(u.Z,{className:"w-6 h-6 text-primary-500"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-secondary-900 dark:text-secondary-50",children:(null==k?void 0:k.title)||(null==k?void 0:k.original_filename)||(null==k?void 0:k.file_name)||"Unnamed document"}),(0,n.jsx)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:(null==k?void 0:k.document_type)?k.document_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown type"})]})]}),(0,n.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(null==k?void 0:k.uploaded_at)&&(0,n.jsxs)("span",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:["Uploaded ",new Date(k.uploaded_at).toLocaleString()]}),(null===N?null==k?void 0:k.preview_url:N)&&(0,n.jsxs)("button",{type:"button",onClick:ev,className:"button-primary text-sm flex items-center gap-2",disabled:P.isLoading,children:[(0,n.jsx)(A.Z,{className:"w-4 h-4"}),P.isLoading?"Loading preview…":"Open preview"]}),P.error&&(0,n.jsx)("span",{className:"text-xs text-red-600 dark:text-red-400",children:P.error})]})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-6 bg-secondary-50 dark:bg-secondary-900",children:[C&&(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-secondary-500 dark:text-secondary-400",children:[(0,n.jsx)(M.Z,{className:"w-10 h-10 animate-spin"}),(0,n.jsx)("p",{className:"mt-3 text-sm",children:"Loading document metadata…"})]}),E&&(0,n.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 flex items-start gap-2",children:[(0,n.jsx)(F.Z,{className:"w-5 h-5 flex-shrink-0"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium",children:"Failed to load document"}),(0,n.jsx)("p",{className:"text-sm",children:E})]})]}),!C&&!E&&k&&(0,n.jsxs)("div",{className:"space-y-6",children:[K&&(0,n.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 rounded-lg px-4 py-3 text-sm",children:K}),Y&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg px-4 py-3 text-sm",children:Y}),(null===(e=k.metadata)||void 0===e?void 0:e.processing_status)==="staged"&&(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 rounded-lg px-4 py-3 text-sm",children:[(0,n.jsx)("p",{className:"font-medium mb-1",children:"Document ready to process"}),(0,n.jsxs)("p",{children:["This document has been uploaded but not yet processed. Go to the ",(0,n.jsx)("strong",{children:"Upload"})," tab in the sidebar and click ",(0,n.jsx)("strong",{children:"Process All"})," to begin processing."]})]}),(0,n.jsxs)("section",{className:"bg-white dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700 p-5",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-4",children:"Overview"}),(0,n.jsxs)("dl",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"File name"}),(0,n.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:k.original_filename||k.file_name||"Unknown"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Mime type"}),(0,n.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:k.mime_type||"Unknown"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Uploader"}),(0,n.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:(null===(t=k.uploader)||void 0===t?void 0:t.name)||(null===(s=k.uploader)||void 0===s?void 0:s.id)||"Unknown"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Uploaded at"}),(0,n.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:k.uploaded_at?new Date(k.uploaded_at).toLocaleString():"Unknown"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Chunk count"}),(0,n.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:k.chunks.length})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Preview available"}),(0,n.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:null===N?k.preview_url?"Yes":"No":N?"Yes":"No"})]})]}),(0,n.jsxs)("div",{className:"mt-4 pt-4 border-t border-secondary-200 dark:border-secondary-700",children:[(0,n.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400 text-sm mb-2",children:"Tags"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 cursor-pointer p-2 -m-2 rounded hover:bg-secondary-50 dark:hover:bg-secondary-900 transition-colors",onClick:e_,children:es?(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 w-full",onClick:e=>e.stopPropagation(),children:[(k.hashtags||[]).map((e,t)=>(0,n.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-300",children:[e,(0,n.jsx)("button",{type:"button",onMouseDown:t=>{t.preventDefault(),t.stopPropagation(),eS(e)},className:"hover:text-primary-900",children:(0,n.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t)),(0,n.jsxs)("div",{className:"inline-flex items-center gap-1",children:[(0,n.jsx)("input",{type:"text",value:ea,onChange:e=>er(e.target.value),onKeyDown:eD,onBlur:()=>en(!1),placeholder:"Add tag...",className:"px-2.5 py-0.5 text-xs border border-secondary-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",autoFocus:!0}),(0,n.jsx)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),eE()},className:"text-primary-600 hover:text-primary-700",disabled:!ea.trim(),children:(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(k.hashtags||[]).map((e,t)=>(0,n.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-300",children:e},t)),(!k.hashtags||0===k.hashtags.length)&&(0,n.jsx)("span",{className:"text-sm text-secondary-400",children:"Click to add tags"})]})})]})]}),(k.summary||k.chunks.length>0||(null===(r=k.metadata)||void 0===r?void 0:r.processing_status)!=="staged")&&(0,n.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,n.jsx)("header",{className:"flex items-center justify-between px-5 py-4 border-b border-secondary-200 dark:border-secondary-700",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Summary"}),k.document_type&&(0,n.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary-100 dark:bg-secondary-700 text-secondary-700 dark:text-secondary-200",children:k.document_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),!k.summary&&k.chunks.length>0&&(null===(o=k.metadata)||void 0===o?void 0:o.processing_status)!=="staged"&&(0,n.jsx)("button",{type:"button",onClick:eN,className:"button-primary text-xs",disabled:eL,title:eI,children:"Generate summary"})]})}),(0,n.jsx)("div",{className:"px-5 py-4",children:k.summary?(0,n.jsx)("div",{className:"prose prose-sm prose-slate dark:prose-invert dark:text-secondary-200 max-w-none",children:(0,n.jsx)(l.UG,{remarkPlugins:[c.Z,d.Z],children:k.summary})}):(0,n.jsx)("p",{className:"text-sm text-secondary-500 dark:text-secondary-400",children:"No summary generated yet."})})]}),(0,n.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,n.jsxs)("header",{className:"flex items-center justify-between px-5 py-4 ".concat(el?"border-b border-secondary-200 dark:border-secondary-700":""),children:[(0,n.jsxs)("button",{type:"button",onClick:eU,className:"flex items-center gap-2 hover:bg-secondary-50 dark:hover:bg-secondary-700 rounded px-2 py-1 -mx-2 transition-colors",children:[el?(0,n.jsx)(q.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,n.jsx)(Z.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}),(0,n.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Chunks"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[0===k.chunks.length&&(null===(m=k.metadata)||void 0===m?void 0:m.processing_status)!=="staged"&&!(null==V?void 0:V.is_processing)&&(0,n.jsx)("button",{type:"button",onClick:ek,className:"button-primary text-xs",disabled:eL,title:eI,children:"Process chunks"}),(0,n.jsxs)("span",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:[k.chunks.length," entries"]})]})]}),(0,n.jsx)(h.M,{children:el&&(0,n.jsx)(p.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"divide-y divide-secondary-200 dark:divide-secondary-700 overflow-hidden",children:0===k.chunks.length?(0,n.jsx)("p",{className:"px-5 py-4 text-sm text-secondary-500 dark:text-secondary-400",children:"No chunks processed yet."}):(0,n.jsxs)(n.Fragment,{children:[(R?k.chunks:k.chunks.slice(0,10)).map(e=>{var t;let s=L[e.id],a=((e.text||"").split(/\r?\n/)[0]||"").trim()||"No preview available";return(0,n.jsxs)("article",{className:"px-5 py-4",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:["Chunk ","number"==typeof e.index?e.index+1:e.id]}),(0,n.jsx)("div",{className:"relative overflow-hidden pr-8",children:(0,n.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50 break-words break-all",children:a})})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,n.jsxs)("button",{type:"button",onClick:()=>eb(e),className:"button-ghost text-xs flex items-center gap-1",children:[(0,n.jsx)(U.Z,{className:"w-4 h-4"}),"Copy"]}),(0,n.jsx)("button",{type:"button",onClick:()=>ef(e),className:"button-secondary text-xs flex items-center gap-1",children:s?(0,n.jsx)(q.Z,{className:"w-4 h-4"}):(0,n.jsx)(Z.Z,{className:"w-4 h-4"})})]})]}),(0,n.jsx)(h.M,{children:s&&(0,n.jsx)(p.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"mt-3 text-sm text-secondary-800 dark:text-secondary-200 leading-relaxed overflow-hidden border-t border-secondary-200 dark:border-secondary-700 pt-3",children:eg?(0,n.jsx)(l.UG,{className:"prose prose-sm prose-slate dark:prose-invert dark:text-secondary-100 max-w-none break-words",remarkPlugins:[c.Z,d.Z],children:e.text||""}):(0,n.jsx)("p",{className:"whitespace-pre-wrap break-words",children:null!==(t=e.text)&&void 0!==t?t:""})})})]},e.id)}),k.chunks.length>10&&(0,n.jsx)("div",{className:"px-5 py-4 border-t border-secondary-200",children:(0,n.jsx)("button",{type:"button",onClick:()=>z(!R),className:"button-secondary text-sm flex items-center gap-2",children:R?"Show Less":"Show ".concat(k.chunks.length-10," more Chunks")})})]})})})]}),(0,n.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,n.jsxs)("header",{className:"flex items-center justify-between px-5 py-4 ".concat(ed?"border-b border-secondary-200 dark:border-secondary-700":""),children:[(0,n.jsxs)("button",{type:"button",onClick:eq,className:"flex items-center gap-2 hover:bg-secondary-50 dark:hover:bg-secondary-700 rounded px-2 py-1 -mx-2 transition-colors",children:[ed?(0,n.jsx)(q.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,n.jsx)(Z.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}),(0,n.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Entities"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[0===k.entities.length&&k.chunks.length>0&&(null===(x=k.metadata)||void 0===x?void 0:x.processing_status)!=="staged"&&!(null==V?void 0:V.is_processing)&&(0,n.jsx)("button",{type:"button",onClick:ej,className:"button-primary text-xs ".concat(eP?"opacity-50 cursor-not-allowed":""),disabled:eT,title:eA,children:"Process entities"}),(0,n.jsx)("span",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:k.entities.length>0?"".concat(k.entities.length," total"):"No entities"})]})]}),(0,n.jsx)(h.M,{children:ed&&(0,n.jsx)(p.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:0===k.entities.length?(0,n.jsx)("p",{className:"px-5 py-4 text-sm text-secondary-500 dark:text-secondary-400",children:"No entities extracted yet."}):(0,n.jsx)("div",{className:"divide-y divide-secondary-100 dark:divide-secondary-700",children:Object.entries(ey).map(e=>{let[t,s]=e,a=H[t]||!1,r=a?s:s.slice(0,5),o=s.length>5;return(0,n.jsxs)("div",{className:"px-5 py-4 space-y-2",children:[(0,n.jsx)("h4",{className:"text-xs font-semibold text-secondary-500 dark:text-secondary-400 uppercase tracking-wide",children:t}),(0,n.jsx)("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:r.map(e=>{var s,a;return(0,n.jsxs)("li",{className:"border border-secondary-200 dark:border-secondary-700 rounded-lg px-3 py-2",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:e.text}),(0,n.jsxs)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:["Count: ",null!==(a=e.count)&&void 0!==a?a:"—"," \xb7 Positions: ",(null===(s=e.positions)||void 0===s?void 0:s.join(", "))||"—"]})]},"".concat(t,"-").concat(e.text))})}),o&&(0,n.jsx)("button",{type:"button",onClick:()=>eF(t),className:"button-secondary text-xs mt-2",children:a?"Show Less":"Show ".concat(s.length-5," more ").concat(t.toLowerCase(),"s")})]},t)})})})})]}),k.quality_scores&&(0,n.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700 p-5",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-3",children:"Quality scores"}),(0,n.jsx)("pre",{className:"bg-secondary-900 text-secondary-50 text-xs rounded-lg p-4 overflow-auto",children:JSON.stringify(k.quality_scores,null,2)})]}),k.related_documents&&k.related_documents.length>0&&(0,n.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700 p-5",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-3",children:"Related documents"}),(0,n.jsx)("ul",{className:"space-y-2",children:k.related_documents.map(e=>(0,n.jsxs)("li",{className:"flex items-center justify-between gap-3 p-3 border border-secondary-200 rounded-lg hover:bg-secondary-50 dark:hover:bg-secondary-900 transition-colors",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:e.title||e.link||e.id}),e.link&&(0,n.jsxs)("a",{href:e.link,target:"_blank",rel:"noreferrer",className:"text-xs text-primary-600 hover:underline inline-flex items-center gap-1 mt-1",children:[(0,n.jsx)("span",{children:"Open external link"}),(0,n.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),(0,n.jsx)("button",{type:"button",onClick:()=>eM(e),className:"button-secondary text-xs",children:"View"})]},e.id))})]}),k.metadata&&(0,n.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,n.jsx)("header",{className:"flex items-center justify-between px-5 py-4 ".concat(em?"border-b border-secondary-200 dark:border-secondary-700":""),children:(0,n.jsxs)("button",{type:"button",onClick:eZ,className:"flex items-center gap-2 hover:bg-secondary-50 dark:hover:bg-secondary-700 rounded px-2 py-1 -mx-2 transition-colors",children:[em?(0,n.jsx)(q.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,n.jsx)(Z.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}),(0,n.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Metadata"})]})}),(0,n.jsx)(h.M,{children:em&&(0,n.jsx)(p.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:(0,n.jsx)("pre",{className:"bg-secondary-900 text-secondary-50 text-xs rounded-b-lg p-4 overflow-auto",children:JSON.stringify(k.metadata,null,2)})})})]})]})]}),(P.url||P.content)&&(0,n.jsx)(B,{previewUrl:P.url,mimeType:P.mimeType,content:P.content,onClose:ew})]}):(0,n.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-secondary-600 dark:text-secondary-400",children:[(0,n.jsx)(u.Z,{className:"w-16 h-16 text-secondary-300 mb-4"}),(0,n.jsx)("p",{className:"text-base font-medium",children:"Select a document to view its details."})]})}var Y=s(3009),X=s(1321),$=s(4589),ee=s(9808),et=s(1604),es=s(5781),en=s(2560);function ea(){let[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)(!0),o=y(e=>e.loadSession),l=y(e=>e.setSessionId),c=y(e=>e.setActiveView),d=y(e=>e.clearChat),u=y(e=>e.historyRefreshKey),m=y(e=>e.sessionId);(0,a.useEffect)(()=>{x()},[]),(0,a.useEffect)(()=>{u>0&&x()},[u]),(0,a.useEffect)(()=>{let e=()=>{x()};return window.addEventListener("server:reconnected",e),()=>{window.removeEventListener("server:reconnected",e)}},[]);let x=async()=>{try{r(!0);let e=await i.getHistory();t(e)}catch(e){console.error("Failed to load history:",e)}finally{r(!1)}},h=async e=>{if(confirm("Delete this conversation?"))try{await i.deleteConversation(e),await x()}catch(e){console.error("Failed to delete conversation:",e)}},p=async()=>{if(confirm("Clear all conversation history?"))try{await i.clearHistory(),d(),await x()}catch(e){console.error("Failed to clear history:",e)}};return s?(0,n.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400",children:"Loading..."}):(0,n.jsxs)("div",{className:"space-y-4",children:[e.length>0&&(0,n.jsx)("button",{onClick:p,className:"button-secondary w-full text-sm",children:"Clear All History"}),0===e.length?(0,n.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400 py-8",children:(0,n.jsx)("p",{children:"No conversation history yet"})}):(0,n.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,n.jsxs)("div",{className:"card p-3 flex items-center justify-between transition-all cursor-pointer group ".concat(m===e.session_id?"border-primary-300 shadow-primary-100 ring-1 ring-primary-100":"hover:shadow-md"),onClick:async()=>{m!==e.session_id&&(await o(e.session_id),l(e.session_id),c("chat"))},children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0 pr-8",children:[(0,n.jsx)("div",{className:"relative",children:(0,n.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50 truncate",children:e.preview||"New conversation"})}),(0,n.jsxs)("p",{className:"text-xs text-secondary-600 dark:text-secondary-400 mt-1",children:[e.message_count," messages •"," ",(0,es.Q)(new Date(e.updated_at),{addSuffix:!0})]})]}),(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),h(e.session_id),m===e.session_id&&d()},className:"text-red-600 hover:text-red-700 p-1 ml-2 flex-shrink-0",children:(0,n.jsx)(en.Z,{className:"w-4 h-4"})})]},e.session_id))})]})}function er(){var e,t,s;let[r,o]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!1),[b,v]=(0,a.useState)(!1),[j,_]=(0,a.useState)(""),[C,S]=(0,a.useState)(!0),E=(0,a.useRef)(null),D=(0,a.useRef)(!1),L=(0,a.useRef)(Date.now()),I=y(e=>e.selectDocument),P=y(e=>e.clearSelectedDocument),T=y(e=>e.selectedDocumentId),M=async e=>{f(!0);try{for(let t of Array.from(e))await i.stageFile(t),(0,N.C)("success","".concat(t.name," uploaded"),"Document queued for processing");window.dispatchEvent(new CustomEvent("documents:uploaded"))}catch(e){console.error("Failed to stage file:",e),(0,N.C)("error","Upload failed",e instanceof Error?e.message:"Failed to upload file")}finally{f(!1)}},F=async e=>{let t=e.target.files;t&&0!==t.length&&(await M(t),e.target.value="")},U=async e=>{e.preventDefault(),e.stopPropagation(),p(!1);let t=e.dataTransfer.files;t&&t.length>0&&await M(t)};(0,a.useEffect)(()=>{q();let e=()=>{q()};return"function"==typeof window.addEventListener&&(window.addEventListener("documents:processed",e),window.addEventListener("documents:processing-updated",e),window.addEventListener("documents:uploaded",e),window.addEventListener("server:reconnected",e)),()=>{"function"==typeof window.removeEventListener&&(window.removeEventListener("documents:processed",e),window.removeEventListener("documents:processing-updated",e),window.removeEventListener("documents:uploaded",e),window.removeEventListener("server:reconnected",e))}},[]),(0,a.useEffect)(()=>{b&&E.current&&E.current.focus()},[b]),(0,a.useEffect)(()=>{var e;if(!((null==d?void 0:d.is_processing)||(null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing)))return;let t=setInterval(async()=>{try{let e=await i.getProcessingProgress(),t=e.global.pending_documents&&e.global.pending_documents.length>0;if(!(e.global.is_processing||t)){console.log("Processing completed detected in polling - clearing state"),u(null),x(!1),D.current=!1,await q();return}u(e.global),L.current=Date.now(),x(!1);let s=await i.getStats();if(r&&e.global.pending_documents){let t=r.documents.map(t=>{let n=e.global.pending_documents.find(e=>e.document_id===t.document_id),a=s.documents.find(e=>e.document_id===t.document_id);return n?{...a,processing_status:n.status,processing_stage:n.stage||t.processing_stage,processing_progress:n.progress_percentage,queue_position:n.queue_position}:a||t});o({...s,documents:t,processing:e.global})}else o({...s,processing:e.global})}catch(e){console.error("Failed to poll processing state:",e)}},1500);return()=>clearInterval(t)},[null==d?void 0:d.is_processing,null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing,r]),(0,a.useEffect)(()=>{var e;if(!((null==d?void 0:d.is_processing)||(null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing)))return;let t=setInterval(()=>{Date.now()-L.current>3e4&&(console.warn("Processing appears stuck - no updates for 30s"),x(!0))},5e3);return()=>clearInterval(t)},[null==d?void 0:d.is_processing,null==r?void 0:null===(t=r.processing)||void 0===t?void 0:t.is_processing]),(0,a.useEffect)(()=>{var e;let t=(null==d?void 0:d.is_processing)||(null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing)||!1;D.current&&!t&&(console.log("Processing completed, refreshing stats..."),q(),setTimeout(()=>{u(null),x(!1)},1e3)),D.current=t},[null==d?void 0:d.is_processing,null==r?void 0:null===(s=r.processing)||void 0===s?void 0:s.is_processing]);let q=async()=>{try{var e,t,s,n;c(!0);let a=await i.getStats();return console.log("Loaded stats, is_processing:",null===(e=a.processing)||void 0===e?void 0:e.is_processing,"pending docs:",(null===(s=a.processing)||void 0===s?void 0:null===(t=s.pending_documents)||void 0===t?void 0:t.length)||0),o(a),u(a.processing||null),S(null===(n=a.enable_delete_operations)||void 0===n||n),a}catch(e){return console.error("Failed to load stats:",e),null}finally{c(!1)}},Z=async e=>{if(confirm("Delete this document and all its chunks?"))try{await i.deleteDocument(e);let t=await q();if(T===e){if(t&&t.documents&&t.documents.length>0){let s=t.documents.findIndex(t=>t.document_id===e),n=Math.min(Math.max(0,s),t.documents.length-1),a=t.documents[n];a?I(a.document_id):P()}else P()}}catch(e){console.error("Failed to delete document:",e)}},O=e=>{I(e)},R=async()=>{if(confirm("Clear the entire database? This cannot be undone."))try{await i.clearDatabase(),await q(),P()}catch(e){console.error("Failed to clear database:",e)}},z=async()=>{console.log("Clearing stuck state and refreshing..."),x(!1),u(null),L.current=Date.now(),D.current=!1,await q()},H=()=>{if(!(null==r?void 0:r.documents))return[];if(!j.trim())return r.documents;let e=j.toLowerCase();return r.documents.filter(t=>(t.original_filename||t.filename||"").toLowerCase().includes(e)||(t.document_type||"").toLowerCase().includes(e))};if(l)return(0,n.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400",children:"Loading..."});let W=d||(null==r?void 0:r.processing),V=e=>{let t=e.processing_status,s=e.processing_stage,n="number"==typeof e.processing_progress?Math.round(e.processing_progress):null;return"processing"===t?"Processing".concat(s?" – ".concat(s):"").concat(null!==n?" (".concat(n,"%)"):""):"queued"===t?"Processing queued":"staged"===t?"Ready to process":"error"===t?"Needs attention":null};return(0,n.jsxs)("div",{className:"relative transition-all ".concat(h?"ring-2 ring-primary-500 rounded-lg":""),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),p(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),p(!1)},onDrop:U,children:[h&&(0,n.jsx)("div",{className:"absolute inset-0 bg-primary-50 border-2 border-dashed border-primary-500 rounded-lg flex items-center justify-center z-10",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(w.Z,{className:"w-8 h-8 text-primary-600 mx-auto mb-2"}),(0,n.jsx)("p",{className:"text-sm font-medium text-primary-700",children:"Drop files to upload"})]})}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"flex gap-2",children:(0,n.jsxs)("label",{className:"flex-1 cursor-pointer",children:[(0,n.jsxs)("div",{className:"button-primary py-2 px-3 text-center text-sm flex items-center justify-center gap-2 ".concat(g?"opacity-50 pointer-events-none":""),children:[(0,n.jsx)(w.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{children:g?"Uploading...":"Upload Files"})]}),(0,n.jsx)("input",{type:"file",className:"hidden",onChange:F,disabled:g,accept:".pdf,.txt,.md,.doc,.docx,.ppt,.pptx,.xls,.xlsx",multiple:!0})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{className:"bg-primary-50 dark:bg-primary-900/20 rounded-lg p-4",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-primary-700 dark:text-primary-400",children:(null==r?void 0:r.total_documents)||0}),(0,n.jsx)("div",{className:"text-xs text-primary-600 dark:text-primary-400 mt-1",children:"Documents"})]}),(0,n.jsxs)("div",{className:"bg-secondary-100 dark:bg-secondary-700 rounded-lg p-4",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-secondary-700 dark:text-secondary-200",children:(null==r?void 0:r.total_chunks)||0}),(0,n.jsx)("div",{className:"text-xs text-secondary-600 dark:text-secondary-400 mt-1",children:"Chunks"})]}),(0,n.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-400",children:(null==r?void 0:r.total_entities)||0}),(0,n.jsx)("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Entities"})]}),(0,n.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-400",children:(null==r?void 0:r.total_relationships)||0}),(0,n.jsx)("div",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:"Relationships"})]})]}),(null==W?void 0:W.is_processing)&&(0,n.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border dark:border-secondary-700 px-4 py-3 text-sm shadow-sm ".concat(m?"border-red-200 bg-red-50 text-red-700 dark:border-red-900 dark:bg-red-900/20 dark:text-red-400":"border-secondary-200 bg-white dark:bg-secondary-800 text-secondary-700 dark:text-secondary-300"),children:[(0,n.jsx)("span",{className:"inline-flex h-2 w-2 rounded-full ".concat(m?"bg-red-500":"bg-primary-500 animate-pulse")}),(0,n.jsx)("div",{className:"flex-1",children:m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"font-medium",children:"Processing appears stuck"}),(0,n.jsx)("p",{className:"text-xs mt-1",children:"No updates for 30+ seconds. Server may have crashed."})]}):(0,n.jsx)("p",{className:"font-medium",children:"Processing in progress…"})}),m&&(0,n.jsx)("button",{onClick:z,className:"px-3 py-1 text-xs font-medium rounded bg-red-600 text-white hover:bg-red-700",children:"Clear"})]}),r&&r.documents.length>0&&(0,n.jsxs)(n.Fragment,{children:[b?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"flex-1 relative",children:(0,n.jsx)("input",{ref:E,type:"text",placeholder:"Search documents...",value:j,onChange:e=>_(e.target.value),onKeyDown:e=>{"Escape"===e.key&&(v(!1),_(""))},className:"w-full px-3 py-2 text-sm border border-secondary-300 rounded-md focus:outline-none focus:ring-1 focus:ring-primary-500"})}),(0,n.jsx)("button",{onClick:()=>{v(!1),_("")},className:"text-secondary-600 hover:text-secondary-900 dark:text-secondary-400 dark:hover:text-secondary-200 p-1",title:"Close search",children:(0,n.jsx)(k.Z,{className:"w-4 h-4"})})]}):(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:"Documents"}),(0,n.jsx)("button",{onClick:()=>v(!0),className:"text-secondary-600 dark:text-secondary-400 hover:text-secondary-900 dark:hover:text-secondary-200 p-1",title:"Search documents",children:(0,n.jsx)(A.Z,{className:"w-4 h-4"})})]}),C&&(0,n.jsx)("button",{onClick:R,className:"text-xs text-red-600 hover:text-red-700",children:"Clear All"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[H().map((e,t)=>{let s=e.document_id===T,a=V(e),r=e.processing_status,o="number"==typeof e.processing_progress?Math.max(0,Math.min(100,e.processing_progress)):null;return(0,n.jsxs)("div",{draggable:!0,onDragStart:t=>{t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("application/json",JSON.stringify({type:"document",document_id:e.document_id,filename:e.original_filename||e.filename}))},onClick:()=>O(e.document_id),className:"card p-3 flex flex-col gap-2 transition-all cursor-move group ".concat(s?"border-primary-300 shadow-primary-100 ring-1 ring-primary-100":"hover:shadow-md hover:cursor-grab active:cursor-grabbing"),children:[(0,n.jsxs)("div",{className:"flex w-full items-start justify-between gap-3",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"relative",children:(0,n.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50 truncate",children:e.original_filename||e.filename})}),(0,n.jsx)("p",{className:"text-xs mt-1 ".concat(m&&("queued"===r||"staged"===r)?"text-red-600 dark:text-red-400":"text-secondary-600 dark:text-secondary-400"),children:"queued"===r||"staged"===r?m?"Queue stuck - processing may have crashed":"Processing queued":e.document_type?e.document_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown type"}),a&&"queued"!==r&&"staged"!==r&&(0,n.jsx)("p",{className:"text-[11px] mt-1 ".concat("error"===r?"text-red-600":"processing"===r?"text-primary-600":"text-secondary-500 dark:text-secondary-400"),children:a})]}),C&&(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),Z(e.document_id)},className:"text-red-600 hover:text-red-700 p-1 flex-shrink-0",title:"Delete ".concat(e.original_filename||e.filename),children:(0,n.jsx)(en.Z,{className:"w-4 h-4"})})]}),"processing"===r&&null!==o&&(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("div",{className:"flex justify-between text-[10px] mb-1",children:[(0,n.jsx)("span",{className:m?"text-red-600":"text-secondary-500 dark:text-secondary-400",children:m?"Stuck - may need manual refresh":e.processing_stage||"Processing"}),(0,n.jsxs)("span",{className:m?"text-red-600":"text-secondary-500 dark:text-secondary-400",children:[Math.round(o),"%"]})]}),(0,n.jsx)("div",{className:"h-1.5 w-full rounded-full bg-secondary-200",children:(0,n.jsx)("div",{className:"h-1.5 rounded-full transition-all ".concat(m?"bg-red-500":"bg-primary-500"),style:{width:"".concat(o,"%")}})})]})]},t)}),j.trim()&&0===H().length&&(0,n.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400 py-6",children:(0,n.jsxs)("p",{className:"text-sm",children:['No documents match "',j,'"']})})]})]}),r&&0===r.documents.length&&(0,n.jsxs)("div",{className:"text-center text-secondary-600 dark:text-secondary-400 py-8",children:[(0,n.jsx)("p",{children:"No documents in database"}),(0,n.jsx)("p",{className:"text-xs mt-1",children:"Upload documents to get started"})]})]})]})}function eo(e){let{open:t,onToggle:s,width:r,onWidthChange:o,minWidth:i=260,maxWidth:l=480}=e,[c,d]=(0,a.useState)("history"),[u,m]=(0,a.useState)(!1),[x,h]=(0,a.useState)(!1),p=y(e=>e.isConnected),g=[{id:"history",label:"History",icon:Y.Z},{id:"database",label:"Database",icon:X.Z}],f=(0,a.useCallback)(e=>{o(Math.min(Math.max(e,i),l))},[l,i,o]),b=(0,a.useCallback)(e=>{let t=t=>{f(r+(t-e))},s=e=>{t(e.clientX)},n=e=>{e.touches.length>0&&(e.preventDefault(),t(e.touches[0].clientX))},a=()=>{m(!1),document.body.style.removeProperty("cursor"),document.body.style.removeProperty("user-select"),window.removeEventListener("mousemove",s),window.removeEventListener("touchmove",n),window.removeEventListener("mouseup",a),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)};m(!0),document.body.style.cursor="col-resize",document.body.style.userSelect="none",window.addEventListener("mousemove",s),window.addEventListener("touchmove",n,{passive:!1}),window.addEventListener("mouseup",a),window.addEventListener("touchend",a),window.addEventListener("touchcancel",a)},[f,r]),v=(0,a.useCallback)(e=>{e.preventDefault(),b(e.clientX)},[b]),w=(0,a.useCallback)(e=>{e.preventDefault(),e.touches.length>0&&b(e.touches[0].clientX)},[b]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:s,className:"fixed top-4 left-4 z-50 lg:hidden button-primary p-2",children:t?(0,n.jsx)(k.Z,{className:"w-6 h-6"}):(0,n.jsx)($.Z,{className:"w-6 h-6"})}),(0,n.jsxs)("aside",{className:"fixed lg:static inset-y-0 left-0 z-40 w-80 bg-white dark:bg-secondary-800 border-r border-secondary-200 dark:border-secondary-700 transform transition-all duration-300 ease-in-out ".concat(t?"translate-x-0":"-translate-x-full lg:translate-x-0"," ").concat(u?"no-transition":""," relative"),style:{width:"".concat(x?72:r,"px")},children:[(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsx)("button",{onClick:()=>h(e=>!e),"aria-label":x?"Expand sidebar":"Collapse sidebar",className:"hidden lg:flex absolute top-4 right-4 z-50 items-center justify-center p-2 rounded bg-white dark:bg-secondary-700 border border-secondary-200 dark:border-secondary-600 hover:bg-secondary-50 dark:hover:bg-secondary-600",children:x?(0,n.jsx)(ee.Z,{className:"w-5 h-5"}):(0,n.jsx)(et.Z,{className:"w-5 h-5"})}),!x&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"p-6 border-b border-secondary-200 dark:border-secondary-700",children:[(0,n.jsx)("h1",{className:"text-xl font-bold text-secondary-900 dark:text-secondary-50",children:"\uD83D\uDE80 GraphRAG"}),(0,n.jsx)("p",{className:"text-sm text-secondary-600 dark:text-secondary-400 mt-1",children:"Document Intelligence"})]}),(0,n.jsx)("div",{className:"flex border-b border-secondary-200 dark:border-secondary-700 transition-all duration-300 ".concat(p?"":"blur-sm pointer-events-none"),children:g.map(e=>(0,n.jsxs)("button",{onClick:()=>d(e.id),className:"flex-1 flex items-center justify-center py-3 text-sm font-medium transition-colors ".concat(c===e.id?"text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400":"text-secondary-600 dark:text-secondary-400 hover:text-secondary-900 dark:hover:text-secondary-200"),children:[(0,n.jsx)(e.icon,{className:"w-5 h-5 mr-1"}),e.label]},e.id))}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-6 transition-all duration-300 ".concat(p?"":"blur-sm pointer-events-none"),children:(0,n.jsxs)("div",{className:"tab-content",children:["history"===c&&(0,n.jsx)(ea,{}),"database"===c&&(0,n.jsx)(er,{})]},c)})]})]}),!x&&(0,n.jsx)("div",{className:"hidden lg:flex absolute top-0 -right-2 h-full w-4 items-center justify-center cursor-col-resize ".concat(u?"bg-primary-100 dark:bg-primary-900/60":"bg-transparent"),onMouseDown:v,onTouchStart:w,children:(0,n.jsx)("div",{className:"h-16 w-1 rounded bg-secondary-300 dark:bg-secondary-600"})})]}),t&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:s})]})}var ei=s(4238),el=s(4839);let ec=["light","dark","auto"],ed={light:"Light",dark:"Dark",auto:"Auto"};function eu(){let{theme:e,setTheme:t,isDark:s}=(0,ei.fl)(),[r,o]=(0,a.useState)(!1),[i,l]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{o(!0)},[]),!r)return null;let c=(ec.indexOf(e)+1)%ec.length,d=ec[c],u="dark"===e||"auto"===e&&s;return(0,n.jsxs)("div",{className:"fixed bottom-6 right-6 z-50",children:[i&&(0,n.jsx)("div",{className:"absolute bottom-12 right-0 mb-2 whitespace-nowrap",children:(0,n.jsx)("div",{className:"px-3 py-2 bg-secondary-900 dark:bg-secondary-50 text-white dark:text-secondary-900 text-sm rounded-lg shadow-lg",children:ed[e]})}),(0,n.jsx)("button",{onClick:()=>t(d),onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),className:(0,el.Z)("flex items-center justify-center w-12 h-12 rounded-full","bg-secondary-200 dark:bg-secondary-700","text-secondary-700 dark:text-secondary-200","hover:bg-secondary-300 dark:hover:bg-secondary-600","shadow-lg hover:shadow-xl","transition-all duration-200","border border-secondary-300 dark:border-secondary-600"),title:"Switch to ".concat(ed[d]," mode"),"aria-label":"Toggle theme",children:u?(0,n.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})}):(0,n.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})})})]})}function em(){let e=y(e=>e.activeView),[t,s]=(0,a.useState)(!0),[r,o]=(0,a.useState)(320);(0,a.useEffect)(()=>{let e=window.localStorage.getItem("sidebar-width");if(e){let t=parseInt(e,10);Number.isNaN(t)||o(Math.min(Math.max(t,260),480))}},[]),(0,a.useEffect)(()=>{window.localStorage.setItem("sidebar-width",String(r))},[r]);let i=e=>Math.min(Math.max(e,260),480);return(0,n.jsxs)("div",{className:"flex h-screen bg-secondary-50 dark:bg-secondary-900",children:[(0,n.jsx)(eo,{open:t,onToggle:()=>s(!t),width:r,onWidthChange:e=>o(i(e)),minWidth:260,maxWidth:480}),(0,n.jsx)("main",{className:"flex-1 flex flex-col transition-all duration-300 ".concat("ml-0"),children:"document"===e?(0,n.jsx)(Q,{}):(0,n.jsx)(P,{})}),(0,n.jsx)(eu,{})]})}},664:function(e,t,s){"use strict";s.d(t,{default:function(){return h},C:function(){return x}});var n=s(7437),a=s(2265),r=s(4446),o=s(1513),i=s(5130),l=s(9519),c=s(4573);function d(e){let{id:t,type:s,message:a,description:r,onDismiss:d}=e;return(0,n.jsxs)(o.E.div,{initial:{opacity:0,y:50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95},className:"flex items-start gap-3 rounded-lg border px-4 py-3 shadow-lg max-w-md ".concat("success"===s?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/30":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/30"),children:["success"===s?(0,n.jsx)(i.Z,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}):(0,n.jsx)(l.Z,{className:"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-medium ".concat("success"===s?"text-green-900 dark:text-green-300":"text-red-900 dark:text-red-300"),children:a}),r&&(0,n.jsx)("p",{className:"text-xs mt-1 ".concat("success"===s?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:r})]}),(0,n.jsx)("button",{onClick:()=>d(t),className:"flex-shrink-0 ".concat("success"===s?"text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300":"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"),children:(0,n.jsx)(c.Z,{className:"h-4 w-4"})})]})}let u=0,m=new Set;function x(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,a={id:"toast-".concat(++u),type:e,message:t,description:s,duration:n};m.forEach(e=>e(a))}function h(){let[e,t]=(0,a.useState)([]),s=(0,a.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),o=(0,a.useCallback)(e=>{t(t=>[...t,e]),e.duration&&e.duration>0&&setTimeout(()=>{s(e.id)},e.duration)},[s]);return(0,a.useEffect)(()=>(m.add(o),()=>{m.delete(o)}),[o]),(0,n.jsx)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2",children:(0,n.jsx)(r.M,{children:e.map(e=>(0,n.jsx)(d,{...e,onDismiss:s},e.id))})})}},4238:function(e,t,s){"use strict";s.d(t,{D7:function(){return i},_v:function(){return o},fl:function(){return r}});var n=s(9099),a=s(9291);let r=(0,n.Ue)()((0,a.tJ)((e,t)=>({theme:"auto",isDark:!1,setTheme:s=>{e({theme:s}),o(s,t().isDark)},setIsDark:s=>{e({isDark:s}),o(t().theme,s)}}),{name:"theme-store",partialize:e=>({theme:e.theme})}));function o(e,t){let s=document.documentElement;("auto"===e?t:"dark"===e)?s.classList.add("dark"):s.classList.remove("dark")}function i(){let{setIsDark:e}=r.getState();e(window.matchMedia("(prefers-color-scheme: dark)").matches);let t=window.matchMedia("(prefers-color-scheme: dark)"),s=t=>{e(t.matches)};return t.addEventListener("change",s),()=>t.removeEventListener("change",s)}}},function(e){e.O(0,[387,543,971,23,744],function(){return e(e.s=3269)}),_N_E=e.O()}]);