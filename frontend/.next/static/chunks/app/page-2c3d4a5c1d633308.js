(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3269:function(e,t,s){Promise.resolve().then(s.bind(s,4875))},4875:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ef}});var a=s(7437),n=s(2265),r=s(4887),o=s(2800),l=s(27),i=s(834),d=s(3092),c=s(1300),u=s(5014),m=s(8906),x=s(4446),h=s(1513);let p=(0,s(9099).Ue)((e,t)=>({messages:[],sessionId:"",isHistoryLoading:!1,historyRefreshKey:0,activeView:"chat",selectedDocumentId:null,selectedChunkId:null,isConnected:!0,setIsConnected:t=>e({isConnected:t}),setSessionId:t=>e({sessionId:t}),setActiveView:t=>e({activeView:t}),notifyHistoryRefresh:()=>e(e=>({historyRefreshKey:e.historyRefreshKey+1})),clearChat:()=>{e({messages:[],sessionId:"",activeView:"chat",selectedDocumentId:null,selectedChunkId:null}),t().notifyHistoryRefresh()},selectDocument:t=>e({selectedDocumentId:t,activeView:"document",selectedChunkId:null}),selectDocumentChunk:(t,s)=>e({selectedDocumentId:t,activeView:"document",selectedChunkId:s}),clearSelectedDocument:()=>e({selectedDocumentId:null,selectedChunkId:null,activeView:"chat"}),clearSelectedChunk:()=>e({selectedChunkId:null}),addMessage:t=>e(e=>({messages:[...e.messages,t]})),updateLastMessage:t=>e(e=>{if(0===e.messages.length)return e;let s=[...e.messages],a=s.length-1;return s[a]=t(s[a]),{messages:s}}),replaceMessages:(t,s)=>e({messages:t,sessionId:s}),loadSession:async t=>{if(t){e({isHistoryLoading:!0});try{let s=await o.h.getConversation(t),a=(s.messages||[]).map(e=>({role:e.role,content:e.content,timestamp:e.timestamp,sources:e.sources||[],quality_score:e.quality_score||void 0,follow_up_questions:e.follow_up_questions||void 0,isStreaming:!1,context_documents:e.context_documents||void 0,context_document_labels:e.context_document_labels||void 0,context_hashtags:e.context_hashtags||void 0}));e({messages:a,sessionId:s.session_id||t})}catch(e){throw e}finally{e({isHistoryLoading:!1})}}}}));function g(e){let{sources:t}=e,[s,r]=(0,n.useState)(!1),[o,l]=(0,n.useState)(null),i=p(e=>e.selectDocumentChunk),d=(0,n.useMemo)(()=>{let e=new Map;return t.forEach(t=>{let s=t.original_filename||t.document_name||t.filename||"Unknown Document";if(!e.has(s)){let a=t.document_id||s;e.set(s,{documentName:s,documentId:a,chunks:[],avgSimilarity:0,entityCount:0})}let a=e.get(s);t.document_id&&a.documentId===s&&(a.documentId=t.document_id),a.chunks.push(t),t.entity_name&&a.entityCount++}),e.forEach(e=>{let t=e.chunks.map(e=>e.similarity||e.relevance_score||0).filter(e=>!isNaN(e)&&e>0);t.length>0?e.avgSimilarity=t.reduce((e,t)=>e+t,0)/t.length:e.avgSimilarity=0}),Array.from(e.values()).sort((e,t)=>t.avgSimilarity-e.avgSimilarity)},[t]),g=s?d:d.slice(0,3);return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{onClick:()=>r(!s),className:"flex items-center text-sm font-medium text-secondary-700 dark:text-secondary-300 hover:text-secondary-900 dark:hover:text-secondary-100",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-1"}),"Sources (",d.length," ",1===d.length?"document":"documents",")",s?(0,a.jsx)(u.Z,{className:"w-4 h-4 ml-1"}):(0,a.jsx)(m.Z,{className:"w-4 h-4 ml-1"})]}),(0,a.jsx)(x.M,{children:s&&(0,a.jsxs)(h.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:[.4,0,.2,1],opacity:{duration:.2}},className:"space-y-2 overflow-hidden",children:[g.map((e,t)=>(0,a.jsxs)("div",{className:"bg-secondary-50 dark:bg-secondary-800 rounded-lg p-3 cursor-pointer hover:bg-secondary-100 dark:hover:bg-secondary-700 transition-colors",onClick:()=>l(o===e.documentId?null:e.documentId),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap md:flex-nowrap",children:[(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("span",{className:"block truncate text-sm font-medium text-secondary-900 dark:text-secondary-50",title:e.documentName,children:e.documentName})}),e.avgSimilarity>0&&(0,a.jsxs)("span",{className:"shrink-0 text-xs px-2 py-0.5 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded",children:[(100*e.avgSimilarity).toFixed(0),"% match"]}),(0,a.jsxs)("span",{className:"shrink-0 text-xs text-secondary-600 dark:text-secondary-400",children:[e.chunks.length," ",1===e.chunks.length?"chunk":"chunks"]}),e.entityCount>0&&(0,a.jsxs)("span",{className:"shrink-0 text-xs px-2 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded",children:[e.entityCount," ",1===e.entityCount?"entity":"entities"]})]})}),(0,a.jsx)("div",{children:o===e.documentId?(0,a.jsx)(u.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,a.jsx)(m.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"})})]}),(0,a.jsx)(x.M,{children:o===e.documentId&&(0,a.jsx)(h.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:[.4,0,.2,1],opacity:{duration:.2}},className:"mt-3 pt-3 border-t border-secondary-200 dark:border-secondary-700 space-y-2 overflow-hidden",children:e.chunks.map((t,s)=>{let n=t.similarity||t.relevance_score||0;return(0,a.jsxs)("div",{className:"bg-white dark:bg-secondary-700 rounded p-2 text-sm cursor-pointer hover:bg-secondary-50 dark:hover:bg-secondary-600 transition-colors",onClick:()=>{try{let s=new URLSearchParams(window.location.search);s.set("doc",e.documentId),void 0!==t.chunk_index?s.set("chunk",String(t.chunk_index)):t.chunk_id&&s.set("chunk_id",String(t.chunk_id));let a="".concat(window.location.pathname,"?").concat(s.toString());window.history.pushState({},"",a)}catch(e){}void 0!==t.chunk_index?i(e.documentId,t.chunk_index):t.chunk_id?i(e.documentId,t.chunk_id):i(e.documentId,0)},children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 flex-wrap",children:[t.entity_name?(0,a.jsxs)("span",{className:"text-xs font-medium text-purple-700 dark:text-purple-300",children:["\uD83C\uDFF7️ Entity: ",t.entity_name]}):void 0!==t.chunk_index&&(0,a.jsxs)("span",{className:"text-xs text-secondary-600 dark:text-secondary-400",children:["Section ",t.chunk_index+1]}),!isNaN(n)&&n>0&&(0,a.jsxs)("span",{className:"text-xs text-secondary-600 dark:text-secondary-400",children:[(100*n).toFixed(0),"% relevance"]})]})}),(0,a.jsxs)("p",{className:"text-xs text-secondary-700 dark:text-secondary-300 whitespace-pre-wrap break-words line-clamp-3",children:[t.content.substring(0,200),t.content.length>200&&"..."]}),t.contained_entities&&t.contained_entities.length>0&&(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap gap-1",children:[t.contained_entities.slice(0,5).map((e,t)=>(0,a.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-secondary-200 dark:bg-secondary-600 text-secondary-700 dark:text-secondary-200 rounded",children:e},t)),t.contained_entities.length>5&&(0,a.jsxs)("span",{className:"text-xs text-secondary-600 dark:text-secondary-400",children:["+",t.contained_entities.length-5," more"]})]})]},s)})},"doc-".concat(e.documentId))})]},e.documentId)),!s&&d.length>3&&(0,a.jsxs)("button",{onClick:()=>r(!0),className:"text-sm text-primary-600 hover:text-primary-700",children:["Show ",d.length-3," more documents"]})]},"sources-expanded")})]})}function y(e){var t,s;let{score:n}=e;return(0,a.jsxs)("div",{className:"inline-flex items-center space-x-2 text-xs",style:{transform:"translateY(-5px)"},children:[(0,a.jsx)("span",{children:(t=n.total)>=80?"\uD83D\uDFE2":t>=60?"\uD83D\uDFE1":"\uD83D\uDD34"}),(0,a.jsxs)("span",{className:"px-2 py-1 rounded-full font-medium ".concat((s=n.total)>=80?"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30":s>=60?"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/30":"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/30"),children:["Quality: ",n.total.toFixed(0),"%"]})]})}function b(e){let{message:t}=e,s="user"===t.role,n=t.context_document_labels&&t.context_document_labels.length>0?t.context_document_labels:t.context_documents;return(0,a.jsx)(h.E.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:[.4,0,.2,1]},className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"chat-message ".concat(s?"chat-message-user":"chat-message-assistant relative pr-4 pl-4"),children:[(0,a.jsx)("div",{className:s?"":"prose prose-sm prose-slate dark:prose-invert max-w-none dark:text-secondary-100",children:s?(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:t.content}):(0,a.jsx)(l.UG,{remarkPlugins:[i.Z,d.Z],children:t.content})}),s&&Array.isArray(t.context_documents)&&t.context_documents.length>0&&n&&n.length>0&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("span",{className:"inline-flex flex-wrap items-center gap-1 rounded-lg bg-white dark:bg-secondary-800/15 px-3 py-1 text-xs text-white/90 max-w-full",children:[(0,a.jsx)("span",{className:"font-semibold uppercase tracking-wide text-white/70 shrink-0",children:t.context_hashtags&&t.context_hashtags.length>0?"".concat(t.context_hashtags.map(e=>e.startsWith("#")?e:"#".concat(e)).join(", "),":"):n&&n.length>1?"Documents:":"Document:"}),(0,a.jsx)("span",{className:"break-words",title:n.join(", "),children:n.join(", ")})]})}),t.isStreaming&&(0,a.jsx)(h.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex items-center mt-2 text-secondary-500 dark:text-secondary-400",children:(0,a.jsx)(h.E.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"w-3 h-3 bg-secondary-400 rounded-full"})}),!s&&(t.sources&&t.sources.length>0||t.quality_score)&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-secondary-200 dark:border-secondary-700 relative",children:[t.sources&&t.sources.length>0?(0,a.jsx)("div",{className:"min-w-0",children:(0,a.jsx)(g,{sources:t.sources})}):null,t.quality_score&&void 0!==t.quality_score.total&&(0,a.jsx)("div",{className:t.sources&&t.sources.length>0?"absolute top-4 right-3 pointer-events-auto":"absolute bottom-3 right-3 pointer-events-auto",children:(0,a.jsx)(y,{score:t.quality_score})})]})]})})}var f=s(3499),v=s(9012),k=s(4573),j=s(8151),w=s(664);function N(e){let{onSend:t,onStop:s,disabled:r,isStreaming:l,userMessages:i=[]}=e,d=p(e=>e.isConnected),[c,u]=(0,n.useState)(""),[m,x]=(0,n.useState)([]),[h,g]=(0,n.useState)(!1),[y,b]=(0,n.useState)([]),[N,_]=(0,n.useState)(!1),[C,S]=(0,n.useState)({}),[E,D]=(0,n.useState)([]),[L,F]=(0,n.useState)(null),[M,I]=(0,n.useState)(0),[U,q]=(0,n.useState)(!1),[Z,P]=(0,n.useState)(!1),[A,R]=(0,n.useState)(!1),[z,T]=(0,n.useState)(-1),[O,H]=(0,n.useState)(""),W=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=!0,t=async()=>{try{let t=await o.h.getHashtags(),s=Array.isArray(null==t?void 0:t.hashtags)?t.hashtags:[];e&&b(s)}catch(e){console.error("Failed to fetch hashtags:",e)}finally{e&&_(!0)}};return(async()=>{try{let t=await o.h.getDocuments(),s=Array.isArray(null==t?void 0:t.documents)?t.documents:[];e&&x(s)}catch(e){console.error("Failed to fetch documents:",e)}finally{e&&g(!0)}})(),t(),()=>{e=!1}},[]);let B=()=>{let e=W.current;e&&(e.style.height="auto",e.style.height="".concat(e.scrollHeight,"px"))};(0,n.useEffect)(()=>{B()},[c]);let V=(0,n.useMemo)(()=>Object.entries(C),[C]),G=(0,n.useMemo)(()=>{if(!L)return[];let e=L.query.toLowerCase();if("hashtag"===L.type)return e?y.filter(t=>t.toLowerCase().includes(e)).slice(0,8):y.slice(0,8);{let t=m.filter(e=>!C[e.document_id]);return e?t.filter(t=>(t.original_filename||t.filename).toLowerCase().includes(e)).slice(0,8):t.slice(0,8)}},[m,y,L,C]);(0,n.useEffect)(()=>{if(0===G.length){I(0);return}M>=G.length&&I(0)},[G,M]);let K=e=>{var t;if(!L||!W.current)return;let s=null!==(t=W.current.selectionStart)&&void 0!==t?t:c.length,a=c.slice(0,L.start),n=c.slice(s);u("".concat(a).concat(n)),S(t=>({...t,[e.document_id]:{filename:e.filename,original_filename:e.original_filename}})),F(null),q(!1),I(0),requestAnimationFrame(()=>{if(W.current){let e=a.length;W.current.focus(),W.current.setSelectionRange(e,e)}})},Q=e=>{var t;if(!L||!W.current)return;let s=null!==(t=W.current.selectionStart)&&void 0!==t?t:c.length,a=c.slice(0,L.start),n=c.slice(s);u("".concat(a).concat(n)),D(t=>[...t,e]),F(null),q(!1),I(0),requestAnimationFrame(()=>{if(W.current){let e=a.length;W.current.focus(),W.current.setSelectionRange(e,e)}})},Y=e=>{(null==L?void 0:L.type)==="hashtag"&&"string"==typeof e?Q(e):"object"==typeof e&&K(e)},J=e=>{C[e]&&(S(t=>{let s={...t};return delete s[e],s}),F(null),q(!1),I(0))},X=e=>{D(t=>t.filter(t=>t!==e)),F(null),q(!1),I(0)},$=e=>{if(e.preventDefault(),!l&&c.trim()&&!r){let e=Object.keys(C),s=e.map(e=>{var t,s;return(null===(t=C[e])||void 0===t?void 0:t.original_filename)||(null===(s=C[e])||void 0===s?void 0:s.filename)}).filter(e=>!!e);E.length>0&&m.filter(e=>e.hashtags&&e.hashtags.some(e=>E.includes(e))).forEach(t=>{e.includes(t.document_id)||(e.push(t.document_id),s.push(t.original_filename||t.filename))}),t(c,e,s,E.length>0?E:void 0),u(""),T(-1),H(""),S({}),D([]),F(null),q(!1),I(0)}},ee=async e=>{R(!0);try{for(let t of Array.from(e))await o.h.stageFile(t),(0,w.C)("success","".concat(t.name," uploaded"),"Document queued for processing");window.dispatchEvent(new CustomEvent("documents:uploaded"))}catch(e){console.error("Failed to stage file:",e),(0,w.C)("error","Upload failed",e instanceof Error?e.message:"Failed to upload file")}finally{R(!1)}},et=async e=>{let t=e.target.files;t&&0!==t.length&&(await ee(t),e.target.value="")},es=async e=>{if(e.preventDefault(),e.stopPropagation(),P(!1),!d)return;let t=e.dataTransfer.getData("application/json");if(t)try{let e=JSON.parse(t);if("document"===e.type&&e.document_id){S(t=>({...t,[e.document_id]:{filename:e.filename,original_filename:e.filename}})),(0,w.C)("success","Document added to context","".concat(e.filename," will be used as context"));return}}catch(e){console.error("Failed to parse dragged document:",e)}let s=e.dataTransfer.files;s&&s.length>0&&await ee(s)};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("form",{onSubmit:$,className:"relative",children:(0,a.jsxs)("div",{className:"relative transition-all ".concat(Z?"ring-2 ring-primary-500 rounded-lg":""),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),d&&P(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),P(!1)},onDrop:es,children:[Z&&(0,a.jsx)("div",{className:"absolute inset-0 bg-primary-50 dark:bg-primary-900/30 border-2 border-dashed border-primary-500 rounded-lg flex items-center justify-center z-10",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(v.Z,{className:"w-8 h-8 text-primary-600 dark:text-primary-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm font-medium text-primary-700 dark:text-primary-300",children:"Drop files to upload, or drop documents to add to context"})]})}),(V.length>0||E.length>0)&&(0,a.jsxs)("div",{className:"mb-2 flex flex-wrap items-center gap-2 pr-24",children:[(0,a.jsx)("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-secondary-500 dark:text-secondary-400",children:"Context"}),V.map(e=>{let[t,s]=e;return(0,a.jsxs)("span",{className:"inline-flex max-w-full items-center gap-2 rounded-full bg-primary-50 dark:bg-primary-900/30 px-3 py-1 text-xs text-primary-700 dark:text-primary-300",children:[(0,a.jsx)("span",{className:"truncate",title:s.original_filename||s.filename,children:s.original_filename||s.filename}),(0,a.jsx)("button",{type:"button",onClick:()=>J(t),className:"rounded-full p-0.5 text-primary-600 dark:text-primary-400 transition hover:bg-primary-100 dark:hover:bg-primary-900/50 focus:outline-none focus:ring-1 focus:ring-primary-400","aria-label":"Remove ".concat(s.original_filename||s.filename," from forced context"),children:(0,a.jsx)(k.Z,{className:"h-3.5 w-3.5"})})]},t)}),E.map(e=>(0,a.jsxs)("span",{className:"inline-flex max-w-full items-center gap-2 rounded-full bg-green-50 px-3 py-1 text-xs text-green-700",children:[(0,a.jsx)("span",{className:"truncate",title:e,children:e.startsWith("#")?e:"#".concat(e)}),(0,a.jsx)("button",{type:"button",onClick:()=>X(e),className:"rounded-full p-0.5 text-green-600 transition hover:bg-green-100 focus:outline-none focus:ring-1 focus:ring-green-400","aria-label":"Remove ".concat(e," from forced context"),children:(0,a.jsx)(k.Z,{className:"h-3.5 w-3.5"})})]},e))]}),U&&(0,a.jsx)("div",{className:"absolute bottom-full left-0 right-24 mb-2 max-h-56 overflow-y-auto rounded-lg border border-secondary-200 dark:border-secondary-600 bg-white dark:bg-secondary-800 shadow-lg z-20",role:"listbox",children:(null==L?void 0:L.type)==="hashtag"?N?0===G.length?(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"No matching hashtags"}):G.map((e,t)=>(0,a.jsx)("button",{type:"button",role:"option","aria-selected":t===M,onMouseDown:t=>{t.preventDefault(),Q(e)},className:"flex w-full items-center gap-3 px-3 py-2 text-left text-sm transition ".concat(t===M?"bg-primary-50 dark:bg-primary-900/40 text-primary-700 dark:text-primary-300":"hover:bg-secondary-100"),children:(0,a.jsx)("span",{className:"truncate",title:e,children:e.startsWith("#")?e:"#".concat(e)})},e)):(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"Loading hashtags..."}):h?0===G.length?(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"No matching documents"}):G.map((e,t)=>(0,a.jsxs)("button",{type:"button",role:"option","aria-selected":t===M,onMouseDown:t=>{t.preventDefault(),K(e)},className:"flex w-full items-center justify-between gap-3 px-3 py-2 text-left text-sm transition ".concat(t===M?"bg-primary-50 text-primary-700":"hover:bg-secondary-100"),children:[(0,a.jsx)("span",{className:"truncate",title:e.original_filename||e.filename,children:e.original_filename||e.filename}),"number"==typeof e.chunk_count&&(0,a.jsxs)("span",{className:"text-xs text-secondary-400 whitespace-nowrap",children:[e.chunk_count," chunks"]})]},e.document_id)):(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-secondary-400",children:"Loading documents..."})}),(0,a.jsx)("textarea",{ref:W,value:c,onChange:e=>{var t;let s=e.target.value,a=null!==(t=e.target.selectionStart)&&void 0!==t?t:s.length;u(s);let n=s.slice(0,a),r=n.lastIndexOf("@"),o=n.lastIndexOf("#"),l=null;if(-1!==r&&r>o){let e=r>0?n[r-1]:"",t=n.slice(r+1),s=/\s/.test(t);(""===e||/\s/.test(e))&&!s&&!t.includes("@")&&(l={start:r,query:t,type:"document"})}else if(-1!==o){let e=o>0?n[o-1]:"",t=n.slice(o+1),s=/\s/.test(t);(""===e||/\s/.test(e))&&!s&&!t.includes("#")&&(l={start:o,query:t,type:"hashtag"})}l?(F(l),q(!0),I(0)):(F(null),q(!1))},onKeyDown:e=>{if(U){if("ArrowDown"===e.key&&G.length>0){e.preventDefault(),I(e=>(e+1)%G.length);return}if("ArrowUp"===e.key&&G.length>0){e.preventDefault(),I(e=>0===e?G.length-1:e-1);return}if(("Enter"===e.key||"Tab"===e.key)&&G.length>0&&L){e.preventDefault(),Y(G[M]);return}if("Escape"===e.key){e.preventDefault(),q(!1),F(null);return}}if("Enter"!==e.key||e.shiftKey){if("ArrowUp"===e.key){if(e.preventDefault(),i.length>0){-1===z&&H(c);let e=Math.min(z+1,i.length-1);T(e),u(i[i.length-1-e])}}else if("ArrowDown"===e.key&&(e.preventDefault(),z>-1)){let e=z-1;T(e),-1===e?u(O):u(i[i.length-1-e])}}else e.preventDefault(),$(e)},placeholder:d?"Ask a question about your documents... (@ for documents, # for tags)":"Server is offline - chat unavailable",disabled:r||l||A||!d,rows:1,className:"input-field pr-24 resize-none overflow-hidden disabled:opacity-50"}),(0,a.jsxs)("div",{className:"absolute right-3 bottom-3 flex items-center gap-2",style:{transform:"translateY(-1px)"},children:[(0,a.jsxs)("label",{className:"cursor-pointer p-2 text-secondary-400 hover:text-primary-600 transition-colors ".concat(r||l||A||!d?"opacity-50 pointer-events-none":""),children:[(0,a.jsx)("input",{type:"file",className:"hidden",onChange:et,disabled:r||l||A||!d,accept:".pdf,.txt,.md,.doc,.docx,.ppt,.pptx,.xls,.xlsx",multiple:!0}),(0,a.jsx)(v.Z,{className:"w-5 h-5"})]}),l?(0,a.jsxs)("button",{type:"button",onClick:s,className:"inline-flex items-center gap-1 rounded-md bg-rose-500 px-3 py-2 text-xs font-semibold text-white shadow-sm transition hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-rose-400 focus:ring-offset-2",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4"}),"Stop"]}):(0,a.jsx)("button",{type:"submit",disabled:r||!c.trim()||A||!d,className:"button-primary p-2 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})})]})]})}),A&&(0,a.jsx)("div",{className:"absolute -top-8 left-0 right-0 text-center",children:(0,a.jsx)("span",{className:"text-xs text-secondary-600 bg-white dark:bg-secondary-800 px-2 py-1 rounded shadow-sm",children:"Uploading files..."})})]})}var _=s(8760);function C(e){let{questions:t,onQuestionClick:s}=e;return(0,a.jsxs)("div",{className:"mt-4 ml-0 animate-slide-up",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm font-medium text-secondary-700 dark:text-secondary-300 mb-2",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-1"}),"Follow-up questions"]}),(0,a.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,a.jsx)("button",{onClick:()=>s(e),className:"block w-full text-left px-4 py-3 bg-white dark:bg-secondary-800 border border-secondary-300 dark:border-secondary-600 rounded-lg hover:border-primary-500 dark:hover:border-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-all duration-200 text-sm text-secondary-700 dark:text-secondary-300 hover:text-primary-700 dark:hover:text-primary-300 suggestion-shimmer",children:e},t))})]})}let S={query_analysis:{id:"query_analysis",label:"Analyzing Query",emoji:"\uD83D\uDD0D",color:"from-blue-500 to-cyan-500"},retrieval:{id:"retrieval",label:"Retrieving Documents",emoji:"\uD83D\uDCDA",color:"from-purple-500 to-pink-500"},graph_reasoning:{id:"graph_reasoning",label:"Graph Reasoning",emoji:"\uD83E\uDDE0",color:"from-indigo-500 to-purple-500"},generation:{id:"generation",label:"Generating Response",emoji:"✍️",color:"from-yellow-500 to-orange-500"},quality_calculation:{id:"quality_calculation",label:"Quality Check",emoji:"✅",color:"from-green-400 to-green-600"},suggestions:{id:"suggestions",label:"Preparing Suggestions",emoji:"\uD83D\uDCA1",color:"from-pink-500 to-rose-500"}};function E(e){let{currentStage:t="query_analysis",completedStages:s=[],isLoading:r=!0,enableQualityScoring:o=!0}=e,[l,i]=(0,n.useState)(t),[d,c]=(0,n.useState)(s);(0,n.useEffect)(()=>{r&&t&&(i(t),c(e=>e.includes(t)?e:[...e,t]))},[t,r]),(0,n.useEffect)(()=>{!r&&s.length>0&&(c(s),i(s[s.length-1]))},[s,r]);let u=e=>("quality_calculation"!==e||!!o)&&d.includes(e),m=S[l]||S.query_analysis,x=r?d.slice(0,-1).length:d.length;return(d.length,Object.keys(S).length,r)?(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("style",{children:"\n        @keyframes pulse-glow {\n          0%, 100% {\n            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);\n          }\n          50% {\n            box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);\n          }\n        }\n\n        @keyframes slide-in {\n          from {\n            opacity: 0;\n            transform: translateX(-10px);\n          }\n          to {\n            opacity: 1;\n            transform: translateX(0);\n          }\n        }\n\n        @keyframes bounce-smooth {\n          0%, 100% {\n            transform: translateY(0);\n          }\n          50% {\n            transform: translateY(-4px);\n          }\n        }\n\n        @keyframes shimmer {\n          0% {\n            background-position: -1000px 0;\n          }\n          100% {\n            background-position: 1000px 0;\n          }\n        }\n\n        .animate-pulse-glow {\n          animation: pulse-glow 2s infinite;\n        }\n\n        .animate-slide-in {\n          animation: slide-in 0.3s ease-out;\n        }\n\n        .animate-bounce-smooth {\n          animation: bounce-smooth 1.5s ease-in-out infinite;\n        }\n\n        .animate-shimmer {\n          background: linear-gradient(\n            90deg,\n            rgba(255, 255, 255, 0) 0%,\n            rgba(255, 255, 255, 0.3) 50%,\n            rgba(255, 255, 255, 0) 100%\n          );\n          background-size: 1000px 100%;\n          animation: shimmer 2s infinite;\n        }\n      "}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 animate-slide-in",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-primary-500 rounded-full animate-pulse-glow"}),(0,a.jsx)("div",{className:"absolute inset-0 w-3 h-3 bg-primary-500 rounded-full opacity-30"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg animate-bounce-smooth",children:m.emoji}),(0,a.jsx)("span",{className:"text-sm font-medium text-secondary-700 dark:text-secondary-300",children:m.label})]})]}),(0,a.jsx)("div",{className:"relative h-1 bg-secondary-200 dark:bg-secondary-700 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r ".concat(m.color," animate-shimmer transition-all duration-500 ease-out"),style:{width:"".concat((x+1)/Object.keys(S).length*100,"%")}})}),(0,a.jsx)("div",{className:"flex gap-2 items-center justify-center py-2",children:Object.values(S).map(e=>{let t=u(e.id),s=e.id===l;return(0,a.jsxs)("div",{className:"cursor-help group relative transition-all duration-300",title:e.label,children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full transition-all duration-300 ".concat(t?"bg-green-500 scale-100":s?"bg-primary-500 dark:bg-primary-400 scale-125 animate-pulse-glow":"bg-secondary-300 dark:bg-secondary-600 scale-75")}),(0,a.jsx)("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-secondary-800 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.label})]},e.id)})}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 text-xs text-secondary-500 dark:text-secondary-400",children:[(0,a.jsx)("span",{children:"Processing"}),(0,a.jsxs)("span",{className:"inline-flex gap-0.5",children:[(0,a.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0s"},children:"•"}),(0,a.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.15s"},children:"•"}),(0,a.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.3s"},children:"•"})]})]})]})]}):(0,a.jsxs)("div",{className:"w-full space-y-2",children:[(0,a.jsx)("div",{className:"relative h-1 bg-secondary-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-green-400 to-green-600",style:{width:"100%"}})}),(0,a.jsx)("div",{className:"flex gap-2 items-center justify-center py-2",children:Object.values(S).map(e=>{let t=u(e.id);return(0,a.jsxs)("div",{className:"cursor-help group relative",title:e.label,children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full transition-all duration-300 ".concat(t?"bg-green-500":"bg-secondary-300")}),(0,a.jsx)("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 px-2 py-1 bg-secondary-800 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:e.label})]},e.id)})})]})}var D=s(2412);function L(){return p(e=>e.isConnected)?null:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3 px-4 py-3 bg-red-50 dark:bg-red-900/30 border-b border-red-200 dark:border-red-800",children:[(0,a.jsx)(D.Z,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Unable to connect to server"}),(0,a.jsx)("p",{className:"text-xs text-red-700 dark:text-red-300",children:"Chat is currently unavailable. Please check your connection and try again."})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsxs)("div",{className:"inline-flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-600 dark:bg-red-400 animate-pulse"}),(0,a.jsx)("span",{className:"text-xs font-medium text-red-600 dark:text-red-400",children:"Offline"})]})})]})}function F(){var e;let t=p(e=>e.messages),s=p(e=>e.sessionId),l=p(e=>e.addMessage),i=p(e=>e.updateLastMessage),d=p(e=>e.setSessionId),c=p(e=>e.clearChat),u=p(e=>e.notifyHistoryRefresh),m=p(e=>e.isHistoryLoading),x=p(e=>e.isConnected),h=p(e=>e.setIsConnected),[g,y]=(0,n.useState)(!1),f=(0,n.useRef)(null),v=(0,n.useRef)(null),[k,j]=(0,n.useState)("query_analysis"),[w,_]=(0,n.useState)([]),[S,D]=(0,n.useState)(null),[F,M]=(0,n.useState)({chunk_weight:.6,entity_weight:.4,path_weight:.6,max_hops:2,beam_size:8,graph_expansion_depth:2,restrict_to_context:!0}),[I,U]=(0,n.useState)(!1),q=(0,n.useRef)(null),Z=()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{Z()},[t]),(0,n.useEffect)(()=>{(async()=>{try{let e=await o.h.getSettings();D(e),M(t=>{var s,a,n,r,o,l,i;return{...t,chunk_weight:null!==(s=null==e?void 0:e.hybrid_chunk_weight)&&void 0!==s?s:t.chunk_weight,entity_weight:null!==(a=null==e?void 0:e.hybrid_entity_weight)&&void 0!==a?a:t.entity_weight,path_weight:null!==(n=null==e?void 0:e.hybrid_path_weight)&&void 0!==n?n:t.path_weight,max_hops:null!==(r=null==e?void 0:e.multi_hop_max_hops)&&void 0!==r?r:t.max_hops,beam_size:null!==(o=null==e?void 0:e.multi_hop_beam_size)&&void 0!==o?o:t.beam_size,graph_expansion_depth:null!==(l=null==e?void 0:e.max_expansion_depth)&&void 0!==l?l:t.graph_expansion_depth,restrict_to_context:null!==(i=null==e?void 0:e.default_context_restriction)&&void 0!==i?i:t.restrict_to_context}})}catch(e){console.error("Failed to fetch settings:",e)}})()},[]),(0,n.useEffect)(()=>{let e=!1,t=e=>{q.current&&clearTimeout(q.current),q.current=setTimeout(s,e)},s=async()=>{if(e)return;let s=await o.h.checkHealth();h(s),t(s?3e4:5e3)};return s(),()=>{e=!0,q.current&&clearTimeout(q.current)}},[h]),(0,n.useEffect)(()=>{x&&window.dispatchEvent&&window.dispatchEvent(new CustomEvent("server:reconnected"))},[x]);let P=()=>{v.current&&v.current.abort()},A=(e,t)=>{M(s=>({...s,[e]:t}))},R=(0,n.useCallback)(()=>{P(),j("query_analysis"),_([]),c()},[c]);(0,n.useEffect)(()=>{let e=e=>{"n"!==e.key||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),R())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[R]);let z=async(e,t,a,n)=>{if(!e.trim()||g||m)return;j("query_analysis"),_([]),l({role:"user",content:e,timestamp:new Date().toISOString(),context_documents:t,context_document_labels:a,context_hashtags:n}),y(!0);let c="",x="",h=[],p=null,b=[],f=s,k=!1,w=null,N=[],C=[...t],S=new Map;t.forEach((e,t)=>{let s=a[t];s&&S.set(e,s)});let E=[...a],D=()=>{if(N.length>0){let e=Math.ceil(N.length/3)||1,t=N.splice(0,e).join("");x+=t,i(e=>({...e,content:x}))}N.length>0||!k?w=requestAnimationFrame(D):k&&c!==x&&(x=c,i(e=>({...e,content:x,isStreaming:!1,sources:h,quality_score:p,follow_up_questions:b})))};try{l({role:"assistant",content:"",isStreaming:!0});let m=new AbortController;v.current=m;let g=await o.h.sendMessage({message:e,session_id:s,stream:!0,context_documents:t,context_document_labels:a,context_hashtags:n,chunk_weight:F.chunk_weight,entity_weight:F.entity_weight,path_weight:F.path_weight,max_hops:F.max_hops,beam_size:F.beam_size,graph_expansion_depth:F.graph_expansion_depth,restrict_to_context:F.restrict_to_context},{signal:m.signal});if(!g.body)throw Error("No response body");w=requestAnimationFrame(D);let y=g.body.getReader(),L=new TextDecoder;for(;;){let{done:e,value:t}=await y.read();if(e)break;for(let e of L.decode(t).split("\n"))if(e.startsWith("data: "))try{let t=JSON.parse(e.slice(6));if(console.log("Received SSE data:",t),"token"===t.type)c+=t.content,N.push(t.content);else if("stage"===t.type)console.log("Received stage:",t.content),(0,r.flushSync)(()=>{j(t.content),_(e=>e.includes(t.content)?e:[...e,t.content])});else if("sources"===t.type)h=t.content;else if("quality_score"===t.type)p=t.content;else if("follow_ups"===t.type)b=t.content;else if("metadata"===t.type)f=t.content.session_id,Array.isArray(t.content.context_documents)&&(C=t.content.context_documents,E=t.content.context_documents.map(e=>S.get(e)||e));else if("done"===t.type)k=!0;else if("error"===t.type)throw Error(t.content)}catch(e){console.error("Error parsing SSE data:",e)}}k=!0,await new Promise(e=>{let t=()=>{0===N.length&&x===c?e(null):setTimeout(t,50)};t()}),i(e=>({...e,content:c,isStreaming:!1,sources:h,quality_score:p,follow_up_questions:b,context_documents:C,context_document_labels:E})),f&&!s&&d(f),u()}catch(e){null!==w&&cancelAnimationFrame(w),e instanceof DOMException&&"AbortError"===e.name?(k=!0,await new Promise(e=>setTimeout(e,100)),i(e=>({...e,content:c||x||e.content||"",isStreaming:!1,sources:h.length>0?h:e.sources,quality_score:null!=p?p:e.quality_score,follow_up_questions:b.length>0?b:e.follow_up_questions,context_documents:C,context_document_labels:E}))):(console.error("Error sending message:",e),i(()=>({role:"assistant",content:"Sorry, I encountered an error processing your request. Please try again.",isStreaming:!1,context_documents:C,context_document_labels:E})))}finally{null!==w&&cancelAnimationFrame(w),v.current=null,y(!1)}},T=e=>{z(e,[],[])},O=t.filter(e=>"user"===e.role).map(e=>e.content);return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(L,{}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:0===t.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-primary-100 dark:bg-primary-900/40 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-primary-500 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-secondary-700 dark:text-secondary-300 mb-2",children:"Start a Conversation"}),(0,a.jsx)("p",{className:"text-secondary-500 dark:text-secondary-400 max-w-md",children:"Upload some documents and start asking questions. I'll help you find relevant information and provide intelligent answers."})]}):(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[t.map((e,s)=>{var n;return(0,a.jsxs)("div",{children:[(0,a.jsx)(b,{message:e}),"assistant"===e.role&&!e.isStreaming&&e.follow_up_questions&&e.follow_up_questions.length>0&&s===t.length-1&&(0,a.jsx)(C,{questions:e.follow_up_questions,onQuestionClick:T}),"assistant"===e.role&&!e.isStreaming&&s===t.length-1&&w.length>0&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(E,{currentStage:w[w.length-1],completedStages:w,isLoading:!1,enableQualityScoring:null===(n=null==S?void 0:S.enable_quality_scoring)||void 0===n||n})})]},s)}),(g||m)&&(0,a.jsx)(E,{currentStage:k,completedStages:w,isLoading:g||m,enableQualityScoring:null===(e=null==S?void 0:S.enable_quality_scoring)||void 0===e||e}),(0,a.jsx)("div",{ref:f})]})}),(0,a.jsx)("div",{className:"border-t border-secondary-200 dark:border-secondary-700 bg-white dark:bg-secondary-800 px-6 py-4",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[(0,a.jsxs)("details",{className:"rounded-lg border border-secondary-200 dark:border-secondary-600 bg-secondary-50 dark:bg-secondary-900 p-4",open:I,onToggle:e=>U(e.currentTarget.open),children:[(0,a.jsx)("summary",{className:"cursor-pointer font-semibold text-secondary-900 dark:text-white",children:"Advanced retrieval settings"}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[(0,a.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Chunk weight",(0,a.jsx)("input",{type:"number",min:0,max:1,step:.05,value:F.chunk_weight,onChange:e=>A("chunk_weight",parseFloat(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Entity weight",(0,a.jsx)("input",{type:"number",min:0,max:1,step:.05,value:F.entity_weight,onChange:e=>A("entity_weight",parseFloat(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Path weight",(0,a.jsx)("input",{type:"number",min:0,max:1,step:.05,value:F.path_weight,onChange:e=>A("path_weight",parseFloat(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Multi-hop depth (hops)",(0,a.jsx)("input",{type:"number",min:1,max:5,step:1,value:F.max_hops,onChange:e=>A("max_hops",parseInt(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Beam size",(0,a.jsx)("input",{type:"number",min:1,max:32,step:1,value:F.beam_size,onChange:e=>A("beam_size",parseInt(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,a.jsxs)("label",{className:"flex flex-col text-sm text-secondary-800 dark:text-secondary-200",children:["Graph expansion depth",(0,a.jsx)("input",{type:"number",min:1,max:5,step:1,value:F.graph_expansion_depth,onChange:e=>A("graph_expansion_depth",parseInt(e.target.value)||0),className:"mt-1 rounded border border-secondary-200 bg-white p-2 text-secondary-900 dark:border-secondary-700 dark:bg-secondary-800 dark:text-white"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-secondary-800 dark:text-secondary-200",children:[(0,a.jsx)("input",{type:"checkbox",checked:F.restrict_to_context,onChange:e=>A("restrict_to_context",e.target.checked),className:"h-4 w-4 rounded border-secondary-300 text-primary-600 focus:ring-primary-500"}),"Restrict retrieval to selected context"]})]})]}),(0,a.jsx)(N,{onSend:z,onStop:P,disabled:m,isStreaming:g,userMessages:O})]})})]})}var M=s(6514),I=s(4380),U=s(2863),q=s(9442),Z=s(8431),P=s(301),A=s(5896),R=s(2238),z=s(2266),T=s(1581);let O=e=>{var t;return null!==(t=null==e?void 0:e.includes("pdf"))&&void 0!==t&&t},H=e=>{var t;return null!==(t=null==e?void 0:e.startsWith("image/"))&&void 0!==t&&t},W=e=>{var t;return null!==(t=(null==e?void 0:e.includes("markdown"))||(null==e?void 0:e.includes("text/markdown"))||(null==e?void 0:e.includes("text/x-markdown")))&&void 0!==t&&t},B=e=>!!e&&"text/plain"===e,V=e=>!!e&&(e.includes("officedocument")||e.includes("ms-word")||e.includes("ms-excel")||e.includes("ms-powerpoint")||e.includes("application/vnd.ms-")||"application/msword"===e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===e);function G(e){let t,{previewUrl:s,mimeType:r,content:o,onClose:l}=e,[i,d]=(0,n.useState)(""),[c,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(null==l||l())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[l]),(0,n.useEffect)(()=>{(o||s)&&(u(!0),(async()=>{try{let e=o;if(!e&&s){let t=await fetch(s);if(!t.ok)throw Error("Failed to fetch content");e=await t.text()}if(!e){d("<p>No content available</p>"),u(!1);return}let t=await (0,z.TU)(e),a=T.Z.sanitize(t);d("<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Document Preview</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;\n      line-height: 1.6;\n      color: #1f2937;\n      background: #fff;\n      padding: 2rem;\n      max-width: 900px;\n      margin: 0 auto;\n    }\n    \n    @media (prefers-color-scheme: dark) {\n      body {\n        background: #1f2937;\n        color: #f3f4f6;\n      }\n      \n      a {\n        color: #60a5fa;\n      }\n      \n      a:visited {\n        color: #a78bfa;\n      }\n      \n      code {\n        background: #111827 !important;\n        color: #e5e7eb;\n      }\n      \n      pre {\n        background: #111827 !important;\n        color: #e5e7eb;\n      }\n      \n      blockquote {\n        border-left-color: #4b5563;\n        color: #d1d5db;\n      }\n      \n      table {\n        border-color: #4b5563;\n      }\n      \n      th, td {\n        border-color: #4b5563;\n      }\n    }\n    \n    h1, h2, h3, h4, h5, h6 {\n      margin-top: 1.5rem;\n      margin-bottom: 1rem;\n      font-weight: 600;\n    }\n    \n    h1 {\n      font-size: 2rem;\n      border-bottom: 2px solid #e5e7eb;\n      padding-bottom: 0.5rem;\n    }\n    \n    @media (prefers-color-scheme: dark) {\n      h1 {\n        border-bottom-color: #4b5563;\n      }\n    }\n    \n    h2 {\n      font-size: 1.5rem;\n    }\n    \n    h3 {\n      font-size: 1.25rem;\n    }\n    \n    p {\n      margin-bottom: 1rem;\n    }\n    \n    a {\n      color: #2563eb;\n      text-decoration: none;\n    }\n    \n    a:hover {\n      text-decoration: underline;\n    }\n    \n    code {\n      background: #f3f4f6;\n      padding: 0.2rem 0.4rem;\n      border-radius: 3px;\n      font-family: 'Monaco', 'Courier New', monospace;\n      font-size: 0.9em;\n    }\n    \n    pre {\n      background: #f3f4f6;\n      padding: 1rem;\n      border-radius: 5px;\n      overflow-x: auto;\n      margin-bottom: 1rem;\n      font-family: 'Monaco', 'Courier New', monospace;\n    }\n    \n    pre code {\n      background: none;\n      padding: 0;\n      border-radius: 0;\n    }\n    \n    blockquote {\n      border-left: 4px solid #e5e7eb;\n      padding-left: 1rem;\n      margin-left: 0;\n      margin-bottom: 1rem;\n      color: #6b7280;\n    }\n    \n    ul, ol {\n      margin-left: 2rem;\n      margin-bottom: 1rem;\n    }\n    \n    li {\n      margin-bottom: 0.5rem;\n    }\n    \n    table {\n      border-collapse: collapse;\n      width: 100%;\n      margin-bottom: 1rem;\n      border: 1px solid #e5e7eb;\n    }\n    \n    th, td {\n      border: 1px solid #e5e7eb;\n      padding: 0.75rem;\n      text-align: left;\n    }\n    \n    th {\n      background: #f9fafb;\n      font-weight: 600;\n    }\n    \n    @media (prefers-color-scheme: dark) {\n      th {\n        background: #111827;\n      }\n    }\n    \n    img {\n      max-width: 100%;\n      height: auto;\n      margin: 1rem 0;\n    }\n    \n    hr {\n      border: none;\n      border-top: 1px solid #e5e7eb;\n      margin: 2rem 0;\n    }\n  </style>\n</head>\n<body>\n".concat(a,"\n</body>\n</html>"))}catch(e){console.error("Failed to process markdown:",e),d("<p>Failed to process markdown content</p>")}finally{u(!1)}})())},[o,s]);return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:(0,a.jsxs)("div",{className:"relative w-full max-w-5xl bg-white dark:bg-secondary-800 rounded-xl shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-secondary-200 dark:border-secondary-700 px-4 py-3 bg-secondary-50 dark:bg-secondary-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:"Document Preview"}),(0,a.jsx)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:"Press Escape to close"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s&&(0,a.jsxs)("a",{href:s,target:"_blank",rel:"noreferrer",className:"button-ghost text-xs flex items-center gap-1",children:[(0,a.jsx)(R.Z,{className:"w-4 h-4"}),"Open in new tab"]}),(0,a.jsxs)("button",{type:"button",onClick:l,className:"button-secondary text-xs flex items-center gap-1",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),"Close"]})]})]}),(0,a.jsx)("div",{className:"h-[70vh] bg-secondary-100 dark:bg-secondary-900 p-4 overflow-auto",children:c?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-secondary-600 dark:text-secondary-400",children:"Processing markdown..."})}):i?W(r)||B(r)?(0,a.jsx)("iframe",{srcDoc:i,title:"Markdown preview",className:"w-full h-full border-none rounded-lg",sandbox:"allow-same-origin allow-scripts"}):s?O(r)?(0,a.jsx)("iframe",{src:s,title:"PDF preview",className:"w-full h-full rounded-lg border border-secondary-200"}):H(r)?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("img",{src:s,alt:"Document preview",className:"max-h-full max-w-full rounded-lg shadow"})}):V(r)&&(s.startsWith("http://")||s.startsWith("https://"))?(0,a.jsxs)("div",{className:"w-full h-full space-y-4",children:[(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-sm text-yellow-800",children:[(0,a.jsx)("p",{className:"font-medium",children:"Office Document Viewer"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"Using Microsoft Office Online viewer. If the document doesn't load, try opening it in a new tab or downloading it."})]}),(0,a.jsx)("iframe",{src:(t=s,"https://view.officeapps.live.com/op/embed.aspx?src=".concat(encodeURIComponent(t))),title:"Office document preview",className:"w-full h-[calc(100%-5rem)] rounded-lg border border-secondary-200"})]}):(0,a.jsx)("iframe",{src:s,title:"Document preview",className:"w-full h-full rounded-lg border border-secondary-200 dark:border-secondary-600 bg-white dark:bg-secondary-800"}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-secondary-600 dark:text-secondary-400",children:"Unable to preview this document"})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("div",{className:"text-secondary-600 dark:text-secondary-400",children:"No content available"})})})]})})}let K=(0,s(7818).default)(()=>Promise.all([s.e(689),s.e(197),s.e(319),s.e(982),s.e(315)]).then(s.bind(s,9315)),{loadableGenerated:{webpack:()=>[9315]},ssr:!1}),Q=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2","#F8B88B","#A9CCE3"];function Y(e){let{documentId:t,height:s=500}=e,[r,l]=(0,n.useState)(null),[i,d]=(0,n.useState)(!0),[c,u]=(0,n.useState)(null),[m,x]=(0,n.useState)(800);(0,n.useEffect)(()=>{let e=async()=>{try{d(!0),u(null);let e=await o.h.getGraph({document_id:t});l(e)}catch(e){console.error("Failed to load document graph:",e),u("Failed to load graph data")}finally{d(!1)}};t&&e()},[t]),(0,n.useEffect)(()=>{let e=()=>{let e=document.getElementById("graph-".concat(t));e&&x(e.offsetWidth-2)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[t]);let h=e=>null==e?"#9ca3af":Q[e%Q.length],p=(0,n.useMemo)(()=>r?{nodes:r.nodes.map(e=>({id:e.id,name:e.label,val:Math.max(2*Math.sqrt(e.degree||1),2),color:h(e.community_id),type:e.type,communityId:e.community_id,degree:e.degree})),links:r.edges.map(e=>({source:e.source,target:e.target,value:e.weight||1,type:e.type,description:e.description}))}:{nodes:[],links:[]},[r]);return i?(0,a.jsx)("div",{id:"graph-".concat(t),style:{height:"".concat(s,"px")},className:"flex items-center justify-center bg-slate-50 dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-700",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-2"}),(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Loading graph..."})]})}):c||!r?(0,a.jsx)("div",{id:"graph-".concat(t),style:{height:"".concat(s,"px")},className:"flex items-center justify-center bg-red-50 dark:bg-red-950 rounded-lg border border-red-200 dark:border-red-700",children:(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:c||"No graph data available"})}):r&&Array.isArray(r.nodes)&&0===r.nodes.length?(0,a.jsx)("div",{id:"graph-".concat(t),style:{height:"".concat(s,"px")},className:"flex items-center justify-center bg-slate-50 dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-700",children:(0,a.jsxs)("div",{className:"text-center p-6",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"No entities extracted for this document"}),(0,a.jsx)("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-4",children:"Run entity extraction to populate the graph and community data."}),(0,a.jsx)("button",{type:"button",onClick:async()=>{try{d(!0),u(null),await o.h.reprocessDocumentEntities(t),window.dispatchEvent(new CustomEvent("documents:processing-updated"))}catch(e){console.error("Failed to queue entity extraction",e),u("Failed to queue entity extraction")}finally{d(!1)}},className:"button-primary px-4 py-2 text-sm",children:"Process entities"})]})}):(0,a.jsxs)("div",{id:"graph-".concat(t),className:"w-full border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{style:{height:"".concat(s,"px"),width:"".concat(m,"px")},children:(0,a.jsx)(K,{graphData:p,nodeLabel:e=>"".concat(e.name," (").concat(e.type,")"),nodeColor:e=>e.color,nodeVal:e=>e.val,linkWidth:e=>.5*Math.sqrt(e.value||1),linkColor:()=>"#cbd5e1",linkOpacity:.5,backgroundColor:"#f8fafc",height:s,width:m})}),(0,a.jsxs)("div",{className:"text-xs text-slate-500 dark:text-slate-400 p-2 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900",children:[(0,a.jsxs)("span",{children:[r.nodes.length," entities"]})," \xb7 ",(0,a.jsxs)("span",{children:[r.edges.length," relationships"]}),r.communities&&r.communities.length>0&&(0,a.jsxs)(a.Fragment,{children:[" \xb7 ",(0,a.jsxs)("span",{children:[r.communities.length," communities"]})]})]})]})}var J=s(7138);function X(e){let{documentId:t,communities:s}=e,[r,l]=(0,n.useState)(s||[]),[i,d]=(0,n.useState)(!0),[c,u]=(0,n.useState)(!s),[x,h]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{(async()=>{if(!s)try{u(!0);let e=await o.h.getGraph({document_id:t,limit:1e3});if(0===e.nodes.length){l([]);return}let s=new Map;e.nodes.forEach(e=>{if(null!==e.community_id&&void 0!==e.community_id){let t=e.community_id,a=s.get(t)||{community_id:e.community_id,level:e.level,count:0};a.count+=1,s.set(t,a)}}),l(Array.from(s.values()).sort((e,t)=>e.community_id-t.community_id))}catch(e){console.error("Failed to load communities:",e),l([])}finally{u(!1)}})()},[t,s]),c)return(0,a.jsx)("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden",children:(0,a.jsxs)("button",{onClick:()=>d(!i),className:"w-full flex items-center gap-2 px-4 py-3 font-semibold text-slate-900 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 transition-transform ".concat(i?"":"-rotate-90")}),(0,a.jsx)("span",{children:"Communities"}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-slate-600 dark:text-slate-400",children:"Loading..."})]})});let p=async()=>{try{h(!0),await o.h.reprocessDocumentEntities(t),window.dispatchEvent(new CustomEvent("documents:processing-updated"))}catch(e){console.error("Failed to queue entity extraction",e)}finally{h(!1)}};return 0===r.length?(0,a.jsxs)("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>d(!i),className:"w-full flex items-center gap-2 px-4 py-3 font-semibold text-slate-900 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 transition-transform ".concat(i?"":"-rotate-90")}),(0,a.jsx)("span",{children:"Communities"}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-slate-600 dark:text-slate-400",children:"None"})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:[(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-3",children:"No communities found for this document."}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:p,disabled:x,className:"button-primary text-sm px-4 py-2",children:x?"Queuing...":"Process entities"}),(0,a.jsx)("button",{onClick:()=>d(!0),className:"button-secondary text-sm px-3 py-2",children:"Refresh"})]})]})]}):(0,a.jsxs)("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>d(!i),className:"w-full flex items-center gap-2 px-4 py-3 font-semibold text-slate-900 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 transition-transform ".concat(i?"":"-rotate-90")}),(0,a.jsx)("span",{children:"Communities"}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-slate-600 dark:text-slate-400",children:r.length})]}),i&&(0,a.jsx)("div",{className:"border-t border-slate-200 dark:border-slate-700 p-4",children:(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 hover:bg-slate-100 dark:hover:bg-slate-900 transition",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-medium text-slate-900 dark:text-slate-100",children:["Community ",e.community_id]}),(0,a.jsxs)("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:[e.count," entities",void 0!==e.level&&" \xb7 Level ".concat(e.level)]})]}),(0,a.jsx)(J.default,{href:"/graph?community=".concat(e.community_id),className:"text-xs px-3 py-1 rounded bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-800 transition",children:"View"})]},"".concat(e.community_id,"-").concat(e.level)))})})]})}function $(e){let{documentId:t}=e,[s,r]=(0,n.useState)([]),[l,i]=(0,n.useState)(!0),[d,c]=(0,n.useState)(!0),[u,x]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{c(!0),x(null);let e=await o.h.getDocumentChunkSimilarities(t);r(e.similarities||[])}catch(e){console.error("Failed to load chunk similarities:",e),x("Failed to load similarities")}finally{c(!1)}})()},[t]);let h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return e?e.length>t?e.slice(0,t)+"...":e:"(no content)"};return d?(0,a.jsx)("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden",children:(0,a.jsxs)("button",{onClick:()=>i(!l),className:"w-full flex items-center gap-2 px-4 py-3 font-semibold text-slate-900 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 transition-transform ".concat(l?"":"-rotate-90")}),(0,a.jsx)("span",{children:"Chunk Similarities"}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-slate-600 dark:text-slate-400",children:"Loading..."})]})}):u?(0,a.jsx)("div",{className:"rounded-lg border border-red-200 dark:border-red-700 bg-red-50 dark:bg-red-900/20 overflow-hidden",children:(0,a.jsxs)("button",{onClick:()=>i(!l),className:"w-full flex items-center gap-2 px-4 py-3 font-semibold text-red-900 dark:text-red-100 hover:bg-red-100 dark:hover:bg-red-900/30 transition",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 transition-transform ".concat(l?"":"-rotate-90")}),(0,a.jsx)("span",{children:"Chunk Similarities"}),(0,a.jsx)("span",{className:"ml-auto text-xs text-red-600 dark:text-red-400",children:u})]})}):0===s.length?(0,a.jsx)("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden",children:(0,a.jsxs)("button",{onClick:()=>i(!l),className:"w-full flex items-center gap-2 px-4 py-3 font-semibold text-slate-900 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 transition-transform ".concat(l?"":"-rotate-90")}),(0,a.jsx)("span",{children:"Chunk Similarities"}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-slate-600 dark:text-slate-400",children:"None"})]})}):(0,a.jsxs)("div",{className:"rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden",children:[(0,a.jsxs)("button",{onClick:()=>i(!l),className:"w-full flex items-center gap-2 px-4 py-3 font-semibold text-slate-900 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 transition-transform ".concat(l?"":"-rotate-90")}),(0,a.jsx)("span",{children:"Chunk Similarities"}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-slate-600 dark:text-slate-400",children:s.length})]}),l&&(0,a.jsx)("div",{className:"border-t border-slate-200 dark:border-slate-700 p-4",children:(0,a.jsx)("div",{className:"space-y-3",children:s.map((e,t)=>(0,a.jsxs)("div",{className:"p-3 rounded border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 hover:bg-slate-100 dark:hover:bg-slate-900 transition",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300",children:"Similarity"}),(0,a.jsxs)("span",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:[(100*e.score).toFixed(0),"%"]})]}),(0,a.jsxs)("code",{className:"text-xs text-slate-500 dark:text-slate-400",children:[e.chunk1_id.slice(0,8),"..."]})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1",children:"Chunk 1"}),(0,a.jsx)("p",{className:"text-xs text-slate-600 dark:text-slate-400 bg-white dark:bg-slate-800 p-2 rounded border border-slate-200 dark:border-slate-700",children:h(e.chunk1_text)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1",children:"Chunk 2"}),(0,a.jsx)("p",{className:"text-xs text-slate-600 dark:text-slate-400 bg-white dark:bg-slate-800 p-2 rounded border border-slate-200 dark:border-slate-700",children:h(e.chunk2_text)})]})]}),(0,a.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:(0,a.jsxs)("code",{className:"text-xs text-slate-600 dark:text-slate-300",children:[e.chunk1_id.slice(0,12),"... ↔ ",e.chunk2_id.slice(0,12),"..."]})})]},"".concat(e.chunk1_id,"-").concat(e.chunk2_id,"-").concat(t)))})})]})}let ee={url:null,isLoading:!1,mimeType:void 0,error:null,objectUrl:null,content:null};function et(){var e,t,s,r,u,m,g;let y=p(e=>e.selectedDocumentId),b=p(e=>e.selectedChunkId),f=p(e=>e.clearSelectedDocument),v=p(e=>e.clearSelectedChunk),k=p(e=>e.selectDocument),[j,w]=(0,n.useState)(null),[N,_]=(0,n.useState)(null),[C,S]=(0,n.useState)(!1),[E,D]=(0,n.useState)(null),[L,F]=(0,n.useState)({}),[R,z]=(0,n.useState)(ee),[T,O]=(0,n.useState)(!1),[H,W]=(0,n.useState)({}),[B,V]=(0,n.useState)(null),[K,Q]=(0,n.useState)(null),[J,et]=(0,n.useState)(null),[es,ea]=(0,n.useState)(!1),en=(0,n.useRef)(!1),[er,eo]=(0,n.useState)(!1),[el,ei]=(0,n.useState)(""),[ed,ec]=(0,n.useState)(null),[eu,em]=(0,n.useState)(!1),[ex,eh]=(0,n.useState)(!1),[ep,eg]=(0,n.useState)(!1),ey=(0,n.useCallback)(async()=>{try{let e=await o.h.getProcessingProgress();V(e.global)}catch(e){console.error("Failed to load processing state",e)}},[]),eb=(0,n.useCallback)(async()=>{try{let e=await o.h.getSettings();ec(e)}catch(e){console.error("Failed to load settings",e)}},[]);(0,n.useEffect)(()=>{try{let e=new URLSearchParams(window.location.search),t=e.get("doc"),s=e.get("chunk"),a=e.get("chunk_id");if(t){if(y&&y===t||k(t),s){let e=Number(s);if(!Number.isNaN(e)){let s=p.getState&&p.getState().selectDocumentChunk||null;s&&s(t,e)}}else if(a){let e=p.getState&&p.getState().selectDocumentChunk||null;e&&e(t,a)}}}catch(e){}},[k,y]),(0,n.useEffect)(()=>{let e=!0,t=async t=>{S(!0),D(null),w(null),z(ee),O(!1),W({});try{let s=await o.h.getDocument(t);e&&(w(s),_(null))}catch(t){e&&D(t instanceof Error?t.message:"Failed to load document")}finally{e&&S(!1)}};y?(t(y),ey(),eb()):(w(null),z(ee),O(!1),W({}),_(null),V(null),ec(null));let s=()=>{y&&(t(y),ey())},a=()=>{ey()};return window.addEventListener("documents:processed",s),window.addEventListener("documents:processing-updated",a),()=>{e=!1,window.removeEventListener("documents:processed",s),window.removeEventListener("documents:processing-updated",a)}},[ey,eb,y]),(0,n.useEffect)(()=>{let e=!0;return(async()=>{if(j)try{let t=await o.h.hasDocumentPreview(j.id);e&&_(t)}catch(t){e&&_(!1)}})(),()=>{e=!1}},[j]),(0,n.useEffect)(()=>{if(null!==b&&j){let e=j.chunks.find(e=>e.index===b||e.id===b);e&&F(t=>({...t,[e.id]:!0})),v()}},[b,j,v]),(0,n.useEffect)(()=>()=>{R.objectUrl&&URL.revokeObjectURL(R.objectUrl)},[R.objectUrl]);let ef=(0,n.useMemo)(()=>{var e;return(null==j?void 0:null===(e=j.entities)||void 0===e?void 0:e.length)?j.entities.reduce((e,t)=>{let s=t.type||"Unknown";return e[s]||(e[s]=[]),e[s].push(t),e},{}):{}},[null==j?void 0:j.entities]),ev=(0,n.useMemo)(()=>{var e,t;if(!j)return!1;let s=(null===(e=j.mime_type)||void 0===e?void 0:e.toLowerCase())||"";if(new Set(["text/markdown","text/x-markdown","text/md","text/x-md","application/markdown"]).has(s))return!0;let a=(null===(t=j.file_name)||void 0===t?void 0:t.toLowerCase())||"";return a.endsWith(".md")||a.endsWith(".markdown")},[j]),ek=(0,n.useCallback)(e=>{F(t=>({...t,[e.id]:!t[e.id]}))},[]),ej=(0,n.useCallback)(async e=>{try{await navigator.clipboard.writeText(e.text)}catch(e){console.error("Failed to copy chunk",e)}},[]),ew=(0,n.useCallback)(async()=>{if(y){if(R.objectUrl&&URL.revokeObjectURL(R.objectUrl),null==j?void 0:j.preview_url){z({url:j.preview_url,mimeType:j.mime_type,isLoading:!1,error:null});return}z({url:null,mimeType:void 0,isLoading:!0,error:null,objectUrl:null,content:null});try{let s=await o.h.getDocumentPreview(y);if("preview_url"in s){z({url:s.preview_url,mimeType:null==j?void 0:j.mime_type,isLoading:!1,error:null});return}if("content"in s){let e=s.mime_type||(null==j?void 0:j.mime_type),t=s.content;z({url:null,mimeType:e,isLoading:!1,error:null,objectUrl:null,content:t});return}if(s instanceof Response){var e,t;let a=(null===(t=s.headers)||void 0===t?void 0:null===(e=t.get)||void 0===e?void 0:e.call(t,"Content-Type"))||(null==j?void 0:j.mime_type);if((null==a?void 0:a.toLowerCase().includes("markdown"))||(null==a?void 0:a.toLowerCase().includes("text/"))){let e=await s.text();z({url:null,mimeType:a,isLoading:!1,error:null,objectUrl:null,content:e});return}let n=await s.blob(),r=URL.createObjectURL(n);z({url:r,mimeType:a,isLoading:!1,error:null,objectUrl:r});return}if("object_url"in s){z({url:s.object_url,mimeType:s.mime_type,isLoading:!1,error:null,objectUrl:s.object_url});return}throw Error("Unexpected response format from preview endpoint")}catch(e){z({url:null,mimeType:void 0,isLoading:!1,error:e instanceof Error?e.message:"Unable to load preview",objectUrl:null}),console.error("Failed to load preview",e)}}},[null==j?void 0:j.mime_type,null==j?void 0:j.preview_url,R.objectUrl,y]),eN=(0,n.useCallback)(()=>{R.objectUrl&&URL.revokeObjectURL(R.objectUrl),z(ee)},[R.objectUrl]),e_=(0,n.useCallback)(async()=>{if(null==j?void 0:j.id){ea(!0),et(null),Q(null);try{await o.h.reprocessDocumentChunks(j.id),Q("Chunk processing queued"),await ey(),window.dispatchEvent(new CustomEvent("documents:processing-updated"))}catch(e){et(e instanceof Error?e.message:"Failed to queue chunk processing")}finally{ea(!1)}}},[null==j?void 0:j.id,ey]),eC=(0,n.useCallback)(async()=>{if(null==j?void 0:j.id){ea(!0),et(null),Q(null);try{await o.h.reprocessDocumentEntities(j.id),Q("Entity extraction queued"),await ey(),window.dispatchEvent(new CustomEvent("documents:processing-updated"))}catch(e){et(e instanceof Error?e.message:"Failed to queue entity extraction")}finally{ea(!1)}}},[null==j?void 0:j.id,ey]),eS=(0,n.useCallback)(async()=>{if(null==j?void 0:j.id){ea(!0),et(null),Q(null);try{await o.h.generateDocumentSummary(j.id),Q("Summary generated successfully");let e=await o.h.getDocument(j.id);w(e)}catch(e){et(e instanceof Error?e.message:"Failed to generate summary")}finally{ea(!1)}}},[null==j?void 0:j.id]),eE=(0,n.useCallback)(()=>{ei(""),eo(!0)},[]),eD=(0,n.useCallback)(async e=>{if(null==j?void 0:j.id){et(null);try{await o.h.updateDocumentHashtags(j.id,e);let t=await o.h.getDocument(j.id);w(t)}catch(e){et(e instanceof Error?e.message:"Failed to update hashtags")}}},[null==j?void 0:j.id]),eL=(0,n.useCallback)(async e=>{if(!(null==j?void 0:j.hashtags))return;let t=j.hashtags.filter(t=>t!==e);await eD(t)},[null==j?void 0:j.hashtags,eD]),eF=(0,n.useCallback)(async()=>{let e=el.trim();if(!e)return;e.startsWith("#")||(e="#"+e);let t=(null==j?void 0:j.hashtags)||[];if(t.includes(e)){ei("");return}let s=[...t,e];await eD(s),ei("")},[el,null==j?void 0:j.hashtags,eD]),eM=(0,n.useCallback)(e=>{"Enter"===e.key&&(e.preventDefault(),eF())},[eF]);(0,n.useEffect)(()=>{if(!K)return;let e=window.setTimeout(()=>Q(null),4e3);return()=>window.clearTimeout(e)},[K]),(0,n.useEffect)(()=>{if(!J)return;let e=window.setTimeout(()=>et(null),5e3);return()=>window.clearTimeout(e)},[J]),(0,n.useEffect)(()=>{let e=!!(null==B?void 0:B.is_processing),t=en.current;if(en.current=e,e&&y){let e=window.setInterval(()=>{ey(),(async()=>{try{let e=await o.h.getDocument(y);w(e)}catch(e){console.error("Failed to refresh document during processing:",e)}})()},2e3);return()=>window.clearInterval(e)}t&&!e&&window.dispatchEvent(new CustomEvent("documents:processed"))},[null==B?void 0:B.is_processing,ey,y]);let eI=es||!!(null==B?void 0:B.is_processing),eU=(null==B?void 0:B.is_processing)?"Processing is already running for another document":void 0,eq=(null==ed?void 0:ed.enable_entity_extraction)===!1,eZ=eI||eq,eP=eq?"Entity extraction is deactivated in settings":eU,eA=(0,n.useCallback)(e=>{e.id&&k(e.id)},[k]),eR=(0,n.useCallback)(e=>{W(t=>({...t,[e]:!t[e]}))},[]),ez=(0,n.useCallback)(()=>{em(e=>!e)},[]),eT=(0,n.useCallback)(()=>{eh(e=>!e)},[]),eO=(0,n.useCallback)(()=>{eg(e=>!e)},[]);return y?(0,a.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,a.jsxs)("div",{className:"border-b border-secondary-200 dark:border-secondary-700 bg-white dark:bg-secondary-800 px-6 py-4 flex items-center gap-4",children:[(0,a.jsxs)("button",{type:"button",onClick:f,className:"button-secondary flex items-center gap-2 text-sm",children:[(0,a.jsx)(M.Z,{className:"w-4 h-4"}),"Back to chat"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.Z,{className:"w-6 h-6 text-primary-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-secondary-900 dark:text-secondary-50",children:(null==j?void 0:j.title)||(null==j?void 0:j.original_filename)||(null==j?void 0:j.file_name)||"Unnamed document"}),(0,a.jsx)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:(null==j?void 0:j.document_type)?j.document_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown type"})]})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(null==j?void 0:j.uploaded_at)&&(0,a.jsxs)("span",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:["Uploaded ",new Date(j.uploaded_at).toLocaleString()]}),(null===N?null==j?void 0:j.preview_url:N)&&(0,a.jsxs)("button",{type:"button",onClick:ew,className:"button-primary text-sm flex items-center gap-2",disabled:R.isLoading,children:[(0,a.jsx)(I.Z,{className:"w-4 h-4"}),R.isLoading?"Loading preview…":"Open preview"]}),R.error&&(0,a.jsx)("span",{className:"text-xs text-red-600 dark:text-red-400",children:R.error})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-6 bg-secondary-50 dark:bg-secondary-900",children:[C&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 text-secondary-500 dark:text-secondary-400",children:[(0,a.jsx)(U.Z,{className:"w-10 h-10 animate-spin"}),(0,a.jsx)("p",{className:"mt-3 text-sm",children:"Loading document metadata…"})]}),E&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 flex items-start gap-2",children:[(0,a.jsx)(q.Z,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:"Failed to load document"}),(0,a.jsx)("p",{className:"text-sm",children:E})]})]}),!C&&!E&&j&&(0,a.jsxs)("div",{className:"space-y-6",children:[K&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-700 rounded-lg px-4 py-3 text-sm",children:K}),J&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg px-4 py-3 text-sm",children:J}),(null===(e=j.metadata)||void 0===e?void 0:e.processing_status)==="staged"&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 rounded-lg px-4 py-3 text-sm",children:[(0,a.jsx)("p",{className:"font-medium mb-1",children:"Document ready to process"}),(0,a.jsxs)("p",{children:["This document has been uploaded but not yet processed. Go to the ",(0,a.jsx)("strong",{children:"Upload"})," tab in the sidebar and click ",(0,a.jsx)("strong",{children:"Process All"})," to begin processing."]})]}),(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700 p-5",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-4",children:"Overview"}),(0,a.jsxs)("dl",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"File name"}),(0,a.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:j.original_filename||j.file_name||"Unknown"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Mime type"}),(0,a.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:j.mime_type||"Unknown"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Uploader"}),(0,a.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:(null===(t=j.uploader)||void 0===t?void 0:t.name)||(null===(s=j.uploader)||void 0===s?void 0:s.id)||"Unknown"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Uploaded at"}),(0,a.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:j.uploaded_at?new Date(j.uploaded_at).toLocaleString():"Unknown"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Chunk count"}),(0,a.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:j.chunks.length})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400",children:"Preview available"}),(0,a.jsx)("dd",{className:"text-secondary-900 dark:text-secondary-50",children:null===N?j.preview_url?"Yes":"No":N?"Yes":"No"})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-secondary-200 dark:border-secondary-700",children:[(0,a.jsx)("dt",{className:"text-secondary-500 dark:text-secondary-400 text-sm mb-2",children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 cursor-pointer p-2 -m-2 rounded hover:bg-secondary-50 dark:hover:bg-secondary-900 transition-colors",onClick:eE,children:er?(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 w-full",onClick:e=>e.stopPropagation(),children:[(j.hashtags||[]).map((e,t)=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-300",children:[e,(0,a.jsx)("button",{type:"button",onMouseDown:t=>{t.preventDefault(),t.stopPropagation(),eL(e)},className:"hover:text-primary-900",children:(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t)),(0,a.jsxs)("div",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)("input",{type:"text",value:el,onChange:e=>ei(e.target.value),onKeyDown:eM,onBlur:()=>eo(!1),placeholder:"Add tag...",className:"px-2.5 py-0.5 text-xs border border-secondary-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",autoFocus:!0}),(0,a.jsx)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),eF()},className:"text-primary-600 hover:text-primary-700",disabled:!el.trim(),children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]})]}):(0,a.jsxs)(a.Fragment,{children:[(j.hashtags||[]).map((e,t)=>(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-300",children:e},t)),(!j.hashtags||0===j.hashtags.length)&&(0,a.jsx)("span",{className:"text-sm text-secondary-400",children:"Click to add tags"})]})})]})]}),(j.summary||j.chunks.length>0||(null===(r=j.metadata)||void 0===r?void 0:r.processing_status)!=="staged")&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,a.jsx)("header",{className:"flex items-center justify-between px-5 py-4 border-b border-secondary-200 dark:border-secondary-700",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Summary"}),j.document_type&&(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary-100 dark:bg-secondary-700 text-secondary-700 dark:text-secondary-200",children:j.document_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),!j.summary&&j.chunks.length>0&&(null===(u=j.metadata)||void 0===u?void 0:u.processing_status)!=="staged"&&(0,a.jsx)("button",{type:"button",onClick:eS,className:"button-primary text-xs",disabled:eI,title:eU,children:"Generate summary"})]})}),(0,a.jsx)("div",{className:"px-5 py-4",children:j.summary?(0,a.jsx)("div",{className:"prose prose-sm prose-slate dark:prose-invert dark:text-secondary-200 max-w-none",children:(0,a.jsx)(l.UG,{remarkPlugins:[i.Z,d.Z],children:j.summary})}):(0,a.jsx)("p",{className:"text-sm text-secondary-500 dark:text-secondary-400",children:"No summary generated yet."})})]})}),(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between px-5 py-4 ".concat(eu?"border-b border-secondary-200 dark:border-secondary-700":""),children:[(0,a.jsxs)("button",{type:"button",onClick:ez,className:"flex items-center gap-2 hover:bg-secondary-50 dark:hover:bg-secondary-700 rounded px-2 py-1 -mx-2 transition-colors",children:[eu?(0,a.jsx)(P.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,a.jsx)(A.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Chunks"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[0===j.chunks.length&&(null===(m=j.metadata)||void 0===m?void 0:m.processing_status)!=="staged"&&!(null==B?void 0:B.is_processing)&&(0,a.jsx)("button",{type:"button",onClick:e_,className:"button-primary text-xs",disabled:eI,title:eU,children:"Process chunks"}),(0,a.jsxs)("span",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:[j.chunks.length," entries"]})]})]}),(0,a.jsx)(x.M,{children:eu&&(0,a.jsx)(h.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"divide-y divide-secondary-200 dark:divide-secondary-700 overflow-hidden",children:0===j.chunks.length?(0,a.jsx)("p",{className:"px-5 py-4 text-sm text-secondary-500 dark:text-secondary-400",children:"No chunks processed yet."}):(0,a.jsxs)(a.Fragment,{children:[(T?j.chunks:j.chunks.slice(0,10)).map(e=>{var t;let s=L[e.id],n=((e.text||"").split(/\r?\n/)[0]||"").trim()||"No preview available";return(0,a.jsxs)("article",{className:"px-5 py-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:["Chunk ","number"==typeof e.index?e.index+1:e.id]}),(0,a.jsx)("div",{className:"relative overflow-hidden pr-8",children:(0,a.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50 break-words break-all",children:n})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>ej(e),className:"button-ghost text-xs flex items-center gap-1",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4"}),"Copy"]}),(0,a.jsx)("button",{type:"button",onClick:()=>ek(e),className:"button-secondary text-xs flex items-center gap-1",children:s?(0,a.jsx)(P.Z,{className:"w-4 h-4"}):(0,a.jsx)(A.Z,{className:"w-4 h-4"})})]})]}),(0,a.jsx)(x.M,{children:s&&(0,a.jsx)(h.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"mt-3 text-sm text-secondary-800 dark:text-secondary-200 leading-relaxed overflow-hidden border-t border-secondary-200 dark:border-secondary-700 pt-3",children:ev?(0,a.jsx)(l.UG,{className:"prose prose-sm prose-slate dark:prose-invert dark:text-secondary-100 max-w-none break-words",remarkPlugins:[i.Z,d.Z],children:e.text||""}):(0,a.jsx)("p",{className:"whitespace-pre-wrap break-words",children:null!==(t=e.text)&&void 0!==t?t:""})})})]},e.id)}),j.chunks.length>10&&(0,a.jsx)("div",{className:"px-5 py-4 border-t border-secondary-200",children:(0,a.jsx)("button",{type:"button",onClick:()=>O(!T),className:"button-secondary text-sm flex items-center gap-2",children:T?"Show Less":"Show ".concat(j.chunks.length-10," more Chunks")})})]})})})]}),(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between px-5 py-4 ".concat(ex?"border-b border-secondary-200 dark:border-secondary-700":""),children:[(0,a.jsxs)("button",{type:"button",onClick:eT,className:"flex items-center gap-2 hover:bg-secondary-50 dark:hover:bg-secondary-700 rounded px-2 py-1 -mx-2 transition-colors",children:[ex?(0,a.jsx)(P.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,a.jsx)(A.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Entities"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[0===j.entities.length&&j.chunks.length>0&&(null===(g=j.metadata)||void 0===g?void 0:g.processing_status)!=="staged"&&!(null==B?void 0:B.is_processing)&&(0,a.jsx)("button",{type:"button",onClick:eC,className:"button-primary text-xs ".concat(eq?"opacity-50 cursor-not-allowed":""),disabled:eZ,title:eP,children:"Process entities"}),(0,a.jsx)("span",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:j.entities.length>0?"".concat(j.entities.length," total"):"No entities"})]})]}),(0,a.jsx)(x.M,{children:ex&&(0,a.jsx)(h.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:0===j.entities.length?(0,a.jsx)("p",{className:"px-5 py-4 text-sm text-secondary-500 dark:text-secondary-400",children:"No entities extracted yet."}):(0,a.jsx)("div",{className:"divide-y divide-secondary-100 dark:divide-secondary-700",children:Object.entries(ef).map(e=>{let[t,s]=e,n=H[t]||!1,r=n?s:s.slice(0,5),o=s.length>5;return(0,a.jsxs)("div",{className:"px-5 py-4 space-y-2",children:[(0,a.jsx)("h4",{className:"text-xs font-semibold text-secondary-500 dark:text-secondary-400 uppercase tracking-wide",children:t}),(0,a.jsx)("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:r.map(e=>{var s,n;return(0,a.jsxs)("li",{className:"border border-secondary-200 dark:border-secondary-700 rounded-lg px-3 py-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:e.text}),(0,a.jsxs)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:["Count: ",null!==(n=e.count)&&void 0!==n?n:"—"," \xb7 Positions: ",(null===(s=e.positions)||void 0===s?void 0:s.join(", "))||"—"]})]},"".concat(t,"-").concat(e.text))})}),o&&(0,a.jsx)("button",{type:"button",onClick:()=>eR(t),className:"button-secondary text-xs mt-2",children:n?"Show Less":"Show ".concat(s.length-5," more ").concat(t.toLowerCase(),"s")})]},t)})})})})]}),j.quality_scores&&(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700 p-5",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-3",children:"Quality scores"}),(0,a.jsx)("pre",{className:"bg-secondary-900 text-secondary-50 text-xs rounded-lg p-4 overflow-auto",children:JSON.stringify(j.quality_scores,null,2)})]}),j.related_documents&&j.related_documents.length>0&&(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700 p-5",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50 mb-3",children:"Related documents"}),(0,a.jsx)("ul",{className:"space-y-2",children:j.related_documents.map(e=>(0,a.jsxs)("li",{className:"flex items-center justify-between gap-3 p-3 border border-secondary-200 rounded-lg hover:bg-secondary-50 dark:hover:bg-secondary-900 transition-colors",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:e.title||e.link||e.id}),e.link&&(0,a.jsxs)("a",{href:e.link,target:"_blank",rel:"noreferrer",className:"text-xs text-primary-600 hover:underline inline-flex items-center gap-1 mt-1",children:[(0,a.jsx)("span",{children:"Open external link"}),(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),(0,a.jsx)("button",{type:"button",onClick:()=>eA(e),className:"button-secondary text-xs",children:"View"})]},e.id))})]}),j.metadata&&(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,a.jsx)("header",{className:"flex items-center justify-between px-5 py-4 ".concat(ep?"border-b border-secondary-200 dark:border-secondary-700":""),children:(0,a.jsxs)("button",{type:"button",onClick:eO,className:"flex items-center gap-2 hover:bg-secondary-50 dark:hover:bg-secondary-700 rounded px-2 py-1 -mx-2 transition-colors",children:[ep?(0,a.jsx)(P.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}):(0,a.jsx)(A.Z,{className:"w-4 h-4 text-secondary-500 dark:text-secondary-400"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Metadata"})]})}),(0,a.jsx)(x.M,{children:ep&&(0,a.jsx)(h.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:(0,a.jsx)("pre",{className:"bg-secondary-900 text-secondary-50 text-xs rounded-b-lg p-4 overflow-auto",children:JSON.stringify(j.metadata,null,2)})})})]}),(0,a.jsxs)("section",{className:"bg-white dark:bg-secondary-800 rounded-lg shadow-sm border border-secondary-200 dark:border-secondary-700",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between px-5 py-4 border-b border-secondary-200 dark:border-secondary-700",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-secondary-900 dark:text-secondary-50",children:"Graph (document)"}),(0,a.jsx)("p",{className:"text-xs text-secondary-500 dark:text-secondary-400",children:"Interactive 3D view of entities in this document"})]}),(0,a.jsx)("div",{className:"p-5",children:(0,a.jsx)(Y,{documentId:j.id,height:480})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{children:(0,a.jsx)(X,{documentId:j.id})}),(0,a.jsx)("div",{children:(0,a.jsx)($,{documentId:j.id})})]})]})]}),(R.url||R.content)&&(0,a.jsx)(G,{previewUrl:R.url,mimeType:R.mimeType,content:R.content,onClose:eN})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-secondary-600 dark:text-secondary-400",children:[(0,a.jsx)(c.Z,{className:"w-16 h-16 text-secondary-300 mb-4"}),(0,a.jsx)("p",{className:"text-base font-medium",children:"Select a document to view its details."})]})}var es=s(6844),ea=s(3009),en=s(1321),er=s(39),eo=s(4589),el=s(9808),ei=s(1604),ed=s(5781),ec=s(2560);function eu(){let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!0),l=p(e=>e.loadSession),i=p(e=>e.setSessionId),d=p(e=>e.setActiveView),c=p(e=>e.clearChat),u=p(e=>e.historyRefreshKey),m=p(e=>e.sessionId);(0,n.useEffect)(()=>{x()},[]),(0,n.useEffect)(()=>{u>0&&x()},[u]),(0,n.useEffect)(()=>{let e=()=>{x()};return window.addEventListener("server:reconnected",e),()=>{window.removeEventListener("server:reconnected",e)}},[]);let x=async()=>{try{r(!0);let e=await o.h.getHistory();t(e)}catch(e){console.error("Failed to load history:",e)}finally{r(!1)}},h=async e=>{if(confirm("Delete this conversation?"))try{await o.h.deleteConversation(e),await x()}catch(e){console.error("Failed to delete conversation:",e)}},g=async()=>{if(confirm("Clear all conversation history?"))try{await o.h.clearHistory(),c(),await x()}catch(e){console.error("Failed to clear history:",e)}};return s?(0,a.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400",children:"Loading..."}):(0,a.jsxs)("div",{className:"space-y-4",children:[e.length>0&&(0,a.jsx)("button",{onClick:g,className:"button-secondary w-full text-sm",children:"Clear All History"}),0===e.length?(0,a.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400 py-8",children:(0,a.jsx)("p",{children:"No conversation history yet"})}):(0,a.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,a.jsxs)("div",{className:"card p-3 flex items-center justify-between transition-all cursor-pointer group ".concat(m===e.session_id?"border-primary-300 shadow-primary-100 ring-1 ring-primary-100":"hover:shadow-md"),onClick:async()=>{m!==e.session_id&&(await l(e.session_id),i(e.session_id),d("chat"))},children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0 pr-8",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50 truncate",children:e.preview||"New conversation"})}),(0,a.jsxs)("p",{className:"text-xs text-secondary-600 dark:text-secondary-400 mt-1",children:[e.message_count," messages •"," ",(0,ed.Q)(new Date(e.updated_at),{addSuffix:!0})]})]}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),h(e.session_id),m===e.session_id&&c()},className:"text-red-600 hover:text-red-700 p-1 ml-2 flex-shrink-0",children:(0,a.jsx)(ec.Z,{className:"w-4 h-4"})})]},e.session_id))})]})}function em(){var e,t,s;let[r,l]=(0,n.useState)(null),[i,d]=(0,n.useState)(!0),[c,u]=(0,n.useState)(null),[m,x]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),[y,b]=(0,n.useState)(!1),[f,j]=(0,n.useState)(!1),[N,_]=(0,n.useState)(""),[C,S]=(0,n.useState)(!0),E=(0,n.useRef)(null),D=(0,n.useRef)(!1),L=(0,n.useRef)(Date.now()),F=p(e=>e.selectDocument),M=p(e=>e.clearSelectedDocument),U=p(e=>e.selectedDocumentId),q=async e=>{b(!0);try{for(let t of Array.from(e))await o.h.stageFile(t),(0,w.C)("success","".concat(t.name," uploaded"),"Document queued for processing");window.dispatchEvent(new CustomEvent("documents:uploaded"))}catch(e){console.error("Failed to stage file:",e),(0,w.C)("error","Upload failed",e instanceof Error?e.message:"Failed to upload file")}finally{b(!1)}},Z=async e=>{let t=e.target.files;t&&0!==t.length&&(await q(t),e.target.value="")},P=async e=>{e.preventDefault(),e.stopPropagation(),g(!1);let t=e.dataTransfer.files;t&&t.length>0&&await q(t)};(0,n.useEffect)(()=>{A();let e=()=>{A()};return"function"==typeof window.addEventListener&&(window.addEventListener("documents:processed",e),window.addEventListener("documents:processing-updated",e),window.addEventListener("documents:uploaded",e),window.addEventListener("server:reconnected",e)),()=>{"function"==typeof window.removeEventListener&&(window.removeEventListener("documents:processed",e),window.removeEventListener("documents:processing-updated",e),window.removeEventListener("documents:uploaded",e),window.removeEventListener("server:reconnected",e))}},[]),(0,n.useEffect)(()=>{f&&E.current&&E.current.focus()},[f]),(0,n.useEffect)(()=>{var e;if(!((null==c?void 0:c.is_processing)||(null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing)))return;let t=setInterval(async()=>{try{let e=await o.h.getProcessingProgress(),t=e.global.pending_documents&&e.global.pending_documents.length>0;if(!(e.global.is_processing||t)){console.log("Processing completed detected in polling - clearing state"),u(null),x(!1),D.current=!1,await A();return}u(e.global),L.current=Date.now(),x(!1);let s=await o.h.getStats();if(r&&e.global.pending_documents){let t=r.documents.map(t=>{let a=e.global.pending_documents.find(e=>e.document_id===t.document_id),n=s.documents.find(e=>e.document_id===t.document_id);return a?{...n,processing_status:a.status,processing_stage:a.stage||t.processing_stage,processing_progress:a.progress_percentage,queue_position:a.queue_position}:n||t});l({...s,documents:t,processing:e.global})}else l({...s,processing:e.global})}catch(e){console.error("Failed to poll processing state:",e)}},1500);return()=>clearInterval(t)},[null==c?void 0:c.is_processing,null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing,r]),(0,n.useEffect)(()=>{var e;if(!((null==c?void 0:c.is_processing)||(null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing)))return;let t=setInterval(()=>{Date.now()-L.current>3e4&&(console.warn("Processing appears stuck - no updates for 30s"),x(!0))},5e3);return()=>clearInterval(t)},[null==c?void 0:c.is_processing,null==r?void 0:null===(t=r.processing)||void 0===t?void 0:t.is_processing]),(0,n.useEffect)(()=>{var e;let t=(null==c?void 0:c.is_processing)||(null==r?void 0:null===(e=r.processing)||void 0===e?void 0:e.is_processing)||!1;D.current&&!t&&(console.log("Processing completed, refreshing stats..."),A(),setTimeout(()=>{u(null),x(!1)},1e3)),D.current=t},[null==c?void 0:c.is_processing,null==r?void 0:null===(s=r.processing)||void 0===s?void 0:s.is_processing]);let A=async()=>{try{var e,t,s,a;d(!0);let n=await o.h.getStats();return console.log("Loaded stats, is_processing:",null===(e=n.processing)||void 0===e?void 0:e.is_processing,"pending docs:",(null===(s=n.processing)||void 0===s?void 0:null===(t=s.pending_documents)||void 0===t?void 0:t.length)||0),l(n),u(n.processing||null),S(null===(a=n.enable_delete_operations)||void 0===a||a),n}catch(e){return console.error("Failed to load stats:",e),null}finally{d(!1)}},R=async e=>{if(confirm("Delete this document and all its chunks?"))try{await o.h.deleteDocument(e);let t=await A();if(U===e){if(t&&t.documents&&t.documents.length>0){let s=t.documents.findIndex(t=>t.document_id===e),a=Math.min(Math.max(0,s),t.documents.length-1),n=t.documents[a];n?F(n.document_id):M()}else M()}}catch(e){console.error("Failed to delete document:",e)}},z=e=>{F(e)},T=async()=>{if(confirm("Clear the entire database? This cannot be undone."))try{await o.h.clearDatabase(),await A(),M()}catch(e){console.error("Failed to clear database:",e)}},O=async()=>{console.log("Clearing stuck state and refreshing..."),x(!1),u(null),L.current=Date.now(),D.current=!1,await A()},H=()=>{if(!(null==r?void 0:r.documents))return[];if(!N.trim())return r.documents;let e=N.toLowerCase();return r.documents.filter(t=>(t.original_filename||t.filename||"").toLowerCase().includes(e)||(t.document_type||"").toLowerCase().includes(e))};if(i)return(0,a.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400",children:"Loading..."});let W=c||(null==r?void 0:r.processing),B=e=>{let t=e.processing_status,s=e.processing_stage,a="number"==typeof e.processing_progress?Math.round(e.processing_progress):null;return"processing"===t?"Processing".concat(s?" – ".concat(s):"").concat(null!==a?" (".concat(a,"%)"):""):"queued"===t?"Processing queued":"staged"===t?"Ready to process":"error"===t?"Needs attention":null};return(0,a.jsxs)("div",{className:"relative transition-all ".concat(h?"ring-2 ring-primary-500 rounded-lg":""),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),g(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),g(!1)},onDrop:P,children:[h&&(0,a.jsx)("div",{className:"absolute inset-0 bg-primary-50 border-2 border-dashed border-primary-500 rounded-lg flex items-center justify-center z-10",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(v.Z,{className:"w-8 h-8 text-primary-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm font-medium text-primary-700",children:"Drop files to upload"})]})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)("label",{className:"flex-1 cursor-pointer",children:[(0,a.jsxs)("div",{className:"button-primary py-2 px-3 text-center text-sm flex items-center justify-center gap-2 ".concat(y?"opacity-50 pointer-events-none":""),children:[(0,a.jsx)(v.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:y?"Uploading...":"Upload Files"})]}),(0,a.jsx)("input",{type:"file",className:"hidden",onChange:Z,disabled:y,accept:".pdf,.txt,.md,.doc,.docx,.ppt,.pptx,.xls,.xlsx",multiple:!0})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"bg-primary-50 dark:bg-primary-900/20 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-primary-700 dark:text-primary-400",children:(null==r?void 0:r.total_documents)||0}),(0,a.jsx)("div",{className:"text-xs text-primary-600 dark:text-primary-400 mt-1",children:"Documents"})]}),(0,a.jsxs)("div",{className:"bg-secondary-100 dark:bg-secondary-700 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-secondary-700 dark:text-secondary-200",children:(null==r?void 0:r.total_chunks)||0}),(0,a.jsx)("div",{className:"text-xs text-secondary-600 dark:text-secondary-400 mt-1",children:"Chunks"})]}),(0,a.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-700 dark:text-green-400",children:(null==r?void 0:r.total_entities)||0}),(0,a.jsx)("div",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Entities"})]}),(0,a.jsxs)("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-400",children:(null==r?void 0:r.total_relationships)||0}),(0,a.jsx)("div",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:"Relationships"})]})]}),(null==W?void 0:W.is_processing)&&(0,a.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border dark:border-secondary-700 px-4 py-3 text-sm shadow-sm ".concat(m?"border-red-200 bg-red-50 text-red-700 dark:border-red-900 dark:bg-red-900/20 dark:text-red-400":"border-secondary-200 bg-white dark:bg-secondary-800 text-secondary-700 dark:text-secondary-300"),children:[(0,a.jsx)("span",{className:"inline-flex h-2 w-2 rounded-full ".concat(m?"bg-red-500":"bg-primary-500 animate-pulse")}),(0,a.jsx)("div",{className:"flex-1",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-medium",children:"Processing appears stuck"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"No updates for 30+ seconds. Server may have crashed."})]}):(0,a.jsx)("p",{className:"font-medium",children:"Processing in progress…"})}),m&&(0,a.jsx)("button",{onClick:O,className:"px-3 py-1 text-xs font-medium rounded bg-red-600 text-white hover:bg-red-700",children:"Clear"})]}),r&&r.documents.length>0&&(0,a.jsxs)(a.Fragment,{children:[f?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)("input",{ref:E,type:"text",placeholder:"Search documents...",value:N,onChange:e=>_(e.target.value),onKeyDown:e=>{"Escape"===e.key&&(j(!1),_(""))},className:"w-full px-3 py-2 text-sm border border-secondary-300 rounded-md focus:outline-none focus:ring-1 focus:ring-primary-500"})}),(0,a.jsx)("button",{onClick:()=>{j(!1),_("")},className:"text-secondary-600 hover:text-secondary-900 dark:text-secondary-400 dark:hover:text-secondary-200 p-1",title:"Close search",children:(0,a.jsx)(k.Z,{className:"w-4 h-4"})})]}):(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50",children:"Documents"}),(0,a.jsx)("button",{onClick:()=>j(!0),className:"text-secondary-600 dark:text-secondary-400 hover:text-secondary-900 dark:hover:text-secondary-200 p-1",title:"Search documents",children:(0,a.jsx)(I.Z,{className:"w-4 h-4"})})]}),C&&(0,a.jsx)("button",{onClick:T,className:"text-xs text-red-600 hover:text-red-700",children:"Clear All"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[H().map((e,t)=>{let s=e.document_id===U,n=B(e),r=e.processing_status,o="number"==typeof e.processing_progress?Math.max(0,Math.min(100,e.processing_progress)):null;return(0,a.jsxs)("div",{draggable:!0,onDragStart:t=>{t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("application/json",JSON.stringify({type:"document",document_id:e.document_id,filename:e.original_filename||e.filename}))},onClick:()=>z(e.document_id),className:"card p-3 flex flex-col gap-2 transition-all cursor-move group ".concat(s?"border-primary-300 shadow-primary-100 ring-1 ring-primary-100":"hover:shadow-md hover:cursor-grab active:cursor-grabbing"),children:[(0,a.jsxs)("div",{className:"flex w-full items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("p",{className:"text-sm font-medium text-secondary-900 dark:text-secondary-50 truncate",children:e.original_filename||e.filename})}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat(m&&("queued"===r||"staged"===r)?"text-red-600 dark:text-red-400":"text-secondary-600 dark:text-secondary-400"),children:"queued"===r||"staged"===r?m?"Queue stuck - processing may have crashed":"Processing queued":e.document_type?e.document_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown type"}),n&&"queued"!==r&&"staged"!==r&&(0,a.jsx)("p",{className:"text-[11px] mt-1 ".concat("error"===r?"text-red-600":"processing"===r?"text-primary-600":"text-secondary-500 dark:text-secondary-400"),children:n})]}),C&&(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),R(e.document_id)},className:"text-red-600 hover:text-red-700 p-1 flex-shrink-0",title:"Delete ".concat(e.original_filename||e.filename),children:(0,a.jsx)(ec.Z,{className:"w-4 h-4"})})]}),"processing"===r&&null!==o&&(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between text-[10px] mb-1",children:[(0,a.jsx)("span",{className:m?"text-red-600":"text-secondary-500 dark:text-secondary-400",children:m?"Stuck - may need manual refresh":e.processing_stage||"Processing"}),(0,a.jsxs)("span",{className:m?"text-red-600":"text-secondary-500 dark:text-secondary-400",children:[Math.round(o),"%"]})]}),(0,a.jsx)("div",{className:"h-1.5 w-full rounded-full bg-secondary-200",children:(0,a.jsx)("div",{className:"h-1.5 rounded-full transition-all ".concat(m?"bg-red-500":"bg-primary-500"),style:{width:"".concat(o,"%")}})})]})]},t)}),N.trim()&&0===H().length&&(0,a.jsx)("div",{className:"text-center text-secondary-600 dark:text-secondary-400 py-6",children:(0,a.jsxs)("p",{className:"text-sm",children:['No documents match "',N,'"']})})]})]}),r&&0===r.documents.length&&(0,a.jsxs)("div",{className:"text-center text-secondary-600 dark:text-secondary-400 py-8",children:[(0,a.jsx)("p",{children:"No documents in database"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:"Upload documents to get started"})]})]})]})}function ex(e){let{open:t,onToggle:s,width:r,onWidthChange:o,minWidth:l=260,maxWidth:i=480}=e,[d,c]=(0,n.useState)("history"),[u,m]=(0,n.useState)(!1),[x,h]=(0,n.useState)(!1),g=p(e=>e.isConnected),y=[{id:"history",label:"History",icon:ea.Z},{id:"database",label:"Database",icon:en.Z},{id:"graph",label:"Graph",icon:er.Z}],b=(0,n.useCallback)(e=>{o(Math.min(Math.max(e,l),i))},[i,l,o]),f=(0,n.useCallback)(e=>{let t=t=>{b(r+(t-e))},s=e=>{t(e.clientX)},a=e=>{e.touches.length>0&&(e.preventDefault(),t(e.touches[0].clientX))},n=()=>{m(!1),document.body.style.removeProperty("cursor"),document.body.style.removeProperty("user-select"),window.removeEventListener("mousemove",s),window.removeEventListener("touchmove",a),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),window.removeEventListener("touchcancel",n)};m(!0),document.body.style.cursor="col-resize",document.body.style.userSelect="none",window.addEventListener("mousemove",s),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),window.addEventListener("touchcancel",n)},[b,r]),v=(0,n.useCallback)(e=>{e.preventDefault(),f(e.clientX)},[f]),j=(0,n.useCallback)(e=>{e.preventDefault(),e.touches.length>0&&f(e.touches[0].clientX)},[f]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:s,className:"fixed top-4 left-4 z-50 lg:hidden button-primary p-2",children:t?(0,a.jsx)(k.Z,{className:"w-6 h-6"}):(0,a.jsx)(eo.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("aside",{className:"fixed lg:static inset-y-0 left-0 z-40 w-80 bg-white dark:bg-secondary-800 border-r border-secondary-200 dark:border-secondary-700 transform transition-all duration-300 ease-in-out ".concat(t?"translate-x-0":"-translate-x-full lg:translate-x-0"," ").concat(u?"no-transition":""," relative"),style:{width:"".concat(x?72:r,"px")},children:[(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("button",{onClick:()=>h(e=>!e),"aria-label":x?"Expand sidebar":"Collapse sidebar",className:"hidden lg:flex absolute top-4 right-4 z-50 items-center justify-center p-2 rounded bg-white dark:bg-secondary-700 border border-secondary-200 dark:border-secondary-600 hover:bg-secondary-50 dark:hover:bg-secondary-600",children:x?(0,a.jsx)(el.Z,{className:"w-5 h-5"}):(0,a.jsx)(ei.Z,{className:"w-5 h-5"})}),!x&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-6 border-b border-secondary-200 dark:border-secondary-700",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-secondary-900 dark:text-secondary-50",children:"\uD83D\uDE80 GraphRAG"}),(0,a.jsx)("p",{className:"text-sm text-secondary-600 dark:text-secondary-400 mt-1",children:"Document Intelligence"})]}),(0,a.jsx)("div",{className:"flex border-b border-secondary-200 dark:border-secondary-700 transition-all duration-300 ".concat(g?"":"blur-sm pointer-events-none"),children:y.map(e=>(0,a.jsxs)("button",{onClick:()=>c(e.id),className:"flex-1 flex items-center justify-center py-3 text-sm font-medium transition-colors ".concat(d===e.id?"text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400":"text-secondary-600 dark:text-secondary-400 hover:text-secondary-900 dark:hover:text-secondary-200"),children:[(0,a.jsx)(e.icon,{className:"w-5 h-5 mr-1"}),e.label]},e.id))}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-6 transition-all duration-300 ".concat(g?"":"blur-sm pointer-events-none"),children:(0,a.jsxs)("div",{className:"tab-content",children:["history"===d&&(0,a.jsx)(eu,{}),"database"===d&&(0,a.jsx)(em,{}),"graph"===d&&(0,a.jsx)(es.default,{})]},d)})]})]}),!x&&(0,a.jsx)("div",{className:"hidden lg:flex absolute top-0 -right-2 h-full w-4 items-center justify-center cursor-col-resize ".concat(u?"bg-primary-100 dark:bg-primary-900/60":"bg-transparent"),onMouseDown:v,onTouchStart:j,children:(0,a.jsx)("div",{className:"h-16 w-1 rounded bg-secondary-300 dark:bg-secondary-600"})})]}),t&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:s})]})}var eh=s(4238),ep=s(4839);let eg=["light","dark","auto"],ey={light:"Light",dark:"Dark",auto:"Auto"};function eb(){let{theme:e,setTheme:t,isDark:s}=(0,eh.fl)(),[r,o]=(0,n.useState)(!1),[l,i]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{o(!0)},[]),!r)return null;let d=(eg.indexOf(e)+1)%eg.length,c=eg[d],u="dark"===e||"auto"===e&&s;return(0,a.jsxs)("div",{className:"fixed bottom-6 right-6 z-50",children:[l&&(0,a.jsx)("div",{className:"absolute bottom-12 right-0 mb-2 whitespace-nowrap",children:(0,a.jsx)("div",{className:"px-3 py-2 bg-secondary-900 dark:bg-secondary-50 text-white dark:text-secondary-900 text-sm rounded-lg shadow-lg",children:ey[e]})}),(0,a.jsx)("button",{onClick:()=>t(c),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),className:(0,ep.Z)("flex items-center justify-center w-12 h-12 rounded-full","bg-secondary-200 dark:bg-secondary-700","text-secondary-700 dark:text-secondary-200","hover:bg-secondary-300 dark:hover:bg-secondary-600","shadow-lg hover:shadow-xl","transition-all duration-200","border border-secondary-300 dark:border-secondary-600"),title:"Switch to ".concat(ey[c]," mode"),"aria-label":"Toggle theme",children:u?(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})}):(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})})})]})}function ef(){let e=p(e=>e.activeView),t=p(e=>e.setActiveView),[s,r]=(0,n.useState)(!0),[o,l]=(0,n.useState)(320);(0,n.useEffect)(()=>{let e=window.localStorage.getItem("sidebar-width");if(e){let t=parseInt(e,10);Number.isNaN(t)||l(Math.min(Math.max(t,260),480))}},[]),(0,n.useEffect)(()=>{window.localStorage.setItem("sidebar-width",String(o))},[o]);let i=e=>Math.min(Math.max(e,260),480);return(0,a.jsxs)("div",{className:"flex h-screen bg-secondary-50 dark:bg-secondary-900",children:[(0,a.jsx)(ex,{open:s,onToggle:()=>r(!s),width:o,onWidthChange:e=>l(i(e)),minWidth:260,maxWidth:480}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col transition-all duration-300 ".concat("ml-0"),children:[(0,a.jsx)("div",{className:"flex items-center gap-3 border-b border-secondary-200 bg-white px-6 py-4 dark:border-secondary-800 dark:bg-secondary-900",children:[{id:"chat",label:"Chat"},{id:"document",label:"Documents"},{id:"graph",label:"Graph"}].map(s=>(0,a.jsx)("button",{onClick:()=>t(s.id),className:"rounded-full px-4 py-2 text-sm font-semibold transition ".concat(e===s.id?"bg-primary-600 text-white shadow":"bg-secondary-100 text-secondary-700 hover:bg-secondary-200 dark:bg-secondary-800 dark:text-secondary-300 dark:hover:bg-secondary-700"),children:s.label},s.id))}),(0,a.jsx)("div",{className:"flex-1 overflow-auto bg-secondary-50 dark:bg-secondary-900",children:"document"===e?(0,a.jsx)(et,{}):"graph"===e?(0,a.jsx)(es.default,{}):(0,a.jsx)(F,{})})]}),(0,a.jsx)(eb,{})]})}},664:function(e,t,s){"use strict";s.d(t,{default:function(){return h},C:function(){return x}});var a=s(7437),n=s(2265),r=s(4446),o=s(1513),l=s(5130),i=s(9519),d=s(4573);function c(e){let{id:t,type:s,message:n,description:r,onDismiss:c}=e;return(0,a.jsxs)(o.E.div,{initial:{opacity:0,y:50,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95},className:"flex items-start gap-3 rounded-lg border px-4 py-3 shadow-lg max-w-md ".concat("success"===s?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/30":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/30"),children:["success"===s?(0,a.jsx)(l.Z,{className:"h-5 w-5 text-green-600 dark:text-green-400 flex-shrink-0 mt-0.5"}):(0,a.jsx)(i.Z,{className:"h-5 w-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat("success"===s?"text-green-900 dark:text-green-300":"text-red-900 dark:text-red-300"),children:n}),r&&(0,a.jsx)("p",{className:"text-xs mt-1 ".concat("success"===s?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:r})]}),(0,a.jsx)("button",{onClick:()=>c(t),className:"flex-shrink-0 ".concat("success"===s?"text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300":"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"),children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})]})}let u=0,m=new Set;function x(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3,n={id:"toast-".concat(++u),type:e,message:t,description:s,duration:a};m.forEach(e=>e(n))}function h(){let[e,t]=(0,n.useState)([]),s=(0,n.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[]),o=(0,n.useCallback)(e=>{t(t=>[...t,e]),e.duration&&e.duration>0&&setTimeout(()=>{s(e.id)},e.duration)},[s]);return(0,n.useEffect)(()=>(m.add(o),()=>{m.delete(o)}),[o]),(0,a.jsx)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2",children:(0,a.jsx)(r.M,{children:e.map(e=>(0,a.jsx)(c,{...e,onDismiss:s},e.id))})})}},4238:function(e,t,s){"use strict";s.d(t,{D7:function(){return l},_v:function(){return o},fl:function(){return r}});var a=s(9099),n=s(9291);let r=(0,a.Ue)()((0,n.tJ)((e,t)=>({theme:"auto",isDark:!1,setTheme:s=>{e({theme:s}),o(s,t().isDark)},setIsDark:s=>{e({isDark:s}),o(t().theme,s)}}),{name:"theme-store",partialize:e=>({theme:e.theme})}));function o(e,t){let s=document.documentElement;("auto"===e?t:"dark"===e)?s.classList.add("dark"):s.classList.remove("dark")}function l(){let{setIsDark:e}=r.getState();e(window.matchMedia("(prefers-color-scheme: dark)").matches);let t=window.matchMedia("(prefers-color-scheme: dark)"),s=t=>{e(t.matches)};return t.addEventListener("change",s),()=>t.removeEventListener("change",s)}}},function(e){e.O(0,[387,232,844,971,23,744],function(){return e(e.s=3269)}),_N_E=e.O()}]);