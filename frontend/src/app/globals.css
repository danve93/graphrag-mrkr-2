@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Spacing (8pt system) */
    --space-1: 4px;
    --space-2: 8px;
    --space-3: 12px;
    --space-4: 16px;
    --space-6: 24px;
    --space-8: 32px;
    --space-12: 48px;
    --space-16: 64px;
    --space-24: 96px;

    /* Typography */
    --font-display: 'Noto Sans Display', sans-serif;
    --font-body: 'Noto Sans', sans-serif;

    --text-xs: 12px;
    --text-sm: 14px;
    --text-base: 16px;
    --text-lg: 18px;
    --text-xl: 20px;
    --text-2xl: 24px;
    --text-3xl: 28px;
    --text-4xl: 36px;
    --text-5xl: 48px;

    /* Apple System Colors (Dark) */
    --systemBlue: #0A84FF;
    --systemIndigo: #5E5CE6;
    --systemPurple: #BF5AF2;
    --systemPink: #FF375F;
    --systemRed: #FF453A;
    --systemOrange: #FF9F0A;
    --systemYellow: #FFD60A;
    --systemGreen: #32D74B;
    --systemTeal: #64D2FF;

    --systemGray: #8E8E93;
    --systemGray2: #AEAEB2;
    --systemGray3: #C7C7CC;
    --systemGray4: #D1D1D6;
    --systemGray5: #E5E5EA;
    --systemGray6: #1C1C1E;

    /* Design tokens - Orange accent + dark gray bg */
    --accent-primary: #f27a03;
    --accent-hover: #d96a02;
    --accent-active: #b85902;
    --accent-subtle: rgba(242, 122, 3, 0.12);

    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #121212;
    --gray-900: #121212;
    --gray-950: #030712;

    /* Border Radius */
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-full: 9999px;

    /* Shadows */
    --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1);

    /* Timing */
    --timing-instant: 100ms;
    --timing-fast: 150ms;
    --timing-normal: 200ms;
    --timing-slow: 300ms;

    --easing-standard: cubic-bezier(0.4, 0, 0.2, 1);

    /* Legacy compatibility (will be phased out) */
    --bg-primary: #121212;
    /* Dark gray background */
    --bg-secondary: #1A1A1A;
    --bg-tertiary: #262626;
    --text-primary: #E5E7EB;
    --text-secondary: #A3A3A3;
    --border: #3D3D3D;
    --app-bg: var(--bg-primary);
    --muted-text: var(--text-secondary);
    --heading-text: #FFFFFF;
    --card-bg: var(--bg-secondary);
  }

  :root[data-theme="dark"] {
    --bg-primary: #0a0a0a;
    --bg-secondary: #171717;
    --bg-tertiary: #262626;
    --text-primary: #fafafa;
    --text-secondary: #a3a3a3;
    --border: #404040;
  }

  body {
    font-family: var(--font-body);
    font-size: 16px;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    margin: 0;
    padding: 0;
  }

  html {
    color-scheme: dark;
  }

  /* Ensure the Next.js app root fills the viewport so child containers using
     `h-screen` / `h-full` map correctly to the viewport without extra gaps. */
  html,
  body,
  #__next {
    height: 100%;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-display);
    margin-top: 0;
  }
}

@layer components {
  .chat-message {
    @apply p-4 mb-3;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
  }

  .chat-message-user {
    @apply text-white ml-auto max-w-[80%];
    background: var(--accent-primary);
  }

  .chat-message-assistant {
    @apply max-w-[85%];
    background: var(--gray-900);
    border: 1px solid var(--gray-800);
  }

  html.dark .chat-message-assistant {
    background: var(--bg-secondary);
    border-color: var(--border);
  }

  /* Primary button: solid background, no gradients */
  .button-primary {
    @apply text-white font-medium py-3 px-6 inline-flex items-center justify-center gap-2;
    background: var(--accent-primary);
    border: none;
    border-radius: var(--radius-sm);
    font-family: var(--font-body);
    font-size: var(--text-base);
    transition: background var(--timing-fast) var(--easing-standard);
  }

  .button-primary:hover {
    background: var(--accent-hover);
  }

  .button-primary:active {
    background: var(--accent-active);
    transform: scale(0.98);
  }

  .button-primary:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  /* Secondary button */
  .button-secondary {
    @apply font-medium py-3 px-6 inline-flex items-center justify-center gap-2;
    background: transparent;
    color: var(--gray-700);
    border: 1px solid var(--gray-300);
    border-radius: var(--radius-sm);
    font-family: var(--font-body);
    font-size: var(--text-base);
    transition: all var(--timing-fast) var(--easing-standard);
  }

  .button-secondary:hover {
    background: var(--gray-50);
    border-color: var(--gray-400);
  }

  html.dark .button-secondary {
    color: var(--gray-300);
    border-color: var(--gray-700);
  }

  html.dark .button-secondary:hover {
    background: var(--gray-800);
    border-color: var(--gray-600);
  }

  .button-secondary:active {
    transform: scale(0.98);
  }

  /* Loading spinner */
  .spinner {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid rgba(0, 0, 0, 0.1);
    border-top-color: var(--accent-primary);
    animation: spin 0.6s linear infinite;
  }

  html.dark .spinner {
    border-color: rgba(255, 255, 255, 0.1);
    border-top-color: var(--accent-primary);
  }

  .message-fade-in {
    animation: fadeIn var(--timing-normal) var(--easing-standard);
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Typing indicator animation */
  @keyframes typing-bounce {

    0%,
    60%,
    100% {
      transform: translateY(0);
      opacity: 0.4;
    }

    30% {
      transform: translateY(-4px);
      opacity: 1;
    }
  }

  .typing-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--text-secondary);
    animation: typing-bounce 1.4s infinite ease-in-out;
  }

  .typing-dot:nth-child(1) {
    animation-delay: 0s;
  }

  .typing-dot:nth-child(2) {
    animation-delay: 0.2s;
  }

  .typing-dot:nth-child(3) {
    animation-delay: 0.4s;
  }

  /* Tooltip */
  .tooltip-trigger {
    position: relative;
    display: inline-block;
  }

  .tooltip-content {
    background-color: var(--systemGray6);
    color: var(--systemGray2);
    text-align: left;
    padding: 8px 12px;
    border-radius: 6px;
    position: fixed;
    z-index: 9999;
    max-width: 320px;
    font-size: 12px;
    line-height: 1.4;
    transition: opacity 0.12s ease-in-out, transform 0.12s ease-in-out;
    pointer-events: none;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    word-wrap: break-word;
  }

  .input-field {
    @apply w-full text-base;
    background: white;
    border: 1px solid var(--gray-300);
    border-radius: var(--radius-sm);
    padding: var(--space-3) var(--space-4);
    font-family: var(--font-body);
    color: var(--gray-900);
    transition: border-color var(--timing-fast) var(--easing-standard);
  }

  .input-field:focus {
    outline: 2px solid var(--accent-subtle);
    outline-offset: 0;
    border-color: var(--accent-primary);
  }

  .input-field::placeholder {
    color: var(--gray-400);
  }

  html.dark .input-field {
    background: var(--bg-tertiary);
    border-color: var(--border);
    color: var(--text-primary);
  }

  .card {
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-md);
    padding: var(--space-6);
    box-shadow: var(--shadow-sm);
  }

  html.dark .card {
    background: var(--bg-secondary);
    border-color: var(--border);
  }

  /* Header/branding helpers */
  .branding-heading {
    font-family: var(--font-display);
    color: var(--gray-50);
    font-weight: 700;
    letter-spacing: -0.01em;
  }

  .no-transition {
    transition: none !important;
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  @apply bg-secondary-100 dark:bg-secondary-800;
}

::-webkit-scrollbar-thumb {
  @apply bg-secondary-400 dark:bg-secondary-600 rounded-full;
}

::-webkit-scrollbar-thumb:hover {
  @apply bg-secondary-500 dark:bg-secondary-500;
}

/* Markdown content styling */
.markdown-content {
  @apply prose prose-sm prose-slate dark:prose-invert max-w-none;
  @apply prose-headings:font-bold prose-headings:text-gray-900 dark:prose-headings:text-gray-50;
  @apply prose-p:text-gray-700 dark:prose-p:text-gray-300 prose-p:leading-relaxed;
  /* Link styling: apply explicitly to anchors inside markdown to avoid unsupported typography variant */
  /* The typography plugin may not generate `prose-a:text-*` for custom palette names. */
  /* We style anchors via a dedicated rule below. */
  @apply prose-strong:text-gray-900 dark:prose-strong:text-gray-50 prose-strong:font-semibold;
  @apply prose-code:bg-gray-100 dark:prose-code:bg-gray-700 prose-code:text-gray-800 dark:prose-code:text-gray-200 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm;
  @apply prose-pre:bg-gray-900 dark:prose-pre:bg-gray-950 prose-pre:text-gray-100 dark:prose-pre:text-gray-100;
  /* Blockquote styling handled via explicit rule to avoid unsupported typography variant */
  @apply prose-blockquote:text-gray-700 dark:prose-blockquote:text-gray-300;
  @apply prose-ul:text-gray-700 dark:prose-ul:text-gray-300 prose-ol:text-gray-700 dark:prose-ol:text-gray-300;
  @apply prose-li:text-gray-700 dark:prose-li:text-gray-300;

  /* Explicit anchor styling inside markdown content using Apple tokens */
  .markdown-content a {
    color: var(--accent-primary);
    text-decoration: none;
  }

  .markdown-content a:hover {
    @apply underline;
  }
}

/* Ensure Tailwind typography (`.prose`) uses app design tokens so code/pre
   blocks and headings match the app background/colors. This prevents
   the typography plugin from applying `#1f2937` / `#111827` backgrounds.
*/
.markdown-content {
  --tw-prose-body: var(--muted-text);
  --tw-prose-headings: var(--heading-text);
  --tw-prose-lead: var(--muted-text);
  --tw-prose-links: var(--accent-primary);
  --tw-prose-bold: var(--heading-text);
  --tw-prose-counters: var(--muted-text);
  --tw-prose-bullets: var(--gray-300);
  --tw-prose-hr: var(--gray-200);
  --tw-prose-quotes: var(--muted-text);
  --tw-prose-quote-borders: var(--gray-200);
  --tw-prose-captions: var(--muted-text);
  --tw-prose-kbd: var(--heading-text);
  --tw-prose-code: var(--text-primary);
  --tw-prose-pre-code: var(--text-primary);
  --tw-prose-pre-bg: var(--bg-primary);
  --tw-prose-th-borders: var(--gray-200);
  --tw-prose-td-borders: var(--gray-200);
}

html.dark .markdown-content {
  --tw-prose-body: var(--muted-text);
  --tw-prose-headings: var(--heading-text);
  --tw-prose-lead: var(--muted-text);
  --tw-prose-links: var(--accent-primary);
  --tw-prose-bold: var(--heading-text);
  --tw-prose-counters: var(--muted-text);
  --tw-prose-bullets: var(--gray-300);
  --tw-prose-hr: var(--gray-200);
  --tw-prose-quotes: var(--muted-text);
  --tw-prose-quote-borders: var(--gray-200);
  --tw-prose-captions: var(--muted-text);
  --tw-prose-kbd: var(--heading-text);
  --tw-prose-code: var(--text-primary);
  --tw-prose-pre-code: var(--text-primary);
  --tw-prose-pre-bg: var(--bg-primary);
  --tw-prose-th-borders: var(--gray-200);
  --tw-prose-td-borders: var(--gray-200);
}

/* Explicit blockquote border color using Apple tokens */
.markdown-content blockquote {
  border-left-width: 4px;
  border-left-color: var(--accent-primary);
  padding-left: 12px;
}

/* Shimmer removed to comply with safe UI animations policy. */

/* Tab content transitions */
.tab-content {
  animation: fadeSlideIn 0.3s ease-out;
}

@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Toggle styles using design tokens */
.toggle-on {
  background-color: var(--accent-primary);
}

.toggle-off {
  background-color: var(--gray-700);
}

/* Slider styles */
.slider {
  width: 100%;
  height: 8px;
  appearance: none;
  cursor: pointer;
  background: var(--gray-700);
  border-radius: var(--radius-md);
  outline: none;
  transition: background var(--timing-fast);
}

.slider::-webkit-slider-thumb {
  appearance: none;
  width: 18px;
  height: 18px;
  background: var(--accent-primary);
  border-radius: var(--radius-full);
  cursor: pointer;
  transition: transform var(--timing-fast);
}

.slider::-webkit-slider-thumb:hover {
  transform: scale(1.1);
}

.slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: var(--accent-primary);
  border: none;
  border-radius: var(--radius-full);
  cursor: pointer;
  transition: transform var(--timing-fast);
}

.slider::-moz-range-thumb:hover {
  transform: scale(1.1);
}

.small-button {
  @apply text-xs font-medium px-3 py-1.5 rounded-md inline-flex items-center gap-2;
}

.small-button-primary {
  background-color: var(--primary-500);
  color: white;
  border: 1px solid rgba(36, 198, 230, 0.18);
}

.small-button-secondary {
  background-color: transparent;
  color: var(--muted-text);
  border: 1px solid rgba(255, 255, 255, 0.04);
}

/* Focus and drag helpers that use design tokens */
.focus-primary:focus {
  outline: none;
  box-shadow: 0 0 0 4px rgba(36, 198, 230, 0.12);
  border-color: rgba(36, 198, 230, 0.24);
}

.is-dragging-ring {
  box-shadow: 0 0 0 3px var(--accent-subtle) !important;
}

.accent-selected {
  background-color: var(--accent-subtle);
  color: var(--accent-primary);
}

.accent-hover:hover {
  border-color: var(--accent-primary);
  background-color: var(--accent-subtle);
  color: var(--accent-primary);
}

/* 12-column grid system
   - Columns: 12
   - Gutter: 24px
   - Centered layout on large screens: fixed column width 72px
   - Stretch layout on medium screens: columns share available width
*/
.grid-12 {
  display: grid;
  gap: 24px;
  width: 100%;
}

/* Centered: fixed 72px columns, max width computed from columns+gutters */
.grid-12.center {
  grid-template-columns: repeat(12, 72px);
  max-width: calc(12 * 72px + 11 * 24px);
  margin-left: auto;
  margin-right: auto;
}

/* Stretch: medium screens use fractional columns to stretch */
@media (max-width: 1023px) {
  .grid-12.center {
    grid-template-columns: repeat(12, minmax(0, 1fr));
    max-width: 100%;
    padding-left: 24px;
    padding-right: 24px;
  }
}

/* Column span helpers (col-span-1 .. col-span-12) */
.col-span-1 {
  grid-column: span 1 / span 1;
}

.col-span-2 {
  grid-column: span 2 / span 2;
}

.col-span-3 {
  grid-column: span 3 / span 3;
}

.col-span-4 {
  grid-column: span 4 / span 4;
}

.col-span-5 {
  grid-column: span 5 / span 5;
}

.col-span-6 {
  grid-column: span 6 / span 6;
}

.col-span-7 {
  grid-column: span 7 / span 7;
}

.col-span-8 {
  grid-column: span 8 / span 8;
}

.col-span-9 {
  grid-column: span 9 / span 9;
}

.col-span-10 {
  grid-column: span 10 / span 10;
}

.col-span-11 {
  grid-column: span 11 / span 11;
}

.col-span-12 {
  grid-column: span 12 / span 12;
}

/* Utility to constrain content inside a grid cell */
.grid-cell {
  min-width: 0;
}

/* Focus visibility for accessibility */
*:focus-visible {
  outline: 2px solid var(--accent-primary);
  outline-offset: 2px;
  border-radius: 4px;
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {

  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Mobile touch optimizations */
@media (max-width: 768px) {

  /* Improve tap targets */
  button,
  a,
  [role="button"] {
    min-height: 44px;
    min-width: 44px;
  }

  /* Prevent text selection during touch interactions */
  .no-select {
    -webkit-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  /* Smooth scrolling on mobile */
  * {
    -webkit-overflow-scrolling: touch;
  }

  /* Prevent pull-to-refresh interference */
  body {
    overscroll-behavior-y: contain;
  }
}

/* Tablet optimizations */
@media (min-width: 768px) and (max-width: 1024px) {

  /* Adjust spacing for tablet */
  .container {
    padding-left: 16px;
    padding-right: 16px;
  }
}